import{d as J,l as de,r as b,c as y,s as x,o as se,n as W,w as ae,m as Z,a as u,b as e,e as f,t as l,p as ee,q as R,j as o,f as C,F as U,h as q,u as ve,i as ge,x as te,y as me}from"./index-Dh6weMDj.js";const pe={class:"card"},he={class:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6"},fe={class:"flex-shrink-0"},ye={key:0,class:"w-32 h-32 rounded-lg shadow-lg bg-gray-200 flex items-center justify-center"},be=["src","alt"],ke={class:"flex-1 text-center md:text-left"},$e={class:"mb-4"},xe={class:"text-gray-600"},_e={class:"text-sm text-gray-500"},we={class:"mb-4"},Te={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center"},Pe={class:"flex items-center justify-center mb-2"},Ce={class:"text-lg font-semibold text-blue-800"},Me={class:"text-blue-700 mb-2"},ze={class:"text-sm text-blue-600"},Se={class:"text-xs text-blue-500 mt-1"},Ae=["src"],De={key:2,class:"music-player-controls bg-gray-900 rounded-lg p-4"},Le={class:"flex items-center justify-center space-x-6 mb-4"},Be=["disabled"],je=["disabled"],Re={key:0,class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},Ee={key:1,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},Ie={key:2,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},Ve=["disabled"],Fe={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ne={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Xe={key:2,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},He={class:"mb-3"},Ye={class:"flex items-center space-x-3 text-xs text-gray-300"},Oe={class:"w-12 text-right"},Ue={class:"flex-1 relative"},qe={class:"w-12"},Ge={class:"flex items-center space-x-3"},Je={class:"flex-1 relative"},Ze=["value","disabled"],Ke={class:"text-xs text-gray-400 w-8"},Qe={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},We={class:"text-center"},et={class:"text-lg font-bold text-blue-800"},tt={class:"text-blue-700"},st={class:"text-blue-600"},at={class:"text-sm text-blue-500 mt-2"},lt=["href"],nt={key:0,class:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},ot={class:"text-center font-medium text-yellow-800"},rt={class:"text-center text-sm text-yellow-700 mt-1"},it={class:"font-bold text-lg"},ut={key:0,class:"text-sm mt-1"},ct=J({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(H,{emit:E}){const i=H,{t:M}=de(),r=b(),g=b(!1),k=b(!1),z=b(!1),S=b(0),v=b(0),_=b(.7),P=b(!1),B=b(!1);b(!1);const X=y(()=>{var h,D,O,N;const a=(D=(h=i.track.images)==null?void 0:h[0])==null?void 0:D.url,d=(N=(O=i.track.album.images)==null?void 0:O[0])==null?void 0:N.url;return a||d||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),I=y(()=>i.track.artists.map(a=>a.name).join(", ")),L=y(()=>i.showResult?i.isCorrect?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800":""),V=y(()=>i.showResult?i.isCorrect?M("game.turn.correct",{year:i.track.year}):M("game.turn.incorrect",{year:i.track.year}):""),F=y(()=>v.value===0?0:S.value/v.value*100),j=y(()=>!!i.track.uri),w=y(()=>j.value&&x.isPlayerReady()),A=y(()=>!!i.track.preview_url),n=y(()=>w.value||A.value);async function t(){console.log("Toggle playback called, isPlaying:",g.value),console.log("Can play full track:",w.value),console.log("Can play preview:",A.value),console.log("Spotify player ready:",x.isPlayerReady()),w.value?(await x.getAvailableDevices(),g.value?(await x.pausePlayback(),g.value=!1):await x.playTrack(i.track.uri)?(g.value=!0,c()):(console.warn("Failed to play track, falling back to preview if available"),A.value&&r.value&&r.value.play().catch(d=>{console.error("Error playing preview fallback:",d)}))):A.value&&r.value&&(g.value?r.value.pause():r.value.play().catch(a=>{console.error("Error playing audio:",a)}))}async function s(){console.log("Restart track called"),w.value?await x.playTrack(i.track.uri)&&(g.value=!0,c()):r.value&&(r.value.currentTime=0,g.value&&r.value.play().catch(a=>{console.error("Error playing audio after restart:",a)}))}function c(){const a=async()=>{if(!w.value)return;const d=await x.getPlaybackState();d&&(g.value=!d.paused,S.value=d.position/1e3,v.value=d.duration/1e3,g.value&&setTimeout(a,1e3))};a()}function p(){r.value&&(P.value?(r.value.volume=_.value,P.value=!1):(r.value.volume=0,P.value=!0))}function $(a){if(!r.value)return;const d=a.target,h=parseFloat(d.value);_.value=h,r.value.volume=h,h===0?P.value=!0:P.value&&(P.value=!1)}function m(a){a.stopPropagation()}function T(a){if(!r.value||!i.track.preview_url)return;const h=a.currentTarget.getBoundingClientRect();let D;if("touches"in a)if(a.touches.length>0)D=a.touches[0].clientX;else if(a.changedTouches.length>0)D=a.changedTouches[0].clientX;else return;else D=a.clientX;const N=Math.max(0,Math.min(1,(D-h.left)/h.width))*v.value;r.value.currentTime=N}function Y(a){!r.value||!i.track.preview_url||(a.preventDefault(),B.value=!0,G(a))}function le(a){B.value&&(a.preventDefault(),G(a))}function ne(a){B.value&&(a.preventDefault(),B.value=!1,G(a))}function G(a){if(!r.value||!i.track.preview_url)return;const h=a.currentTarget.getBoundingClientRect(),D=a.touches[0]||a.changedTouches[0];if(!D)return;const N=Math.max(0,Math.min(1,(D.clientX-h.left)/h.width))*v.value;r.value.currentTime=N}function K(a){if(isNaN(a))return"0:00";const d=Math.floor(a/60),h=Math.floor(a%60);return`${d}:${h.toString().padStart(2,"0")}`}function oe(){r.value&&(S.value=r.value.currentTime)}function re(){r.value&&(v.value=r.value.duration,r.value.volume=_.value)}function ie(){k.value=!0,z.value=!1}function ue(){k.value=!1,z.value=!0}function ce(){g.value=!1}se(()=>{x.isAuthenticated()&&W(()=>{x.initializePlayerIfReady()}),W(()=>{r.value&&Q()})}),ae(r,a=>{a&&Q()});function Q(){r.value&&(r.value.addEventListener("play",()=>{g.value=!0}),r.value.addEventListener("pause",()=>{g.value=!1}),r.value.volume=_.value)}return Z(()=>{w.value?x.stopPlayback():r.value&&r.value.pause()}),(a,d)=>(o(),u("div",pe,[e("div",he,[e("div",fe,[a.showAnswer?(o(),u("img",{key:1,src:X.value,alt:a.track.name,class:"w-32 h-32 rounded-lg shadow-lg object-cover"},null,8,be)):(o(),u("div",ye,d[4]||(d[4]=[e("svg",{class:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",ke,[e("div",$e,[e("p",xe,l(a.$t("game.turn.listening")),1),e("p",_e,l(a.$t("game.turn.placeOnTimeline")),1)]),e("div",we,[w.value?f("",!0):(o(),u("div",Te,[e("div",Pe,[d[5]||(d[5]=e("svg",{class:"w-8 h-8 text-blue-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)),e("h3",Ce,l(j.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",Me,l(j.value?a.$t("game.needsPremium"):a.$t("game.noPreview")),1),e("p",ze,[e("strong",null,l(j.value?a.$t("game.premiumNeededForFullPlay"):a.$t("game.needSpotifyForAudio")),1)]),e("p",Se,l(a.$t("game.demoModeInstructions")),1)])),A.value&&!w.value?(o(),u("audio",{key:1,ref_key:"audioPlayer",ref:r,src:a.track.preview_url||void 0,onEnded:ce,onTimeupdate:oe,onLoadedmetadata:re,onLoadstart:ie,onCanplay:ue,preload:"metadata"},l(a.$t("game.audioNotSupported")),41,Ae)):f("",!0),n.value?(o(),u("div",De,[e("div",Le,[e("button",{onClick:s,class:"control-btn",disabled:!n.value,title:"Restart"},d[6]||(d[6]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)]),8,Be),e("button",{onClick:t,class:"play-btn",disabled:!n.value},[k.value?(o(),u("div",Re)):g.value?(o(),u("svg",Ee,d[7]||(d[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(o(),u("svg",Ie,d[8]||(d[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))],8,je),e("button",{onClick:p,class:"control-btn",disabled:!n.value,title:"Mute/Unmute"},[P.value||_.value===0?(o(),u("svg",Fe,d[9]||(d[9]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM16 8.4A1 1 0 1117.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1),e("path",{d:"M18.293 6.293a1 1 0 011.414 1.414L17.414 10l2.293 2.293a1 1 0 01-1.414 1.414L16 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L14.586 10l-2.293-2.293a1 1 0 011.414-1.414L16 8.586l2.293-2.293z"},null,-1)]))):_.value<.5?(o(),u("svg",Ne,d[10]||(d[10]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a2 2 0 010 6 1 1 0 11-1.6-1.2V8.4z","clip-rule":"evenodd"},null,-1)]))):(o(),u("svg",Xe,d[11]||(d[11]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1)])))],8,Ve)]),e("div",He,[e("div",Ye,[e("span",Oe,l(K(S.value)),1),e("div",Ue,[e("div",{class:"progress-track",onClick:d[0]||(d[0]=h=>T(h)),onTouchstart:d[1]||(d[1]=h=>Y(h)),onTouchmove:d[2]||(d[2]=h=>le(h)),onTouchend:d[3]||(d[3]=h=>ne(h))},[e("div",{class:"progress-fill",style:ee({width:F.value+"%"})},null,4),e("div",{class:"progress-handle",style:ee({left:F.value+"%"})},null,4)],32)]),e("span",qe,l(K(v.value)),1)])]),e("div",Ge,[d[12]||(d[12]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793z","clip-rule":"evenodd"})],-1)),e("div",Je,[e("input",{type:"range",min:"0",max:"1",step:"0.1",value:_.value,onInput:$,onTouchstart:m,onTouchmove:m,onTouchend:m,class:"volume-slider",disabled:!a.track.preview_url},null,40,Ze)]),e("span",Ke,l(Math.round(_.value*100))+"%",1)])])):f("",!0)]),a.showAnswer?(o(),u("div",Qe,[e("div",We,[e("h4",et,l(a.track.name),1),e("p",tt,l(I.value),1),e("p",st,l(a.track.album.name)+" ("+l(a.track.year)+")",1),e("p",at,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"underline hover:no-underline"},l(a.$t("game.openInSpotify"))+" ↗ ",9,lt)])])])):f("",!0)])]),a.showAnswer?f("",!0):(o(),u("div",nt,[e("p",ot,l(a.$t("game.turn.placing")),1),e("p",rt,l(a.$t("game.dragToTimeline")),1)])),a.showResult?(o(),u("div",{key:1,class:R(["mt-4 p-4 rounded-lg text-center",L.value])},[e("p",it,l(V.value),1),a.pointsEarned>0?(o(),u("p",ut,l(a.$t("game.turn.points",{points:a.pointsEarned})),1)):f("",!0)],2)):f("",!0)]))}}),dt={class:"flex items-center justify-between mb-4"},vt={class:"text-lg font-semibold flex items-center space-x-2"},gt={key:0,class:"text-green-500"},mt={class:"text-right"},pt={class:"text-2xl font-bold"},ht={class:"flex items-center space-x-2 text-sm text-gray-600"},ft={key:0,class:"mb-4"},yt={class:"text-sm font-medium text-gray-700 mb-2"},bt={class:"flex space-x-2"},kt=["title"],$t=["title"],xt={class:"mb-4"},_t={class:"text-sm font-medium text-gray-700 mb-2"},wt={key:0,class:"text-center py-8 text-gray-500"},Tt={class:"text-center text-gray-500"},Pt={key:1,class:"space-y-2"},Ct={class:"text-center text-gray-500 text-sm"},Mt={class:"flex items-center space-x-3"},zt={class:"w-12 h-12 rounded object-cover flex-shrink-0 relative"},St=["src","alt"],At={key:1,class:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center"},Dt={class:"flex-1 min-w-0"},Lt={class:"font-medium truncate"},Bt={class:"text-sm text-gray-600 truncate"},jt={class:"text-right flex-shrink-0"},Rt={class:"font-bold text-lg"},Et=["onDragover","onDragleave","onDrop","data-drop-zone"],It={class:"text-center text-gray-500 text-sm"},Vt=["data-drop-zone"],Ft={class:"text-center text-gray-500 text-sm"},Nt={class:"flex items-center space-x-3"},Xt={class:"flex-1 min-w-0"},Ht={class:"font-medium text-blue-800"},Yt={class:"text-sm text-blue-600"},Ot={key:2,class:"mt-4 pt-4 border-t border-gray-200"},Ut={class:"flex justify-between text-sm text-gray-600"},qt={key:0},Gt=J({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(H,{emit:E}){const i=H,M=E,r=b(!1),g=b([]),k=b(!1),z=b({x:0,y:0}),S=b({x:0,y:0}),v=b(null),_=y(()=>{if(i.player.timeline.length<2)return null;const t=i.player.timeline.map(s=>s.year).sort((s,c)=>s-c);return`${t[0]} - ${t[t.length-1]}`});function P(t){var s,c,p,$;return((c=(s=t.images)==null?void 0:s[0])==null?void 0:c.url)||(($=(p=t.album.images)==null?void 0:p[0])==null?void 0:$.url)||"/placeholder-album.png"}function B(t){return t.artists.map(s=>s.name).join(", ")}function X(t){var c;if(!i.currentTrack)return;(c=t.dataTransfer)==null||c.setData("text/plain",JSON.stringify(i.currentTrack)),t.target.classList.add("dragging")}function I(t){t.target.classList.remove("dragging"),r.value=!1,g.value=[]}function L(t){!i.currentTrack||!i.canPlace||(r.value=!1,g.value=[],M("placeTrack",i.currentTrack,t))}function V(t){M("useToken",t)}function F(t){if(!(!i.currentTrack||!i.canPlace))try{t.preventDefault(),k.value=!0;const s=t.touches[0];if(!s)return;z.value={x:s.clientX,y:s.clientY},S.value={x:s.clientX,y:s.clientY};const c=t.target,p=c.getBoundingClientRect();v.value=c.cloneNode(!0),v.value.style.position="fixed",v.value.style.top=`${p.top}px`,v.value.style.left=`${p.left}px`,v.value.style.width=`${p.width}px`,v.value.style.height=`${p.height}px`,v.value.style.zIndex="9999",v.value.style.opacity="0.8",v.value.style.transform="rotate(2deg)",v.value.style.pointerEvents="none",v.value.classList.add("dragging"),document.body.appendChild(v.value),c.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(50)}catch(s){console.warn("Touch start error:",s),n()}}function j(t){if(!(!k.value||!v.value))try{t.preventDefault();const s=t.touches[0];if(!s)return;S.value={x:s.clientX,y:s.clientY};const c=50,p=50;v.value.style.left=`${s.clientX-c}px`,v.value.style.top=`${s.clientY-p}px`;const $=document.elementFromPoint(s.clientX,s.clientY),m=$==null?void 0:$.closest("[data-drop-zone]");if(r.value=!1,g.value.fill(!1),m){const T=parseInt(m.getAttribute("data-drop-zone")||"0");T===0?r.value=!0:T<=g.value.length&&(g.value[T]=!0)}}catch(s){console.warn("Touch move error:",s)}}function w(t){if(k.value)try{t.preventDefault(),k.value=!1;const s=t.changedTouches[0];if(!s){n();return}const c=document.elementFromPoint(s.clientX,s.clientY),p=c==null?void 0:c.closest("[data-drop-zone]");v.value&&(v.value.style.transition="opacity 0.2s ease-out",v.value.style.opacity="0",setTimeout(()=>{v.value&&document.body.contains(v.value)&&document.body.removeChild(v.value),v.value=null},200));const $=document.querySelector(".dragging");if($&&$.classList.remove("dragging"),r.value=!1,g.value.fill(!1),p&&i.currentTrack){const m=parseInt(p.getAttribute("data-drop-zone")||"0");"vibrate"in navigator&&navigator.vibrate(100),M("placeTrack",i.currentTrack,m)}}catch(s){console.warn("Touch end error:",s),n()}}function A(){g.value=new Array(i.player.timeline.length+1).fill(!1)}function n(){k.value=!1,r.value=!1,g.value.fill(!1),v.value&&document.body.contains(v.value)&&(document.body.removeChild(v.value),v.value=null),document.querySelectorAll(".dragging").forEach(s=>s.classList.remove("dragging"))}return Z(()=>{n()}),ae(()=>i.player.timeline.length,()=>{A()},{immediate:!0}),(t,s)=>(o(),u("div",{class:R(["card",{"ring-2 ring-green-500":t.isCurrent}])},[e("div",dt,[e("h3",vt,[e("span",null,l(t.player.name),1),t.isCurrent?(o(),u("span",gt,"👑")):f("",!0)]),e("div",mt,[e("p",pt,l(t.player.score),1),e("div",ht,[s[11]||(s[11]=e("span",null,"🎵",-1)),e("span",null,l(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(o(),u("div",ft,[e("h4",yt,l(t.$t("game.tokenAbilities")),1),e("div",bt,[e("button",{onClick:s[0]||(s[0]=c=>V("skip")),class:"btn btn-sm bg-yellow-100 hover:bg-yellow-200 text-yellow-800",title:t.$t("game.tokens.skip.description")}," ⏭️ "+l(t.$t("game.tokens.skip.label")),9,kt),e("button",{onClick:s[1]||(s[1]=c=>V("hint")),class:"btn btn-sm bg-blue-100 hover:bg-blue-200 text-blue-800",title:t.$t("game.tokens.hint.description")}," 💡 "+l(t.$t("game.tokens.hint.label")),9,$t)])])):f("",!0),e("div",xt,[e("h4",_t,l(t.$t("game.timeline.title")),1),t.player.timeline.length===0?(o(),u("div",wt,[e("p",null,l(t.$t("game.timeline.empty")),1),t.canPlace?(o(),u("div",{key:0,class:R(["timeline-slot mt-4",{"drag-over":r.value}]),onDragover:s[2]||(s[2]=C(c=>r.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=C(c=>r.value=!1,["prevent"])),onDrop:s[4]||(s[4]=C(c=>L(0),["prevent"])),"data-drop-zone":0},[e("p",Tt,l(t.$t("game.timeline.placeHere")),1)],34)):f("",!0)])):(o(),u("div",Pt,[t.canPlace?(o(),u("div",{key:0,class:R(["timeline-slot h-16",{"drag-over":g.value[0]}]),onDragover:s[5]||(s[5]=C(c=>g.value[0]=!0,["prevent"])),onDragleave:s[6]||(s[6]=C(c=>g.value[0]=!1,["prevent"])),onDrop:s[7]||(s[7]=C(c=>L(0),["prevent"])),"data-drop-zone":0},[e("p",Ct,l(t.$t("game.placeEarlier")),1)],34)):f("",!0),(o(!0),u(U,null,q(t.player.timeline,(c,p)=>(o(),u("div",{key:c.id,class:"track-card"},[e("div",Mt,[e("div",zt,[c.revealed?(o(),u("img",{key:0,src:P(c),alt:c.name,class:"w-12 h-12 rounded object-cover"},null,8,St)):(o(),u("div",At,s[12]||(s[12]=[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",Dt,[e("p",Lt,l(c.name),1),e("p",Bt,l(B(c)),1)]),e("div",jt,[e("p",Rt,l(c.year),1)])]),t.canPlace&&p<t.player.timeline.length-1?(o(),u("div",{key:0,class:R(["timeline-slot h-16 mt-2",{"drag-over":g.value[p+1]}]),onDragover:C($=>g.value[p+1]=!0,["prevent"]),onDragleave:C($=>g.value[p+1]=!1,["prevent"]),onDrop:C($=>L(p+1),["prevent"]),"data-drop-zone":p+1},[e("p",It,l(t.$t("game.placeBetween")),1)],42,Et)):f("",!0)]))),128)),t.canPlace?(o(),u("div",{key:1,class:R(["timeline-slot h-16",{"drag-over":g.value[t.player.timeline.length]}]),onDragover:s[8]||(s[8]=C(c=>g.value[t.player.timeline.length]=!0,["prevent"])),onDragleave:s[9]||(s[9]=C(c=>g.value[t.player.timeline.length]=!1,["prevent"])),onDrop:s[10]||(s[10]=C(c=>L(t.player.timeline.length),["prevent"])),"data-drop-zone":t.player.timeline.length},[e("p",Ft,l(t.$t("game.placeLater")),1)],42,Vt)):f("",!0)]))]),t.canPlace&&t.currentTrack?(o(),u("div",{key:1,class:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg cursor-move touch-manipulation select-none",draggable:"true",onDragstart:X,onDragend:I,onTouchstart:F,onTouchmove:j,onTouchend:w,style:{touchAction:"none"}},[e("div",Nt,[s[13]||(s[13]=e("div",{class:"w-12 h-12 rounded bg-blue-200 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",Xt,[e("p",Ht,l(t.$t("game.newTrack")),1),e("p",Yt,l(t.$t("game.dragToPlace")),1)]),s[14]||(s[14]=e("div",{class:"text-blue-500"},[e("span",{class:"text-2xl"},"🎵")],-1))])],32)):f("",!0),t.player.timeline.length>0?(o(),u("div",Ot,[e("div",Ut,[e("span",null,l(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),_.value?(o(),u("span",qt,l(_.value),1)):f("",!0)])])):f("",!0)],2))}}),Jt={class:"min-h-screen flex flex-col"},Zt={class:"bg-white/10 backdrop-blur-sm p-4"},Kt={class:"flex justify-between items-center"},Qt={class:"flex items-center space-x-4"},Wt={class:"text-white"},es={class:"text-xl font-bold"},ts={class:"text-sm opacity-80"},ss={class:"text-white text-right"},as={class:"text-sm opacity-80"},ls={class:"flex-1 container mx-auto px-4 py-6"},ns={key:0,class:"max-w-2xl mx-auto"},os={class:"card text-center"},rs={class:"text-2xl font-semibold mb-4"},is={class:"text-gray-600 mb-6"},us={key:1,class:"space-y-6"},cs={class:"card text-center bg-green-50 border-green-200"},ds={class:"text-2xl font-bold text-green-800 mb-2"},vs={class:"text-green-700"},gs={key:0,class:"mt-4"},ms={key:1,class:"mt-4"},ps={class:"flex items-center justify-center space-x-2"},hs={key:0,class:"card bg-yellow-50 border-yellow-200"},fs={class:"flex items-center space-x-3"},ys={class:"flex-1"},bs={class:"text-lg font-semibold text-yellow-800"},ks={class:"text-yellow-700 text-sm"},$s={class:"flex space-x-2"},xs={key:1,class:"card bg-orange-50 border-orange-200"},_s={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ws={class:"card"},Ts={class:"text-lg font-semibold mb-4"},Ps={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Cs={class:"font-semibold"},Ms={class:"text-2xl font-bold text-green-600"},zs={class:"text-sm text-gray-600"},Ss={class:"text-xs text-gray-500"},As={key:2,class:"max-w-2xl mx-auto"},Ds={class:"card text-center"},Ls={class:"text-3xl font-bold mb-4 text-green-600"},Bs={class:"text-xl mb-6"},js={class:"mb-6"},Rs={class:"text-lg font-semibold mb-3"},Es={class:"space-y-2"},Is={class:"font-medium"},Vs={class:"font-bold"},Fs={class:"flex space-x-4 justify-center"},Xs=J({__name:"GameView",setup(H){const E=ge(),i=ve(),M=b(!1),r=b(x.isAuthenticated()),g=y(()=>i.players),k=y(()=>i.currentPlayer),z=y(()=>i.currentTrack),S=y(()=>i.gamePhase),v=y(()=>i.round);y(()=>i.settings);const _=y(()=>i.winner),P=y(()=>r.value),B=y(()=>P.value&&!x.isPlayerReady()),X=y(()=>[...g.value].sort((n,t)=>t.timeline.length!==n.timeline.length?t.timeline.length-n.timeline.length:t.tokens!==n.tokens?t.tokens-n.tokens:t.score-n.score));async function I(){M.value=!0;try{await i.getNextTrack()||console.error("No tracks available")}catch(n){console.error("Error loading track:",n)}finally{M.value=!1}}function L(n,t){i.placeTrackOnTimeline(n,t),setTimeout(()=>{i.nextPlayer()},2e3)}function V(n){var s;if(!k.value)return;if(i.useToken(k.value.id,n))switch(n){case"skip":I();break;case"hint":alert(`Hint: This track was released in the ${Math.floor(((s=z.value)==null?void 0:s.year)/10)*10}s`);break}}function F(){i.resetGame(),E.push("/")}function j(){E.push("/")}function w(){const n=x.isAuthenticated(),t=localStorage.getItem("spotify_auth");console.log("Spotify auth check:",{isAuthenticated:n,authStateInStorage:t?JSON.parse(t):null,currentValue:r.value}),r.value=n,n&&x.initializePlayerIfReady()}async function A(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await x.forceReauth()}return se(()=>{i.gamePhase==="setup"&&i.players.length===0&&E.push("/"),w();const n=setInterval(()=>{w()},2e3);Z(()=>{clearInterval(n)})}),(n,t)=>{var s,c,p,$;return o(),u("div",Jt,[e("header",Zt,[e("div",Kt,[e("div",Qt,[e("button",{onClick:t[0]||(t[0]=m=>n.$router.push("/")),class:"btn btn-secondary"}," ← "+l(n.$t("common.back")),1),e("div",Wt,[e("h1",es,l(n.$t("game.title")),1),e("p",ts,l(n.$t("game.round"))+" "+l(v.value),1)])]),e("div",ss,[e("p",as,l(n.$t("game.turn.currentPlayer",{player:(s=k.value)==null?void 0:s.name})),1)])])]),e("main",ls,[S.value==="setup"?(o(),u("div",ns,[e("div",os,[e("h2",rs,l(n.$t("game.setupRequired")),1),e("p",is,l(n.$t("game.setupMessage")),1),e("button",{onClick:t[1]||(t[1]=m=>n.$router.push("/")),class:"btn btn-primary"},l(n.$t("game.backToSetup")),1)])])):S.value==="playing"?(o(),u("div",us,[e("div",cs,[e("h2",ds,l(n.$t("game.turn.currentPlayer",{player:(c=k.value)==null?void 0:c.name})),1),e("p",vs,l(n.$t("game.turn.ready")),1),!z.value&&!M.value?(o(),u("div",gs,[e("button",{onClick:I,class:"btn btn-primary btn-lg"}," 🎵 "+l(n.$t("game.getTrack")),1)])):f("",!0),M.value?(o(),u("div",ms,[e("div",ps,[t[3]||(t[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,l(n.$t("common.loading")),1)])])):f("",!0)]),P.value?P.value&&B.value?(o(),u("div",xs,[e("div",{class:"flex items-center space-x-3"},[t[5]||(t[5]=me('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:A,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):f("",!0):(o(),u("div",hs,[e("div",fs,[t[4]||(t[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ys,[e("h3",bs,l(n.$t("game.spotify.notConnected")),1),e("p",ks,l(n.$t("game.demoModeActive")),1)]),e("div",$s,[e("button",{onClick:j,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},l(n.$t("game.spotify.login")),1),e("button",{onClick:A,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:w,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),z.value?(o(),te(ct,{key:2,track:z.value,onPlaceTrack:L},null,8,["track"])):f("",!0),e("div",_s,[(o(!0),u(U,null,q(g.value,m=>{var T,Y;return o(),te(Gt,{key:m.id,player:m,"is-current":m.id===((T=k.value)==null?void 0:T.id),"current-track":z.value,"can-place":m.id===((Y=k.value)==null?void 0:Y.id)&&!!z.value,onPlaceTrack:L,onUseToken:V},null,8,["player","is-current","current-track","can-place"])}),128))]),e("div",ws,[e("h3",Ts,l(n.$t("game.score.title")),1),e("div",Ps,[(o(!0),u(U,null,q(g.value,m=>{var T;return o(),u("div",{key:m.id,class:R(["text-center p-3 rounded-lg",m.id===((T=k.value)==null?void 0:T.id)?"bg-green-100":"bg-gray-50"])},[e("p",Cs,l(m.name),1),e("p",Ms,l(m.tokens),1),e("p",zs,l(n.$t("game.score.tokens",{count:m.tokens})),1),e("p",Ss,l(n.$t("game.score.total",{score:m.score})),1)],2)}),128))])])])):S.value==="finished"?(o(),u("div",As,[e("div",Ds,[e("h2",Ls,l(n.$t("game.end.title")),1),e("p",Bs,l(n.$t("game.end.winner",{player:(p=_.value)==null?void 0:p.name,score:($=_.value)==null?void 0:$.timeline.length})),1),e("div",js,[e("h3",Rs,l(n.$t("game.end.finalScores")),1),e("div",Es,[(o(!0),u(U,null,q(X.value,(m,T)=>(o(),u("div",{key:m.id,class:R(["flex justify-between items-center p-3 rounded-lg",T===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Is,l(T+1)+". "+l(m.name),1),e("span",Vs,l(m.timeline.length)+" "+l(n.$t("game.songs"))+" | "+l(m.tokens)+" "+l(n.$t("game.score.tokens",{count:m.tokens})),1)],2))),128))])]),e("div",Fs,[e("button",{onClick:F,class:"btn btn-primary"}," 🔄 "+l(n.$t("game.end.playAgain")),1),e("button",{onClick:t[2]||(t[2]=m=>n.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+l(n.$t("game.backToHome")),1)])])])):f("",!0)])])}}});export{Xs as default};
