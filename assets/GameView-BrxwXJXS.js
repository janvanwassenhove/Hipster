import{d as X,l as ne,r as T,c as f,s as k,o as ee,n as Q,w as te,m as se,a as n,b as e,e as g,t,p as W,q as D,j as l,f as w,F as q,h as G,u as oe,i as re,x as Z,y as ie}from"./index-DOOGmPZc.js";const ce={class:"card"},ue={class:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6"},de={class:"flex-shrink-0"},ve={key:0,class:"w-32 h-32 rounded-lg shadow-lg bg-gray-200 flex items-center justify-center"},me=["src","alt"],ge={class:"flex-1 text-center md:text-left"},pe={key:0,class:"mb-4"},fe={class:"text-gray-600"},he={class:"text-sm text-gray-500"},ye={key:1,class:"mb-4"},be={class:"text-xl font-bold text-gray-800"},ke={class:"text-lg text-gray-600"},$e={class:"text-sm text-gray-500"},_e={key:2,class:"mb-4"},xe={class:"text-xl font-bold text-gray-800"},we={class:"text-lg text-gray-600"},Te={class:"text-gray-600"},Pe={class:"text-sm text-gray-500"},Ce={class:"mb-4"},Me={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center"},Ae={class:"flex items-center justify-center mb-2"},Se={class:"text-lg font-semibold text-blue-800"},ze={class:"text-blue-700 mb-2"},Be={class:"text-sm text-blue-600"},De={class:"text-xs text-blue-500 mt-1"},Le=["src"],je={key:2,class:"music-player-controls bg-gray-900 rounded-lg p-4"},Re={class:"flex items-center justify-center space-x-6 mb-4"},Ve=["disabled"],Ie=["disabled"],Ne={key:0,class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},Ee={key:1,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},Fe={key:2,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},He=["disabled"],Ue={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Oe={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},qe={key:2,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ge={class:"mb-3"},Je={class:"flex items-center space-x-3 text-xs text-gray-300"},Xe={class:"w-12 text-right"},Ye={class:"flex-1 relative"},Ke={class:"w-12"},Qe={class:"flex items-center space-x-3"},We={class:"flex-1 relative"},Ze=["value","disabled"],et={class:"text-xs text-gray-400 w-8"},tt={key:3,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},st={class:"text-center"},at={class:"text-lg font-bold text-blue-800"},lt={class:"text-blue-700"},nt={class:"text-blue-600"},ot={class:"text-sm text-blue-500 mt-2"},rt=["href"],it={key:0,class:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},ct={class:"text-center font-medium text-yellow-800"},ut={class:"text-center text-sm text-yellow-700 mt-1"},dt={class:"font-bold text-lg"},vt={key:0,class:"text-sm mt-1"},mt=X({__name:"TrackPlayer",props:{track:{},difficulty:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(N,{emit:V}){const i=N,{t:C}=ne(),c=T(),v=T(!1),$=T(!1),P=T(!1),M=T(0),A=T(0),x=T(.7),y=T(!1),z=f(()=>{var _,J,O,K;const a=(J=(_=i.track.images)==null?void 0:_[0])==null?void 0:J.url,u=(K=(O=i.track.album.images)==null?void 0:O[0])==null?void 0:K.url;return a||u||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),L=f(()=>i.track.artists.map(a=>a.name).join(", ")),s=f(()=>i.showResult?i.isCorrect?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800":""),o=f(()=>i.showResult?i.isCorrect?C("game.turn.correct",{year:i.track.year}):C("game.turn.incorrect",{year:i.track.year}):""),d=f(()=>A.value===0?0:M.value/A.value*100),b=f(()=>!!i.track.uri),h=f(()=>b.value&&k.isPlayerReady()),j=f(()=>!!i.track.preview_url),B=f(()=>h.value||j.value);async function E(){console.log("Toggle playback called, isPlaying:",v.value),console.log("Can play full track:",h.value),console.log("Can play preview:",j.value),console.log("Spotify player ready:",k.isPlayerReady()),h.value?(await k.getAvailableDevices(),v.value?(await k.pausePlayback(),v.value=!1):await k.playTrack(i.track.uri)?(v.value=!0,m()):(console.warn("Failed to play track, falling back to preview if available"),j.value&&c.value&&c.value.play().catch(u=>{console.error("Error playing preview fallback:",u)}))):j.value&&c.value&&(v.value?c.value.pause():c.value.play().catch(a=>{console.error("Error playing audio:",a)}))}async function r(){console.log("Restart track called"),h.value?await k.playTrack(i.track.uri)&&(v.value=!0,m()):c.value&&(c.value.currentTime=0,v.value&&c.value.play().catch(a=>{console.error("Error playing audio after restart:",a)}))}function m(){const a=async()=>{if(!h.value)return;const u=await k.getPlaybackState();u&&(v.value=!u.paused,M.value=u.position/1e3,A.value=u.duration/1e3,v.value&&setTimeout(a,1e3))};a()}function R(){c.value&&(y.value?(c.value.volume=x.value,y.value=!1):(c.value.volume=0,y.value=!0))}function F(a){if(!c.value)return;const u=a.target,_=parseFloat(u.value);x.value=_,c.value.volume=_,_===0?y.value=!0:y.value&&(y.value=!1)}function H(a){if(!c.value||!i.track.preview_url)return;const _=a.currentTarget.getBoundingClientRect(),O=(a.clientX-_.left)/_.width*A.value;c.value.currentTime=O}function I(a){if(isNaN(a))return"0:00";const u=Math.floor(a/60),_=Math.floor(a%60);return`${u}:${_.toString().padStart(2,"0")}`}function p(){c.value&&(M.value=c.value.currentTime)}function S(){c.value&&(A.value=c.value.duration,c.value.volume=x.value)}function U(){$.value=!0,P.value=!1}function ae(){$.value=!1,P.value=!0}function le(){v.value=!1}ee(()=>{k.isAuthenticated()&&Q(()=>{k.initializePlayerIfReady()}),Q(()=>{c.value&&Y()})}),te(c,a=>{a&&Y()});function Y(){c.value&&(c.value.addEventListener("play",()=>{v.value=!0}),c.value.addEventListener("pause",()=>{v.value=!1}),c.value.volume=x.value)}return se(()=>{h.value?k.stopPlayback():c.value&&c.value.pause()}),(a,u)=>(l(),n("div",ce,[e("div",ue,[e("div",de,[a.showAnswer?(l(),n("img",{key:1,src:z.value,alt:a.track.name,class:"w-32 h-32 rounded-lg shadow-lg object-cover"},null,8,me)):(l(),n("div",ve,u[1]||(u[1]=[e("svg",{class:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",ge,[a.difficulty==="original"?(l(),n("div",pe,[e("p",fe,t(a.$t("game.turn.listening")),1),e("p",he,t(a.$t("game.difficulties.originalHint")),1)])):a.difficulty==="pro"?(l(),n("div",ye,[e("h3",be,t(a.track.name),1),e("p",ke,t(L.value),1),e("p",$e,t(a.$t("game.difficulties.proHint")),1)])):a.difficulty==="expert"?(l(),n("div",_e,[e("h3",xe,t(a.track.name),1),e("p",we,t(L.value),1),e("p",Te,t(a.track.album.name),1),e("p",Pe,t(a.$t("game.difficulties.expertHint")),1)])):g("",!0),e("div",Ce,[h.value?g("",!0):(l(),n("div",Me,[e("div",Ae,[u[2]||(u[2]=e("svg",{class:"w-8 h-8 text-blue-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)),e("h3",Se,t(b.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",ze,t(b.value?a.$t("game.needsPremium"):a.$t("game.noPreview")),1),e("p",Be,[e("strong",null,t(b.value?a.$t("game.premiumNeededForFullPlay"):a.$t("game.needSpotifyForAudio")),1)]),e("p",De,t(a.$t("game.demoModeInstructions")),1)])),j.value&&!h.value?(l(),n("audio",{key:1,ref_key:"audioPlayer",ref:c,src:a.track.preview_url||void 0,onEnded:le,onTimeupdate:p,onLoadedmetadata:S,onLoadstart:U,onCanplay:ae,preload:"metadata"},t(a.$t("game.audioNotSupported")),41,Le)):g("",!0),B.value?(l(),n("div",je,[e("div",Re,[e("button",{onClick:r,class:"control-btn",disabled:!B.value,title:"Restart"},u[3]||(u[3]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)]),8,Ve),e("button",{onClick:E,class:"play-btn",disabled:!B.value},[$.value?(l(),n("div",Ne)):v.value?(l(),n("svg",Ee,u[4]||(u[4]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(l(),n("svg",Fe,u[5]||(u[5]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))],8,Ie),e("button",{onClick:R,class:"control-btn",disabled:!B.value,title:"Mute/Unmute"},[y.value||x.value===0?(l(),n("svg",Ue,u[6]||(u[6]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM16 8.4A1 1 0 1117.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1),e("path",{d:"M18.293 6.293a1 1 0 011.414 1.414L17.414 10l2.293 2.293a1 1 0 01-1.414 1.414L16 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L14.586 10l-2.293-2.293a1 1 0 011.414-1.414L16 8.586l2.293-2.293z"},null,-1)]))):x.value<.5?(l(),n("svg",Oe,u[7]||(u[7]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a2 2 0 010 6 1 1 0 11-1.6-1.2V8.4z","clip-rule":"evenodd"},null,-1)]))):(l(),n("svg",qe,u[8]||(u[8]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1)])))],8,He)]),e("div",Ge,[e("div",Je,[e("span",Xe,t(I(M.value)),1),e("div",Ye,[e("div",{class:"progress-track",onClick:u[0]||(u[0]=_=>H(_))},[e("div",{class:"progress-fill",style:W({width:d.value+"%"})},null,4),e("div",{class:"progress-handle",style:W({left:d.value+"%"})},null,4)])]),e("span",Ke,t(I(A.value)),1)])]),e("div",Qe,[u[9]||(u[9]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793z","clip-rule":"evenodd"})],-1)),e("div",We,[e("input",{type:"range",min:"0",max:"1",step:"0.1",value:x.value,onInput:F,class:"volume-slider",disabled:!a.track.preview_url},null,40,Ze)]),e("span",et,t(Math.round(x.value*100))+"%",1)])])):g("",!0)]),a.showAnswer?(l(),n("div",tt,[e("div",st,[e("h4",at,t(a.track.name),1),e("p",lt,t(L.value),1),e("p",nt,t(a.track.album.name)+" ("+t(a.track.year)+")",1),e("p",ot,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"underline hover:no-underline"},t(a.$t("game.openInSpotify"))+" ↗ ",9,rt)])])])):g("",!0)])]),a.showAnswer?g("",!0):(l(),n("div",it,[e("p",ct,t(a.$t("game.turn.placing")),1),e("p",ut,t(a.$t("game.dragToTimeline")),1)])),a.showResult?(l(),n("div",{key:1,class:D(["mt-4 p-4 rounded-lg text-center",s.value])},[e("p",dt,t(o.value),1),a.pointsEarned>0?(l(),n("p",vt,t(a.$t("game.turn.points",{points:a.pointsEarned})),1)):g("",!0)],2)):g("",!0)]))}}),gt={class:"flex items-center justify-between mb-4"},pt={class:"text-lg font-semibold flex items-center space-x-2"},ft={key:0,class:"text-green-500"},ht={class:"text-right"},yt={class:"text-2xl font-bold"},bt={class:"flex items-center space-x-2 text-sm text-gray-600"},kt={key:0,class:"mb-4"},$t={class:"text-sm font-medium text-gray-700 mb-2"},_t={class:"flex space-x-2"},xt=["title"],wt=["title"],Tt={class:"mb-4"},Pt={class:"text-sm font-medium text-gray-700 mb-2"},Ct={key:0,class:"text-center py-8 text-gray-500"},Mt={class:"text-center text-gray-500"},At={key:1,class:"space-y-2"},St={class:"text-center text-gray-500 text-sm"},zt={class:"flex items-center space-x-3"},Bt={class:"w-12 h-12 rounded object-cover flex-shrink-0 relative"},Dt=["src","alt"],Lt={key:1,class:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center"},jt={class:"flex-1 min-w-0"},Rt={class:"font-medium truncate"},Vt={class:"text-sm text-gray-600 truncate"},It={class:"text-right flex-shrink-0"},Nt={class:"font-bold text-lg"},Et=["onDragover","onDragleave","onDrop"],Ft={class:"text-center text-gray-500 text-sm"},Ht={class:"text-center text-gray-500 text-sm"},Ut={class:"flex items-center space-x-3"},Ot={class:"flex-1 min-w-0"},qt={class:"font-medium text-blue-800"},Gt={class:"text-sm text-blue-600"},Jt={key:2,class:"mt-4 pt-4 border-t border-gray-200"},Xt={class:"flex justify-between text-sm text-gray-600"},Yt={key:0},Kt=X({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(N,{emit:V}){const i=N,C=V,c=T(!1),v=T([]),$=f(()=>{if(i.player.timeline.length<2)return null;const s=i.player.timeline.map(o=>o.year).sort((o,d)=>o-d);return`${s[0]} - ${s[s.length-1]}`});function P(s){var o,d,b,h;return((d=(o=s.images)==null?void 0:o[0])==null?void 0:d.url)||((h=(b=s.album.images)==null?void 0:b[0])==null?void 0:h.url)||"/placeholder-album.png"}function M(s){return s.artists.map(o=>o.name).join(", ")}function A(s){var d;if(!i.currentTrack)return;(d=s.dataTransfer)==null||d.setData("text/plain",JSON.stringify(i.currentTrack)),s.target.classList.add("dragging")}function x(s){s.target.classList.remove("dragging"),c.value=!1,v.value=[]}function y(s){!i.currentTrack||!i.canPlace||(c.value=!1,v.value=[],C("placeTrack",i.currentTrack,s))}function z(s){C("useToken",s)}function L(){v.value=new Array(i.player.timeline.length+1).fill(!1)}return te(()=>i.player.timeline.length,()=>{L()},{immediate:!0}),(s,o)=>(l(),n("div",{class:D(["card",{"ring-2 ring-green-500":s.isCurrent}])},[e("div",gt,[e("h3",pt,[e("span",null,t(s.player.name),1),s.isCurrent?(l(),n("span",ft,"👑")):g("",!0)]),e("div",ht,[e("p",yt,t(s.player.score),1),e("div",bt,[o[11]||(o[11]=e("span",null,"🎵",-1)),e("span",null,t(s.$t("game.score.tokens",{count:s.player.tokens})),1)])])]),s.isCurrent&&s.canPlace&&s.player.tokens>0?(l(),n("div",kt,[e("h4",$t,t(s.$t("game.tokenAbilities")),1),e("div",_t,[e("button",{onClick:o[0]||(o[0]=d=>z("skip")),class:"btn btn-sm bg-yellow-100 hover:bg-yellow-200 text-yellow-800",title:s.$t("game.tokens.skip.description")}," ⏭️ "+t(s.$t("game.tokens.skip.label")),9,xt),e("button",{onClick:o[1]||(o[1]=d=>z("hint")),class:"btn btn-sm bg-blue-100 hover:bg-blue-200 text-blue-800",title:s.$t("game.tokens.hint.description")}," 💡 "+t(s.$t("game.tokens.hint.label")),9,wt)])])):g("",!0),e("div",Tt,[e("h4",Pt,t(s.$t("game.timeline.title")),1),s.player.timeline.length===0?(l(),n("div",Ct,[e("p",null,t(s.$t("game.timeline.empty")),1),s.canPlace?(l(),n("div",{key:0,class:D(["timeline-slot mt-4",{"drag-over":c.value}]),onDragover:o[2]||(o[2]=w(d=>c.value=!0,["prevent"])),onDragleave:o[3]||(o[3]=w(d=>c.value=!1,["prevent"])),onDrop:o[4]||(o[4]=w(d=>y(0),["prevent"]))},[e("p",Mt,t(s.$t("game.timeline.placeHere")),1)],34)):g("",!0)])):(l(),n("div",At,[s.canPlace?(l(),n("div",{key:0,class:D(["timeline-slot h-16",{"drag-over":v.value[0]}]),onDragover:o[5]||(o[5]=w(d=>v.value[0]=!0,["prevent"])),onDragleave:o[6]||(o[6]=w(d=>v.value[0]=!1,["prevent"])),onDrop:o[7]||(o[7]=w(d=>y(0),["prevent"]))},[e("p",St,t(s.$t("game.placeEarlier")),1)],34)):g("",!0),(l(!0),n(q,null,G(s.player.timeline,(d,b)=>(l(),n("div",{key:d.id,class:"track-card"},[e("div",zt,[e("div",Bt,[d.revealed?(l(),n("img",{key:0,src:P(d),alt:d.name,class:"w-12 h-12 rounded object-cover"},null,8,Dt)):(l(),n("div",Lt,o[12]||(o[12]=[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",jt,[e("p",Rt,t(d.name),1),e("p",Vt,t(M(d)),1)]),e("div",It,[e("p",Nt,t(d.year),1)])]),s.canPlace&&b<s.player.timeline.length-1?(l(),n("div",{key:0,class:D(["timeline-slot h-16 mt-2",{"drag-over":v.value[b+1]}]),onDragover:w(h=>v.value[b+1]=!0,["prevent"]),onDragleave:w(h=>v.value[b+1]=!1,["prevent"]),onDrop:w(h=>y(b+1),["prevent"])},[e("p",Ft,t(s.$t("game.placeBetween")),1)],42,Et)):g("",!0)]))),128)),s.canPlace?(l(),n("div",{key:1,class:D(["timeline-slot h-16",{"drag-over":v.value[s.player.timeline.length]}]),onDragover:o[8]||(o[8]=w(d=>v.value[s.player.timeline.length]=!0,["prevent"])),onDragleave:o[9]||(o[9]=w(d=>v.value[s.player.timeline.length]=!1,["prevent"])),onDrop:o[10]||(o[10]=w(d=>y(s.player.timeline.length),["prevent"]))},[e("p",Ht,t(s.$t("game.placeLater")),1)],34)):g("",!0)]))]),s.canPlace&&s.currentTrack?(l(),n("div",{key:1,class:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg cursor-move",draggable:"true",onDragstart:A,onDragend:x},[e("div",Ut,[o[13]||(o[13]=e("div",{class:"w-12 h-12 rounded bg-blue-200 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",Ot,[e("p",qt,t(s.$t("game.newTrack")),1),e("p",Gt,t(s.$t("game.dragToPlace")),1)]),o[14]||(o[14]=e("div",{class:"text-blue-500"},[e("span",{class:"text-2xl"},"🎵")],-1))])],32)):g("",!0),s.player.timeline.length>0?(l(),n("div",Jt,[e("div",Xt,[e("span",null,t(s.$t("game.tracksInTimeline",{count:s.player.timeline.length})),1),$.value?(l(),n("span",Yt,t($.value),1)):g("",!0)])])):g("",!0)],2))}}),Qt={class:"min-h-screen flex flex-col"},Wt={class:"bg-white/10 backdrop-blur-sm p-4"},Zt={class:"flex justify-between items-center"},es={class:"flex items-center space-x-4"},ts={class:"text-white"},ss={class:"text-xl font-bold"},as={class:"text-sm opacity-80"},ls={class:"text-white text-right"},ns={class:"text-sm opacity-80"},os={class:"flex-1 container mx-auto px-4 py-6"},rs={key:0,class:"max-w-2xl mx-auto"},is={class:"card text-center"},cs={class:"text-2xl font-semibold mb-4"},us={class:"text-gray-600 mb-6"},ds={key:1,class:"space-y-6"},vs={class:"card text-center bg-green-50 border-green-200"},ms={class:"text-2xl font-bold text-green-800 mb-2"},gs={class:"text-green-700"},ps={key:0,class:"mt-4"},fs={key:1,class:"mt-4"},hs={class:"flex items-center justify-center space-x-2"},ys={key:0,class:"card bg-yellow-50 border-yellow-200"},bs={class:"flex items-center space-x-3"},ks={class:"flex-1"},$s={class:"text-lg font-semibold text-yellow-800"},_s={class:"text-yellow-700 text-sm"},xs={class:"flex space-x-2"},ws={key:1,class:"card bg-orange-50 border-orange-200"},Ts={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ps={class:"card"},Cs={class:"text-lg font-semibold mb-4"},Ms={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},As={class:"font-semibold"},Ss={class:"text-2xl font-bold text-green-600"},zs={class:"text-sm text-gray-600"},Bs={class:"text-xs text-gray-500"},Ds={key:2,class:"max-w-2xl mx-auto"},Ls={class:"card text-center"},js={class:"text-3xl font-bold mb-4 text-green-600"},Rs={class:"text-xl mb-6"},Vs={class:"mb-6"},Is={class:"text-lg font-semibold mb-3"},Ns={class:"space-y-2"},Es={class:"font-medium"},Fs={class:"font-bold"},Hs={class:"flex space-x-4 justify-center"},Os=X({__name:"GameView",setup(N){const V=re(),i=oe(),C=T(!1),c=T(k.isAuthenticated()),v=f(()=>i.players),$=f(()=>i.currentPlayer),P=f(()=>i.currentTrack),M=f(()=>i.gamePhase),A=f(()=>i.round),x=f(()=>i.settings),y=f(()=>i.winner),z=f(()=>c.value),L=f(()=>z.value&&!k.isPlayerReady()),s=f(()=>[...v.value].sort((r,m)=>m.tokens!==r.tokens?m.tokens-r.tokens:m.score-r.score));async function o(){C.value=!0;try{await i.getNextTrack()||console.error("No tracks available")}catch(r){console.error("Error loading track:",r)}finally{C.value=!1}}function d(r,m){i.placeTrackOnTimeline(r,m),setTimeout(()=>{i.nextPlayer()},2e3)}function b(r){var R;if(!$.value)return;if(i.useToken($.value.id,r))switch(r){case"skip":o();break;case"hint":alert(`Hint: This track was released in the ${Math.floor(((R=P.value)==null?void 0:R.year)/10)*10}s`);break}}function h(){i.resetGame(),V.push("/")}function j(){V.push("/")}function B(){const r=k.isAuthenticated(),m=localStorage.getItem("spotify_auth");console.log("Spotify auth check:",{isAuthenticated:r,authStateInStorage:m?JSON.parse(m):null,currentValue:c.value}),c.value=r,r&&k.initializePlayerIfReady()}async function E(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await k.forceReauth()}return ee(()=>{i.gamePhase==="setup"&&i.players.length===0&&V.push("/"),B();const r=setInterval(()=>{B()},2e3);se(()=>{clearInterval(r)})}),(r,m)=>{var R,F,H,I;return l(),n("div",Qt,[e("header",Wt,[e("div",Zt,[e("div",es,[e("button",{onClick:m[0]||(m[0]=p=>r.$router.push("/")),class:"btn btn-secondary"}," ← "+t(r.$t("common.back")),1),e("div",ts,[e("h1",ss,t(r.$t("game.title")),1),e("p",as,t(r.$t("game.round"))+" "+t(A.value),1)])]),e("div",ls,[e("p",ns,t(r.$t("game.turn.currentPlayer",{player:(R=$.value)==null?void 0:R.name})),1)])])]),e("main",os,[M.value==="setup"?(l(),n("div",rs,[e("div",is,[e("h2",cs,t(r.$t("game.setupRequired")),1),e("p",us,t(r.$t("game.setupMessage")),1),e("button",{onClick:m[1]||(m[1]=p=>r.$router.push("/")),class:"btn btn-primary"},t(r.$t("game.backToSetup")),1)])])):M.value==="playing"?(l(),n("div",ds,[e("div",vs,[e("h2",ms,t(r.$t("game.turn.currentPlayer",{player:(F=$.value)==null?void 0:F.name})),1),e("p",gs,t(r.$t("game.turn.ready")),1),!P.value&&!C.value?(l(),n("div",ps,[e("button",{onClick:o,class:"btn btn-primary btn-lg"}," 🎵 "+t(r.$t("game.getTrack")),1)])):g("",!0),C.value?(l(),n("div",fs,[e("div",hs,[m[3]||(m[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,t(r.$t("common.loading")),1)])])):g("",!0)]),z.value?z.value&&L.value?(l(),n("div",ws,[e("div",{class:"flex items-center space-x-3"},[m[5]||(m[5]=ie('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:E,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):g("",!0):(l(),n("div",ys,[e("div",bs,[m[4]||(m[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ks,[e("h3",$s,t(r.$t("game.spotify.notConnected")),1),e("p",_s,t(r.$t("game.demoModeActive")),1)]),e("div",xs,[e("button",{onClick:j,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},t(r.$t("game.spotify.login")),1),e("button",{onClick:E,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:B,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),P.value?(l(),Z(mt,{key:2,track:P.value,difficulty:x.value.difficulty,onPlaceTrack:d},null,8,["track","difficulty"])):g("",!0),e("div",Ts,[(l(!0),n(q,null,G(v.value,p=>{var S,U;return l(),Z(Kt,{key:p.id,player:p,"is-current":p.id===((S=$.value)==null?void 0:S.id),"current-track":P.value,"can-place":p.id===((U=$.value)==null?void 0:U.id)&&!!P.value,onPlaceTrack:d,onUseToken:b},null,8,["player","is-current","current-track","can-place"])}),128))]),e("div",Ps,[e("h3",Cs,t(r.$t("game.score.title")),1),e("div",Ms,[(l(!0),n(q,null,G(v.value,p=>{var S;return l(),n("div",{key:p.id,class:D(["text-center p-3 rounded-lg",p.id===((S=$.value)==null?void 0:S.id)?"bg-green-100":"bg-gray-50"])},[e("p",As,t(p.name),1),e("p",Ss,t(p.tokens),1),e("p",zs,t(r.$t("game.score.tokens",{count:p.tokens})),1),e("p",Bs,t(r.$t("game.score.total",{score:p.score})),1)],2)}),128))])])])):M.value==="finished"?(l(),n("div",Ds,[e("div",Ls,[e("h2",js,t(r.$t("game.end.title")),1),e("p",Rs,t(r.$t("game.end.winner",{player:(H=y.value)==null?void 0:H.name,score:(I=y.value)==null?void 0:I.tokens})),1),e("div",Vs,[e("h3",Is,t(r.$t("game.end.finalScores")),1),e("div",Ns,[(l(!0),n(q,null,G(s.value,(p,S)=>(l(),n("div",{key:p.id,class:D(["flex justify-between items-center p-3 rounded-lg",S===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Es,t(S+1)+". "+t(p.name),1),e("span",Fs,t(p.tokens)+" "+t(r.$t("game.score.tokens",{count:p.tokens})),1)],2))),128))])]),e("div",Hs,[e("button",{onClick:h,class:"btn btn-primary"}," 🔄 "+t(r.$t("game.end.playAgain")),1),e("button",{onClick:m[2]||(m[2]=p=>r.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+t(r.$t("game.backToHome")),1)])])])):g("",!0)])])}}});export{Os as default};
