import{d as ue,n as ge,r as v,c as y,s as k,o as ae,a as se,p as ce,w as oe,b as i,e,g as h,q as le,t as o,f as re,x as A,k as n,y as me,h as E,F as ne,j as ie,T as pe,u as ve,l as fe,z as be}from"./index-IZf9UYJ6.js";const he={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},ye={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},ke={class:"flex-shrink-0"},xe={key:0,class:"relative group"},we={key:1,class:"relative group"},$e=["src","alt"],_e={class:"flex-1 text-center md:text-left"},Ce={class:"mb-3"},Te={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Pe={class:"text-xs text-gray-400 mt-1 font-light"},De={class:"mb-3"},Ee={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Ie={class:"flex items-center justify-between mb-3"},Se={class:"flex items-center"},Ae={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},Me={class:"text-left space-y-2"},je={class:"text-amber-200 text-xs font-medium"},Ne={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},ze={class:"text-amber-100 font-medium mb-2"},Be={class:"text-amber-200 space-y-1 list-decimal list-inside"},Re={class:"flex justify-center space-x-3 mt-4"},Ve=["disabled"],Le={key:0,class:"flex items-center"},Oe={key:1},Fe={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},He={class:"flex items-center justify-center mb-2"},Ue={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},Ge={class:"text-green-200 text-xs"},qe={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},We={class:"flex items-center justify-center mb-2"},Ye={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Ke={class:"text-blue-200 text-xs"},Qe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},Je={class:"flex items-center justify-center space-x-4 mb-3"},Xe=["disabled"],Ze={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},et={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},tt={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},st={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ot={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},at={class:"text-center"},lt={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},rt={class:"text-blue-200 text-sm font-medium mb-1"},nt={class:"text-blue-300 text-sm font-medium"},it={class:"text-sm text-blue-400 mt-3"},ut=["href"],dt={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},ct={class:"text-center"},mt={class:"flex items-center justify-center mb-2"},gt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},pt={class:"text-purple-200 text-xs font-medium"},vt={class:"flex items-center justify-center mb-2"},ft={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},bt={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},ht={class:"font-bold text-lg"},yt={key:0,class:"text-sm mt-1 font-semibold"},kt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},xt=ue({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(q,{emit:G}){const r=q,{t:M}=ge(),c=v(!1),w=v(!1);v(!1);const p=v(0),$=v(0);v(.7),v(!1),v(!1),v(!1);const m=v(null),C=v(!1),V=y(()=>{var I,T,P,H;const a=(T=(I=r.track.images)==null?void 0:I[0])==null?void 0:T.url,u=(H=(P=r.track.album.images)==null?void 0:P[0])==null?void 0:H.url;return a||u||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),f=y(()=>r.track.artists.map(a=>a.name).join(", ")),l=y(()=>r.showResult?r.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),_=y(()=>r.showResult?r.isCorrect?M("game.turn.correct",{year:r.track.year}):M("game.turn.incorrect",{year:r.track.year}):"");y(()=>$.value===0?0:p.value/$.value*100);const S=y(()=>!!r.track.uri),O=y(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),j=y(()=>O.value?S.value&&k.isAuthenticated():S.value&&k.isPlayerReady()),B=y(()=>j.value);async function R(){w.value=!0,m.value=null,C.value=!1;try{if(!await k.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");j.value&&r.track.uri&&(c.value?await k.pausePlayback()&&(c.value=!1):await k.startPlayback(r.track.uri)&&(c.value=!0,O.value?N():Q()))}catch(a){console.error("Playback error:",a),a.message==="NO_DEVICES_AVAILABLE"?(m.value="NO_DEVICES",C.value=!0):a.message==="DEVICE_NOT_FOUND"||a.message==="DEVICE_BECAME_INACTIVE"?(m.value="DEVICE_INACTIVE",C.value=!0):a.message==="PREMIUM_REQUIRED"?m.value="PREMIUM_REQUIRED":a.message==="DEVICE_ACTIVATION_FAILED"?(m.value="ACTIVATION_FAILED",C.value=!0):a.message.includes("No active Spotify device")||a.message.includes("No Spotify devices available")?(m.value="DEVICE_INACTIVE",C.value=!0):m.value="PLAYBACK_FAILED"}finally{w.value=!1}}function F(){C.value=!1,m.value=null}async function Y(){C.value=!1,m.value=null,await R()}function N(){const a=async()=>{var I;if(!j.value||!O.value)return;await k.keepSpotifyConnectActive();const u=await k.getSpotifyConnectState();if(u){const T=((I=u.item)==null?void 0:I.uri)===r.track.uri,P=u.is_playing&&T;c.value!==P&&(c.value=P),c.value&&setTimeout(a,5e3)}else c.value&&(console.log("🔇 No active playback detected - device may have become inactive"),c.value=!1,!C.value&&!m.value&&await k.hasAvailableDevices()&&(m.value="DEVICE_INACTIVE",C.value=!0))};a()}function Q(){const a=async()=>{if(!j.value)return;const u=await k.getPlaybackState();u&&(c.value=!u.paused,p.value=u.position/1e3,$.value=u.duration/1e3,c.value&&setTimeout(a,1e3))};a()}async function J(){var a,u,I,T;if(k.isPlayerReady())try{const P=await k.getPlaybackState();if(P){const H=((u=(a=P.track_window)==null?void 0:a.current_track)==null?void 0:u.uri)===r.track.uri,U=P.paused===!1&&H;console.log("Playback state check:",{paused:P.paused,currentTrackUri:(T=(I=P.track_window)==null?void 0:I.current_track)==null?void 0:T.uri,expectedUri:r.track.uri,isCurrentTrack:H,isActuallyPlaying:U,componentIsPlaying:c.value}),c.value!==U&&(console.log(`🔄 Syncing playback state: ${c.value} → ${U}`),c.value=U)}}catch(P){console.warn("Could not check playback state:",P)}}return ae(()=>{const a=setInterval(J,2e3);se(()=>{clearInterval(a)})}),ae(()=>{k.isAuthenticated()&&ce(()=>{k.initializePlayerIfReady()})}),oe(()=>r.track,async(a,u)=>{if(a&&a!==u){console.log("New track detected:",a.name),m.value=null,C.value=!1,await ce(),c.value=!1;const I=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:B.value,canPlayFullTrack:j.value,hasSpotifyUri:S.value,isPlayerReady:k.isPlayerReady(),isPlaying:c.value}),B.value&&!c.value){console.log("Auto-starting playback for new track:",a.name);try{await k.ensurePlaybackReady()?(await R(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(T){I?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",T)}}else{const T=B.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${T}`),!I&&S.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),se(()=>{j.value&&k.stopPlayback()}),(a,u)=>(n(),i("div",he,[u[13]||(u[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",ye,[e("div",ke,[a.showAnswer?(n(),i("div",we,[e("img",{src:V.value,alt:a.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,$e),u[1]||(u[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(n(),i("div",xe,u[0]||(u[0]=[le('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",_e,[e("div",Ce,[e("p",Te,o(a.$t("game.turn.listening")),1),e("p",Pe,o(a.$t("game.turn.placeOnTimeline")),1)]),e("div",De,[C.value?(n(),i("div",Ee,[e("div",Ie,[e("div",Se,[u[2]||(u[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",Ae,o(m.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):m.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):m.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):a.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:F,class:"text-amber-300 hover:text-amber-100 transition-colors"},u[3]||(u[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Me,[e("p",je,o(m.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):m.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):m.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):a.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",Ne,[e("p",ze,o(a.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",Be,[e("li",null,o(a.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",Re,[e("button",{onClick:Y,disabled:w.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(n(),i("span",Le,[u[4]||(u[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),re(" "+o(a.$t("game.deviceHelp.retrying","Retrying...")),1)])):(n(),i("span",Oe,o(a.$t("game.deviceHelp.retry","Try Again")),1))],8,Ve),e("button",{onClick:F,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},o(a.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):h("",!0),!B.value&&O.value&&S.value?(n(),i("div",Fe,[e("div",He,[u[5]||(u[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",Ue,o(a.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",Ge,o(a.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):j.value?h("",!0):(n(),i("div",qe,[e("div",We,[u[6]||(u[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ye,o(S.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",Ke,o(S.value?a.$t("game.needsPremium"):a.$t("game.needSpotifyForAudio")),1)])),B.value?(n(),i("div",Qe,[e("div",Je,[e("button",{onClick:R,class:"play-btn group relative",disabled:!B.value},[e("div",Ze,[w.value?(n(),i("div",et)):c.value?(n(),i("svg",tt,u[7]||(u[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(n(),i("svg",st,u[8]||(u[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,Xe)])])):h("",!0)]),a.showAnswer?(n(),i("div",ot,[e("div",at,[e("h4",lt,o(a.track.name),1),e("p",rt,o(f.value),1),e("p",nt,o(a.track.album.name)+" ("+o(a.track.year)+")",1),e("p",it,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[u[9]||(u[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),re(" "+o(a.$t("game.openInSpotify")),1)],8,ut)])])])):h("",!0)])]),a.showAnswer?h("",!0):(n(),i("div",dt,[e("div",ct,[e("div",mt,[u[10]||(u[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",gt,o(a.$t("game.turn.placing")),1)]),e("p",pt,o(O.value?a.$t("game.timeline.mobileInstructions"):a.$t("game.dragToTimeline")),1)])])),a.showResult?(n(),i("div",{key:1,class:A(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",l.value])},[e("div",vt,[a.isCorrect?(n(),i("div",ft,u[11]||(u[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(n(),i("div",bt,u[12]||(u[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",ht,o(_.value),1)]),a.pointsEarned>0?(n(),i("p",yt,[e("span",kt,o(a.$t("game.turn.points",{points:a.pointsEarned})),1)])):h("",!0)],2)):h("",!0)]))}}),wt=(q,G)=>{const r=q.__vccOpts||q;for(const[M,c]of G)r[M]=c;return r},$t=wt(xt,[["__scopeId","data-v-03b041d1"]]),_t={key:0,class:"absolute inset-0 opacity-10"},Ct={class:"relative z-10"},Tt={class:"flex items-center justify-between mb-6"},Pt={class:"text-xl font-bold flex items-center space-x-3"},Dt={key:0,class:"text-2xl animate-bounce"},Et={class:"text-right"},It={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},St={class:"flex items-center space-x-2 text-sm text-gray-300"},At={class:"font-medium"},Mt={key:0,class:"mb-6"},jt={class:"text-sm font-medium text-gray-300 mb-3"},Nt={class:"flex space-x-3"},zt=["title"],Bt={class:"flex items-center space-x-2"},Rt=["title"],Vt={class:"flex items-center space-x-2"},Lt={class:"mb-6"},Ot={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Ft={key:0,class:"text-center py-12 text-gray-400"},Ht={class:"text-lg font-medium mb-2"},Ut={class:"text-center text-gray-300 font-medium"},Gt={key:1,class:"space-y-3"},qt={class:"text-center text-gray-400 text-sm font-medium"},Wt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},Yt={class:"flex items-center space-x-4"},Kt={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},Qt=["src","alt"],Jt={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},Xt={class:"flex-1 min-w-0"},Zt={class:"font-bold text-lg text-gray-100 truncate"},es={class:"text-sm text-gray-300 truncate font-medium"},ts={class:"text-right flex-shrink-0"},ss={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},os=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],as={class:"text-center text-gray-400 text-sm font-medium"},ls=["data-drop-zone"],rs={class:"text-center text-gray-400 text-sm font-medium"},ns=["draggable"],is={class:"flex items-center space-x-4"},us={class:"flex-1 min-w-0"},ds={class:"font-bold text-lg text-blue-200"},cs={class:"text-sm text-blue-300 font-medium"},ms={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},gs={class:"flex justify-between text-sm text-gray-300"},ps={class:"font-medium"},vs={key:0,class:"font-mono"},fs={class:"flex items-center space-x-3 mb-4"},bs={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},hs={class:"mb-6"},ys={class:"text-gray-200 text-lg leading-relaxed"},ks={class:"flex space-x-3"},xs=ue({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(q,{emit:G}){const r=q,M=G,c=v(!1),w=v([]),p=v(null),$=v(!1);v({isPressed:!1,action:""}),v(!0);const m=v([]),C=v("");v(0);function V(t){const d=`[${new Date().toLocaleTimeString()}] ${t}`;m.value.unshift(d),C.value=d,console.log("MOBILE_DEBUG:",d),m.value.length>10&&(m.value=m.value.slice(0,10))}function f(t,s){const x=`[${new Date().toLocaleTimeString()}] ${t}`;console.log("🎵 TIMELINE_DEBUG:",x,s||""),V(x)}const l=y(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),_=y(()=>"ontouchstart"in window);y(()=>navigator.maxTouchPoints||0),y(()=>navigator.userAgent),y(()=>`${window.innerWidth}x${window.innerHeight}`),f("PlayerTimeline component initialized",{isMobile:l.value,touchSupport:_.value}),console.log("COMPONENT MOUNTED - JS DEFINITELY WORKING"),l.value&&console.log("MOBILE DEVICE DETECTED - Touch events should work");const S=y(()=>{var d;const t=((d=r.player)==null?void 0:d.timeline)||[];if(t.length<2)return null;const s=t.map(x=>x.year).sort((x,z)=>x-z);return`${s[0]} - ${s[s.length-1]}`});function O(t){var s,d;return t.images&&t.images.length>0&&((s=t.images[0])!=null&&s.url)?t.images[0].url:t.album&&t.album.images&&t.album.images.length>0&&((d=t.album.images[0])!=null&&d.url)?t.album.images[0].url:"/placeholder-album.png"}function j(t){return t.artists.map(s=>s.name).join(", ")}function B(t){var d;if(!r.currentTrack)return;(d=t.dataTransfer)==null||d.setData("text/plain",JSON.stringify(r.currentTrack)),t.target.classList.add("dragging")}function R(t){t.target.classList.remove("dragging"),c.value=!1,w.value=[]}function F(t){!r.currentTrack||!r.canPlace||(c.value=!1,w.value=[],M("placeTrack",r.currentTrack,t))}function Y(t){M("useToken",t)}function N(t){if(f(`Timeline slot touched: position ${t}`),!r.currentTrack||!r.canPlace){f("Cannot place track",{hasCurrentTrack:!!r.currentTrack,canPlace:r.canPlace});return}p.value=t,$.value=!0,f("Dialog should open",{position:p.value,showConfirmation:$.value}),"vibrate"in navigator&&(navigator.vibrate(50),f("Haptic feedback triggered")),setTimeout(()=>{const s=document.querySelector('[style*="z-index: 99999"]');f("Dialog element check",{found:!!s,visible:s?getComputedStyle(s).display:"not found"})},100)}function Q(t){var x;if(t===null)return"";const s=((x=r.player)==null?void 0:x.timeline)||[],d=s.length;return t===0?d===0?"Place as your first track":`Place before ${s[0].name} (${s[0].year})`:t===d?`Place after ${s[d-1].name} (${s[d-1].year})`:`Place between ${s[t-1].name} (${s[t-1].year}) and ${s[t].name} (${s[t].year})`}function J(){"vibrate"in navigator&&navigator.vibrate(50)}function a(t){var s;f("Cancel button clicked (main handler)",{eventType:t.type,target:(s=t.target)==null?void 0:s.tagName}),t.preventDefault(),t.stopPropagation(),U()}function u(t){var s;f("Confirm button clicked (main handler)",{eventType:t.type,target:(s=t.target)==null?void 0:s.tagName}),t.preventDefault(),t.stopPropagation(),ee()}function I(t){var d;f("Cancel touch start",{touches:t.touches.length,target:(d=t.target)==null?void 0:d.tagName}),t.preventDefault();const s=t.target;s.style.transform="scale(0.95)",s.style.opacity="0.8",f("Cancel touch visual feedback applied")}function T(t){f("Cancel touch end"),t.preventDefault();const s=t.target;s.style.transform="",s.style.opacity="",setTimeout(()=>U(),50)}function P(t){var d;f("Confirm touch start",{touches:t.touches.length,target:(d=t.target)==null?void 0:d.tagName}),t.preventDefault();const s=t.target;s.style.transform="scale(0.95)",s.style.opacity="0.8",f("Confirm touch visual feedback applied")}function H(t){f("Confirm touch end"),t.preventDefault();const s=t.target;s.style.transform="",s.style.opacity="",setTimeout(()=>ee(),50)}function U(){f("Performing cancel action",{currentPosition:p.value,dialogShown:$.value}),"vibrate"in navigator&&navigator.vibrate(50),p.value=null,$.value=!1,f("Cancel completed",{position:p.value,dialogShown:$.value})}function ee(){var t;f("Performing confirm action",{position:p.value,hasTrack:!!r.currentTrack,trackName:(t=r.currentTrack)==null?void 0:t.name}),"vibrate"in navigator&&navigator.vibrate(100),p.value!==null&&r.currentTrack?(f("Emitting placeTrack event",{position:p.value,trackName:r.currentTrack.name}),M("placeTrack",r.currentTrack,p.value),p.value=null,$.value=!1,f("Confirm completed successfully")):f("Confirm failed - missing data",{position:p.value,hasTrack:!!r.currentTrack})}function K(){f("Dialog background clicked - ignoring to prevent accidental dismissal")}function te(){var s;const t=((s=r.player)==null?void 0:s.timeline)||[];w.value=new Array(t.length+1).fill(!1)}return se(()=>{}),oe(()=>{var t;return(((t=r.player)==null?void 0:t.timeline)||[]).length},()=>{te()},{immediate:!0}),oe($,(t,s)=>{f(`Dialog state changed: ${s} → ${t}`,{position:p.value,mobile:l.value,timestamp:Date.now()}),t&&setTimeout(()=>{const d=document.querySelectorAll('[style*="z-index: 99999"]');f("Dialog render check",{dialogCount:d.length,bodyChildren:document.body.children.length})},50)}),(t,s)=>{var d,x,z,L;return n(),i("div",{class:A(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":t.isCurrent}])},[t.isCurrent?(n(),i("div",_t,s[21]||(s[21]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):h("",!0),e("div",Ct,[e("div",Tt,[e("h3",Pt,[e("span",{class:A(t.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},o(t.player.name),3),t.isCurrent?(n(),i("span",Dt,"👑")):h("",!0)]),e("div",Et,[e("p",It,o(t.player.score),1),e("div",St,[s[22]||(s[22]=e("span",{class:"text-lg"},"🎵",-1)),e("span",At,o(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(n(),i("div",Mt,[e("h4",jt,o(t.$t("game.tokenAbilities")),1),e("div",Nt,[e("button",{onClick:s[0]||(s[0]=g=>Y("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:t.$t("game.tokens.skip.description")},[e("div",Bt,[s[23]||(s[23]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,o(t.$t("game.tokens.skip.label")),1)])],8,zt),e("button",{onClick:s[1]||(s[1]=g=>Y("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:t.$t("game.tokens.hint.description")},[e("div",Vt,[s[24]||(s[24]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,o(t.$t("game.tokens.hint.label")),1)])],8,Rt)])])):h("",!0),e("div",Lt,[e("h4",Ot,[s[25]||(s[25]=e("span",{class:"mr-2"},"🎵",-1)),re(" "+o(t.$t("game.timeline.title")),1)]),!t.player.timeline||t.player.timeline.length===0?(n(),i("div",Ft,[s[26]||(s[26]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Ht,o(t.$t("game.timeline.empty")),1),t.canPlace?(n(),i("div",{key:0,class:A(["timeline-slot mt-6 group",{"drag-over":!l.value&&c.value,selected:p.value===0&&l.value}]),onDragover:s[2]||(s[2]=E(g=>l.value?null:c.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=E(g=>l.value?null:c.value=!1,["prevent"])),onDrop:s[4]||(s[4]=E(g=>l.value?null:F(0),["prevent"])),onTouchstart:s[5]||(s[5]=E(g=>l.value?N(0):null,["prevent"])),onClick:s[6]||(s[6]=g=>l.value?N(0):null),"data-drop-zone":0},[e("div",{class:A(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":p.value===0&&l.value}])},[e("p",Ut,o(l.value?t.$t("game.timeline.tapToSelect"):t.$t("game.timeline.placeHere")),1)],2)],34)):h("",!0)])):t.player.timeline&&t.player.timeline.length>0?(n(),i("div",Gt,[t.canPlace?(n(),i("div",{key:0,class:A(["timeline-slot h-20 group",{"drag-over":!l.value&&w.value[0],selected:p.value===0&&l.value}]),onDragover:s[7]||(s[7]=E(g=>l.value?null:w.value[0]=!0,["prevent"])),onDragleave:s[8]||(s[8]=E(g=>l.value?null:w.value[0]=!1,["prevent"])),onDrop:s[9]||(s[9]=E(g=>l.value?null:F(0),["prevent"])),onTouchstart:s[10]||(s[10]=E(g=>l.value?N(0):null,["prevent"])),onClick:s[11]||(s[11]=g=>l.value?N(0):null),"data-drop-zone":0},[e("div",{class:A(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":p.value===0&&l.value}])},[e("p",qt,o(l.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeEarlier")),1)],2)],34)):h("",!0),(n(!0),i(ne,null,ie(t.player.timeline||[],(g,b)=>{var X;return n(),i("div",{key:g.id,class:"track-card group relative"},[e("div",Wt,[e("div",Yt,[e("div",Kt,[g.revealed?(n(),i("img",{key:0,src:O(g),alt:g.name,class:"w-16 h-16 object-cover"},null,8,Qt)):(n(),i("div",Jt,s[27]||(s[27]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",Xt,[e("p",Zt,o(g.name),1),e("p",es,o(j(g)),1)]),e("div",ts,[e("p",ss,o(g.year),1)])])]),t.canPlace&&b<(((X=t.player.timeline)==null?void 0:X.length)||0)-1?(n(),i("div",{key:0,class:A(["timeline-slot h-20 mt-3 group",{"drag-over":w.value[b+1],selected:p.value===b+1&&l.value}]),onDragover:E(W=>w.value[b+1]=!0,["prevent"]),onDragleave:E(W=>w.value[b+1]=!1,["prevent"]),onDrop:E(W=>F(b+1),["prevent"]),onTouchstart:E(W=>l.value?N(b+1):null,["prevent"]),onClick:W=>l.value?N(b+1):null,"data-drop-zone":b+1},[e("div",{class:A(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":p.value===b+1&&l.value}])},[e("p",as,o(l.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeBetween")),1)],2)],42,os)):h("",!0)])}),128)),t.canPlace?(n(),i("div",{key:1,class:A(["timeline-slot h-20 group",{"drag-over":!l.value&&w.value[((d=t.player.timeline)==null?void 0:d.length)||0],selected:p.value===(((x=t.player.timeline)==null?void 0:x.length)||0)&&l.value}]),onDragover:s[12]||(s[12]=E(g=>{var b;return l.value?null:w.value[((b=t.player.timeline)==null?void 0:b.length)||0]=!0},["prevent"])),onDragleave:s[13]||(s[13]=E(g=>{var b;return l.value?null:w.value[((b=t.player.timeline)==null?void 0:b.length)||0]=!1},["prevent"])),onDrop:s[14]||(s[14]=E(g=>{var b;return l.value?null:F(((b=t.player.timeline)==null?void 0:b.length)||0)},["prevent"])),onTouchstart:s[15]||(s[15]=E(g=>{var b;return l.value?N(((b=t.player.timeline)==null?void 0:b.length)||0):null},["prevent"])),onClick:s[16]||(s[16]=g=>{var b;return l.value?N(((b=t.player.timeline)==null?void 0:b.length)||0):null}),"data-drop-zone":((z=t.player.timeline)==null?void 0:z.length)||0},[e("div",{class:A(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":p.value===(((L=t.player.timeline)==null?void 0:L.length)||0)&&l.value}])},[e("p",rs,o(l.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeLater")),1)],2)],42,ls)):h("",!0)])):h("",!0)])]),t.canPlace&&t.currentTrack?(n(),i("div",{key:1,class:A(["timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",l.value?"cursor-pointer":"cursor-move"]),draggable:!l.value,onDragstart:s[17]||(s[17]=g=>l.value?null:B),onDragend:s[18]||(s[18]=g=>l.value?null:R),onClick:s[19]||(s[19]=g=>l.value?J:null)},[e("div",is,[s[28]||(s[28]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",us,[e("p",ds,o(t.$t("game.newTrack")),1),e("p",cs,o(l.value?t.$t("game.tapToPlace"):t.$t("game.dragToPlace")),1)]),s[29]||(s[29]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],42,ns)):h("",!0),t.player.timeline&&t.player.timeline.length>0?(n(),i("div",ms,[e("div",gs,[e("span",ps,o(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),S.value?(n(),i("span",vs,o(S.value),1)):h("",!0)])])):h("",!0),$.value&&l.value?(n(),me(pe,{key:3,to:"body"},[e("div",{class:"fixed inset-0 bg-black/70 flex items-center justify-center p-4",style:{"z-index":"99999"},onClick:K},[e("div",{class:"bg-slate-900 border border-purple-500/20 rounded-2xl p-6 max-w-sm w-full mx-auto shadow-2xl",style:{"z-index":"100000"},onClick:s[20]||(s[20]=E(()=>{},["stop"]))},[e("div",fs,[s[30]||(s[30]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",bs,o(t.$t("game.timeline.selectedPosition")),1)]),e("div",hs,[e("p",ys,o(Q(p.value)),1)]),e("div",ks,[e("button",{onClick:a,onTouchstart:I,onTouchend:T,class:"flex-1 bg-red-600 hover:bg-red-700 text-white p-4 rounded-xl text-center font-bold transition-colors text-lg shadow-lg",style:{"min-height":"60px","touch-action":"manipulation"}}," ❌ "+o(t.$t("common.cancel")),33),e("button",{onClick:u,onTouchstart:P,onTouchend:H,class:"flex-1 bg-green-600 hover:bg-green-700 text-white p-4 rounded-xl text-center font-bold transition-colors text-lg shadow-lg",style:{"min-height":"60px","touch-action":"manipulation"}}," ✅ "+o(t.$t("common.confirm")),33)])])])])):h("",!0)],2)}}}),ws={class:"min-h-screen flex flex-col"},$s={class:"bg-white/10 backdrop-blur-sm p-4"},_s={class:"flex justify-between items-center"},Cs={class:"flex items-center space-x-4"},Ts={class:"text-white"},Ps={class:"text-xl font-bold"},Ds={class:"flex items-center space-x-3 text-sm opacity-80"},Es={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},Is={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},Ss={class:"text-white text-right"},As={class:"text-sm opacity-80"},Ms={class:"flex-1 container mx-auto px-4 py-6"},js={key:0,class:"max-w-2xl mx-auto"},Ns={class:"card text-center"},zs={class:"text-2xl font-semibold mb-4"},Bs={class:"text-gray-600 mb-6"},Rs={key:1,class:"space-y-6"},Vs={class:"card text-center bg-green-50 border-green-200"},Ls={class:"text-2xl font-bold text-white mb-2"},Os={class:"text-white"},Fs={key:0,class:"mt-4"},Hs={key:1,class:"mt-4"},Us={class:"flex items-center justify-center space-x-2"},Gs={key:0,class:"card bg-yellow-50 border-yellow-200"},qs={class:"flex items-center space-x-3"},Ws={class:"flex-1"},Ys={class:"text-lg font-semibold text-yellow-800"},Ks={class:"text-yellow-700 text-sm"},Qs={class:"flex space-x-2"},Js={key:1,class:"card bg-orange-50 border-orange-200"},Xs={key:2,class:"card bg-blue-50 border-blue-200"},Zs={key:4,class:"text-center mb-6"},eo={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},to={class:"mb-4"},so={class:"flex items-center justify-center mb-3"},oo={class:"text-center"},ao={class:"text-2xl font-bold text-red-200 mb-2"},lo={class:"text-red-100"},ro={class:"text-lg font-semibold"},no={class:"text-base"},io={class:"text-sm opacity-90"},uo={class:"text-red-200 text-lg mb-4"},co={class:"text-red-300 text-sm"},mo={key:5,class:"max-w-4xl mx-auto"},go={class:"card"},po={class:"text-lg font-semibold mb-4 text-gray-100"},vo={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},fo={class:"font-semibold text-gray-800"},bo={class:"text-2xl font-bold text-gray-900"},ho={class:"text-sm text-gray-600"},yo={class:"text-xs text-gray-500"},ko={key:2,class:"max-w-2xl mx-auto"},xo={class:"card text-center"},wo={class:"text-3xl font-bold mb-4 text-white"},$o={class:"text-xl mb-6"},_o={class:"mb-6"},Co={class:"text-lg font-semibold mb-3"},To={class:"space-y-2"},Po={class:"font-medium text-gray-800"},Do={class:"font-bold text-gray-800"},Eo={class:"flex space-x-4 justify-center"},Io={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},So={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Ao={class:"relative z-10"},Mo={class:"flex items-center space-x-3 mb-6"},jo={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},No={class:"mb-8"},zo={class:"text-gray-200 text-lg leading-relaxed"},Bo={class:"flex justify-center"},Vo=ue({__name:"GameView",setup(q){const G=fe(),r=ve(),M=v(!1),c=v(!1),w=v(""),p=v(k.isAuthenticated()),$=v(!1),m=v(!1),C=v(!1),V=v({isCorrect:!1,pointsEarned:0}),f=y(()=>r.players),l=y(()=>r.currentPlayer),_=y(()=>r.currentTrack),S=y(()=>r.gamePhase),O=y(()=>r.round),j=y(()=>r.settings),B=y(()=>r.winner),R=y(()=>p.value),F=y(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),Y=y(()=>R.value?!k.isPlayerReady()&&Q.value>3e4:!1),N=v(Date.now()),Q=y(()=>Date.now()-N.value),J=y(()=>[...f.value].sort((t,s)=>{var z,L;const d=((z=t.timeline)==null?void 0:z.length)||0,x=((L=s.timeline)==null?void 0:L.length)||0;return x!==d?x-d:s.tokens!==t.tokens?s.tokens-t.tokens:s.score-t.score}));async function a(){var t;M.value=!0,$.value=!1,m.value=!1,V.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const s=await r.getNextTrack();s?console.log("Track loaded successfully:",s.name,"by",(t=s.artists[0])==null?void 0:t.name):console.error("No tracks available")}catch(s){console.error("Error loading track:",s)}finally{M.value=!1}}function u(t,s){const d=r.placeTrackOnTimeline(t,s);let x=0;d&&l.value&&(x=1,l.value.timeline.length>=5&&(x=2),l.value.timeline.length>=8&&(x=3)),V.value={isCorrect:d,pointsEarned:x},$.value=!0,setTimeout(()=>{m.value=!0},500),d?setTimeout(()=>{$.value=!1,m.value=!1,r.nextPlayer()},4e3):setTimeout(()=>{if(C.value=!0,l.value&&_.value){const z=I(_.value,l.value.timeline),L={..._.value,revealed:!0};r.addTrackToTimelineAtPosition(L,z)}},1500)}function I(t,s){for(let d=0;d<s.length;d++)if(t.year<=s[d].year)return d;return s.length}function T(){_.value&&l.value&&r.removeTrackFromTimeline(_.value.id),$.value=!1,m.value=!1,C.value=!1,r.nextPlayer()}function P(t){var d;if(!l.value)return;if(r.useToken(l.value.id,t))switch(t){case"skip":a();break;case"hint":const x=Math.floor(((d=_.value)==null?void 0:d.year)/10)*10;w.value=`This track was released in the ${x}s`,c.value=!0;break}}function H(){c.value=!1,w.value=""}function U(){r.resetGame(),G.push("/")}function ee(){G.push("/")}function K(){const t=k.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:t,previousState:R.value}),p.value!==t&&(p.value=t,console.log("Spotify auth state updated:",t)),t&&!k.isPlayerReady()&&(console.log("Initializing player after auth check"),k.initializePlayerIfReady())}async function te(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await k.forceReauth(),K()}return ae(()=>{r.gamePhase==="setup"&&r.players.length===0&&G.push("/"),K(),k.isAuthenticated()&&k.startSessionMaintenance();const t=setInterval(()=>{p.value?k.startSessionMaintenance():K()},12e4);se(()=>{clearInterval(t),k.stopSessionMaintenance()})}),oe(_,t=>{t&&($.value=!1,m.value=!1,V.value={isCorrect:!1,pointsEarned:0})}),(t,s)=>{var d,x,z,L,g,b,X,W;return n(),i("div",ws,[e("header",$s,[e("div",_s,[e("div",Cs,[e("button",{onClick:s[0]||(s[0]=D=>t.$router.push("/")),class:"btn btn-secondary"}," ← "+o(t.$t("common.back")),1),e("div",Ts,[e("h1",Ps,o(t.$t("game.title")),1),e("div",Ds,[e("span",null,o(t.$t("game.round"))+" "+o(O.value),1),j.value.theme?(n(),i("span",Es," 🎵 "+o(t.$t(`game.themes.${j.value.theme}`)),1)):(n(),i("span",Is," 🎵 "+o(t.$t("game.allMusic")),1))])])]),e("div",Ss,[e("p",As,o(t.$t("game.turn.currentPlayer",{player:(d=l.value)==null?void 0:d.name})),1)])])]),e("main",Ms,[S.value==="setup"?(n(),i("div",js,[e("div",Ns,[e("h2",zs,o(t.$t("game.setupRequired")),1),e("p",Bs,o(t.$t("game.setupMessage")),1),e("button",{onClick:s[1]||(s[1]=D=>t.$router.push("/")),class:"btn btn-primary"},o(t.$t("game.backToSetup")),1)])])):S.value==="playing"?(n(),i("div",Rs,[e("div",Vs,[e("h2",Ls,o(t.$t("game.turn.currentPlayer",{player:(x=l.value)==null?void 0:x.name})),1),e("p",Os,o(t.$t("game.turn.ready")),1),!_.value&&!M.value?(n(),i("div",Fs,[e("button",{onClick:a,class:"btn btn-primary btn-lg"}," 🎵 "+o(t.$t("game.getTrack")),1)])):h("",!0),M.value?(n(),i("div",Hs,[e("div",Us,[s[3]||(s[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,o(t.$t("common.loading")),1)])])):h("",!0)]),R.value?R.value&&Y.value?(n(),i("div",Js,[e("div",{class:"flex items-center space-x-3"},[s[5]||(s[5]=le('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:te,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):h("",!0):(n(),i("div",Gs,[e("div",qs,[s[4]||(s[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Ws,[e("h3",Ys,o(t.$t("game.spotify.notConnected")),1),e("p",Ks,o(t.$t("game.demoModeActive")),1)]),e("div",Qs,[e("button",{onClick:ee,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},o(t.$t("game.spotify.login")),1),e("button",{onClick:te,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:K,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),F.value&&R.value?(n(),i("div",Xs,s[6]||(s[6]=[le('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):h("",!0),_.value?(n(),me($t,{key:3,track:_.value,"show-result":$.value,"show-answer":m.value,"is-correct":V.value.isCorrect,"points-earned":V.value.pointsEarned,onPlaceTrack:u},null,8,["track","show-result","show-answer","is-correct","points-earned"])):h("",!0),C.value&&!V.value.isCorrect?(n(),i("div",Zs,[e("div",eo,[e("div",to,[e("div",so,[s[7]||(s[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",oo,[e("h3",ao,o(t.$t("game.turn.wrongPlacement")),1),e("div",lo,[e("p",ro,o((z=_.value)==null?void 0:z.name),1),e("p",no,o((L=_.value)==null?void 0:L.artists.map(D=>D.name).join(", ")),1),e("p",io,o(t.$t("game.turn.releasedIn",{year:(g=_.value)==null?void 0:g.year})),1)])])]),e("p",uo,o(t.$t("game.turn.correctPlacement")),1),e("p",co,o(t.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:T,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},o(t.$t("game.turn.continue")),1)])])):h("",!0),l.value&&l.value.timeline?(n(),i("div",mo,[be(xs,{player:l.value,"is-current":!0,"current-track":_.value,"can-place":!!_.value,onPlaceTrack:u,onUseToken:P},null,8,["player","current-track","can-place"])])):h("",!0),e("div",go,[e("h3",po,o(t.$t("game.score.title")),1),e("div",vo,[(n(!0),i(ne,null,ie(f.value,D=>{var Z;return n(),i("div",{key:D.id,class:A(["text-center p-3 rounded-lg",D.id===((Z=l.value)==null?void 0:Z.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",fo,o(D.name),1),e("p",bo,o(D.tokens),1),e("p",ho,o(t.$t("game.score.tokens",{count:D.tokens})),1),e("p",yo,o(t.$t("game.score.total",{score:D.score})),1)],2)}),128))])])])):S.value==="finished"?(n(),i("div",ko,[e("div",xo,[e("h2",wo,o(t.$t("game.end.title")),1),e("p",$o,o(t.$t("game.end.winner",{player:(b=B.value)==null?void 0:b.name,score:((W=(X=B.value)==null?void 0:X.timeline)==null?void 0:W.length)||0})),1),e("div",_o,[e("h3",Co,o(t.$t("game.end.finalScores")),1),e("div",To,[(n(!0),i(ne,null,ie(J.value,(D,Z)=>{var de;return n(),i("div",{key:D.id,class:A(["flex justify-between items-center p-3 rounded-lg",Z===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Po,o(Z+1)+". "+o(D.name),1),e("span",Do,o(((de=D.timeline)==null?void 0:de.length)||0)+" "+o(t.$t("game.songs"))+" | "+o(D.tokens)+" "+o(t.$t("game.score.tokens",{count:D.tokens})),1)],2)}),128))])]),e("div",Eo,[e("button",{onClick:U,class:"btn btn-primary"}," 🔄 "+o(t.$t("game.end.playAgain")),1),e("button",{onClick:s[2]||(s[2]=D=>t.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+o(t.$t("game.backToHome")),1)])])])):h("",!0)]),c.value?(n(),i("div",Io,[e("div",So,[s[9]||(s[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Ao,[e("div",Mo,[s[8]||(s[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",jo,o(t.$t("game.tokens.hint.label")),1)]),e("div",No,[e("p",zo,o(w.value),1)]),e("div",Bo,[e("button",{onClick:H,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},o(t.$t("common.close")),1)])])])])):h("",!0)])}}});export{Vo as default};
