import{d as oe,n as ve,r as f,c as h,s as g,o as X,a as J,p as ce,w as ae,b as i,e,g as p,q as Z,t as o,f as ee,x as E,k as n,h as _,F as te,j as se,u as me,l as pe,y as ge,z as fe}from"./index-dqgiIWVj.js";const be={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},he={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},ye={class:"flex-shrink-0"},ke={key:0,class:"relative group"},xe={key:1,class:"relative group"},we=["src","alt"],$e={class:"flex-1 text-center md:text-left"},_e={class:"mb-3"},Ce={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Pe={class:"text-xs text-gray-400 mt-1 font-light"},Te={class:"mb-3"},Ae={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Ie={class:"flex items-center justify-between mb-3"},Se={class:"flex items-center"},De={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},Ee={class:"text-left space-y-2"},Me={class:"text-amber-200 text-xs font-medium"},je={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},ze={class:"text-amber-100 font-medium mb-2"},Be={class:"text-amber-200 space-y-1 list-decimal list-inside"},Ne={class:"flex justify-center space-x-3 mt-4"},Ve=["disabled"],Re={key:0,class:"flex items-center"},Le={key:1},Oe={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Fe={class:"flex items-center justify-center mb-2"},He={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},Ue={class:"text-green-200 text-xs"},Ge={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},qe={class:"flex items-center justify-center mb-2"},Qe={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Ye={class:"text-blue-200 text-xs"},Ke={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},We={class:"flex items-center justify-center space-x-4 mb-3"},Je=["disabled"],Xe={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},Ze={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},et={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},tt={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},st={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},ot={class:"text-center"},at={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},rt={class:"text-blue-200 text-sm font-medium mb-1"},lt={class:"text-blue-300 text-sm font-medium"},nt={class:"text-sm text-blue-400 mt-3"},it=["href"],dt={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},ut={class:"text-center"},ct={class:"flex items-center justify-center mb-2"},vt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},mt={class:"text-purple-200 text-xs font-medium"},pt={class:"flex items-center justify-center mb-2"},gt={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},ft={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},bt={class:"font-bold text-lg"},ht={key:0,class:"text-sm mt-1 font-semibold"},yt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},kt=oe({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(O,{emit:L}){const d=O,{t:M}=ve(),m=f(!1),y=f(!1);f(!1);const k=f(0),D=f(0);f(.7),f(!1),f(!1),f(!1);const r=f(null),C=f(!1),N=h(()=>{var b,x,T,c;const t=(x=(b=d.track.images)==null?void 0:b[0])==null?void 0:x.url,a=(c=(T=d.track.album.images)==null?void 0:T[0])==null?void 0:c.url;return t||a||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),U=h(()=>d.track.artists.map(t=>t.name).join(", ")),P=h(()=>d.showResult?d.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),w=h(()=>d.showResult?d.isCorrect?M("game.turn.correct",{year:d.track.year}):M("game.turn.incorrect",{year:d.track.year}):"");h(()=>D.value===0?0:k.value/D.value*100);const S=h(()=>!!d.track.uri),V=h(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),$=h(()=>V.value?S.value&&g.isAuthenticated():S.value&&g.isPlayerReady()),z=h(()=>$.value);async function B(){y.value=!0,r.value=null,C.value=!1;try{if(!await g.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");$.value&&d.track.uri&&(m.value?await g.pausePlayback()&&(m.value=!1):await g.startPlayback(d.track.uri)&&(m.value=!0,V.value?q():Q()))}catch(t){console.error("Playback error:",t),t.message==="NO_DEVICES_AVAILABLE"?(r.value="NO_DEVICES",C.value=!0):t.message==="DEVICE_NOT_FOUND"||t.message==="DEVICE_BECAME_INACTIVE"?(r.value="DEVICE_INACTIVE",C.value=!0):t.message==="PREMIUM_REQUIRED"?r.value="PREMIUM_REQUIRED":t.message==="DEVICE_ACTIVATION_FAILED"?(r.value="ACTIVATION_FAILED",C.value=!0):t.message.includes("No active Spotify device")||t.message.includes("No Spotify devices available")?(r.value="DEVICE_INACTIVE",C.value=!0):r.value="PLAYBACK_FAILED"}finally{y.value=!1}}function G(){C.value=!1,r.value=null}async function Y(){C.value=!1,r.value=null,await B()}function q(){const t=async()=>{var b;if(!$.value||!V.value)return;await g.keepSpotifyConnectActive();const a=await g.getSpotifyConnectState();if(a){const x=((b=a.item)==null?void 0:b.uri)===d.track.uri,T=a.is_playing&&x;m.value!==T&&(m.value=T),m.value&&setTimeout(t,5e3)}else m.value&&(console.log("🔇 No active playback detected - device may have become inactive"),m.value=!1,!C.value&&!r.value&&await g.hasAvailableDevices()&&(r.value="DEVICE_INACTIVE",C.value=!0))};t()}function Q(){const t=async()=>{if(!$.value)return;const a=await g.getPlaybackState();a&&(m.value=!a.paused,k.value=a.position/1e3,D.value=a.duration/1e3,m.value&&setTimeout(t,1e3))};t()}async function s(){var t,a,b,x;if(g.isPlayerReady())try{const T=await g.getPlaybackState();if(T){const c=((a=(t=T.track_window)==null?void 0:t.current_track)==null?void 0:a.uri)===d.track.uri,v=T.paused===!1&&c;console.log("Playback state check:",{paused:T.paused,currentTrackUri:(x=(b=T.track_window)==null?void 0:b.current_track)==null?void 0:x.uri,expectedUri:d.track.uri,isCurrentTrack:c,isActuallyPlaying:v,componentIsPlaying:m.value}),m.value!==v&&(console.log(`🔄 Syncing playback state: ${m.value} → ${v}`),m.value=v)}}catch(T){console.warn("Could not check playback state:",T)}}return X(()=>{const t=setInterval(s,2e3);J(()=>{clearInterval(t)})}),X(()=>{g.isAuthenticated()&&ce(()=>{g.initializePlayerIfReady()})}),ae(()=>d.track,async(t,a)=>{if(t&&t!==a){console.log("New track detected:",t.name),r.value=null,C.value=!1,await ce(),m.value=!1;const b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:z.value,canPlayFullTrack:$.value,hasSpotifyUri:S.value,isPlayerReady:g.isPlayerReady(),isPlaying:m.value}),z.value&&!m.value){console.log("Auto-starting playback for new track:",t.name);try{await g.ensurePlaybackReady()?(await B(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(x){b?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",x)}}else{const x=z.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${x}`),!b&&S.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),J(()=>{$.value&&g.stopPlayback()}),(t,a)=>(n(),i("div",be,[a[13]||(a[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",he,[e("div",ye,[t.showAnswer?(n(),i("div",xe,[e("img",{src:N.value,alt:t.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,we),a[1]||(a[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(n(),i("div",ke,a[0]||(a[0]=[Z('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",$e,[e("div",_e,[e("p",Ce,o(t.$t("game.turn.listening")),1),e("p",Pe,o(t.$t("game.turn.placeOnTimeline")),1)]),e("div",Te,[C.value?(n(),i("div",Ae,[e("div",Ie,[e("div",Se,[a[2]||(a[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",De,o(r.value==="NO_DEVICES"?t.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):r.value==="DEVICE_INACTIVE"?t.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):r.value==="ACTIVATION_FAILED"?t.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):t.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:G,class:"text-amber-300 hover:text-amber-100 transition-colors"},a[3]||(a[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ee,[e("p",Me,o(r.value==="NO_DEVICES"?t.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):r.value==="DEVICE_INACTIVE"?t.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):r.value==="ACTIVATION_FAILED"?t.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):t.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",je,[e("p",ze,o(t.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",Be,[e("li",null,o(t.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,o(t.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,o(t.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",Ne,[e("button",{onClick:Y,disabled:y.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[y.value?(n(),i("span",Re,[a[4]||(a[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),ee(" "+o(t.$t("game.deviceHelp.retrying","Retrying...")),1)])):(n(),i("span",Le,o(t.$t("game.deviceHelp.retry","Try Again")),1))],8,Ve),e("button",{onClick:G,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},o(t.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):p("",!0),!z.value&&V.value&&S.value?(n(),i("div",Oe,[e("div",Fe,[a[5]||(a[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",He,o(t.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",Ue,o(t.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):$.value?p("",!0):(n(),i("div",Ge,[e("div",qe,[a[6]||(a[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Qe,o(S.value?t.$t("game.premiumRequired"):t.$t("game.demoMode")),1)]),e("p",Ye,o(S.value?t.$t("game.needsPremium"):t.$t("game.needSpotifyForAudio")),1)])),z.value?(n(),i("div",Ke,[e("div",We,[e("button",{onClick:B,class:"play-btn group relative",disabled:!z.value},[e("div",Xe,[y.value?(n(),i("div",Ze)):m.value?(n(),i("svg",et,a[7]||(a[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(n(),i("svg",tt,a[8]||(a[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,Je)])])):p("",!0)]),t.showAnswer?(n(),i("div",st,[e("div",ot,[e("h4",at,o(t.track.name),1),e("p",rt,o(U.value),1),e("p",lt,o(t.track.album.name)+" ("+o(t.track.year)+")",1),e("p",nt,[e("a",{href:t.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[a[9]||(a[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),ee(" "+o(t.$t("game.openInSpotify")),1)],8,it)])])])):p("",!0)])]),t.showAnswer?p("",!0):(n(),i("div",dt,[e("div",ut,[e("div",ct,[a[10]||(a[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",vt,o(t.$t("game.turn.placing")),1)]),e("p",mt,o(V.value?t.$t("game.timeline.mobileInstructions"):t.$t("game.dragToTimeline")),1)])])),t.showResult?(n(),i("div",{key:1,class:E(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",P.value])},[e("div",pt,[t.isCorrect?(n(),i("div",gt,a[11]||(a[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(n(),i("div",ft,a[12]||(a[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",bt,o(w.value),1)]),t.pointsEarned>0?(n(),i("p",ht,[e("span",yt,o(t.$t("game.turn.points",{points:t.pointsEarned})),1)])):p("",!0)],2)):p("",!0)]))}}),xt=(O,L)=>{const d=O.__vccOpts||O;for(const[M,m]of L)d[M]=m;return d},wt=xt(kt,[["__scopeId","data-v-03b041d1"]]),$t={key:0,class:"absolute inset-0 opacity-10"},_t={class:"relative z-10"},Ct={class:"flex items-center justify-between mb-6"},Pt={class:"text-xl font-bold flex items-center space-x-3"},Tt={key:0,class:"text-2xl animate-bounce"},At={class:"text-right"},It={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},St={class:"flex items-center space-x-2 text-sm text-gray-300"},Dt={class:"font-medium"},Et={key:0,class:"mb-6"},Mt={class:"text-sm font-medium text-gray-300 mb-3"},jt={class:"flex space-x-3"},zt=["title"],Bt={class:"flex items-center space-x-2"},Nt=["title"],Vt={class:"flex items-center space-x-2"},Rt={class:"mb-6"},Lt={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Ot={key:0,class:"text-center py-12 text-gray-400"},Ft={class:"text-lg font-medium mb-2"},Ht={class:"text-center text-gray-300 font-medium"},Ut={key:1,class:"space-y-3"},Gt={class:"text-center text-gray-400 text-sm font-medium"},qt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},Qt={class:"flex items-center space-x-4"},Yt={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},Kt=["src","alt"],Wt={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},Jt={class:"flex-1 min-w-0"},Xt={class:"font-bold text-lg text-gray-100 truncate"},Zt={class:"text-sm text-gray-300 truncate font-medium"},es={class:"text-right flex-shrink-0"},ts={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},ss=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],os={class:"text-center text-gray-400 text-sm font-medium"},as=["data-drop-zone"],rs={class:"text-center text-gray-400 text-sm font-medium"},ls=["draggable"],ns={class:"flex items-center space-x-4"},is={class:"flex-1 min-w-0"},ds={class:"font-bold text-lg text-blue-200"},us={class:"text-sm text-blue-300 font-medium"},cs={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},vs={class:"flex justify-between text-sm text-gray-300"},ms={class:"font-medium"},ps={key:0,class:"font-mono"},gs={class:"relative z-10"},fs={class:"flex items-center space-x-3 mb-4"},bs={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},hs={class:"mb-6"},ys={class:"text-gray-200 text-lg leading-relaxed"},ks={class:"flex space-x-3"},xs=oe({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(O,{emit:L}){const d=O,M=L,m=f(!1),y=f([]),k=f(null),D=f(!1);f({isPressed:!1,action:""});const r=h(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),C=h(()=>{var a;const s=((a=d.player)==null?void 0:a.timeline)||[];if(s.length<2)return null;const t=s.map(b=>b.year).sort((b,x)=>b-x);return`${t[0]} - ${t[t.length-1]}`});function N(s){var t,a;return s.images&&s.images.length>0&&((t=s.images[0])!=null&&t.url)?s.images[0].url:s.album&&s.album.images&&s.album.images.length>0&&((a=s.album.images[0])!=null&&a.url)?s.album.images[0].url:"/placeholder-album.png"}function U(s){return s.artists.map(t=>t.name).join(", ")}function P(s){var a;if(!d.currentTrack)return;(a=s.dataTransfer)==null||a.setData("text/plain",JSON.stringify(d.currentTrack)),s.target.classList.add("dragging")}function w(s){s.target.classList.remove("dragging"),m.value=!1,y.value=[]}function S(s){!d.currentTrack||!d.canPlace||(m.value=!1,y.value=[],M("placeTrack",d.currentTrack,s))}function V(s){M("useToken",s)}function $(s){!d.currentTrack||!d.canPlace||(k.value=s,D.value=!0,"vibrate"in navigator&&navigator.vibrate(50))}function z(s){var b;if(s===null)return"";const t=((b=d.player)==null?void 0:b.timeline)||[],a=t.length;return s===0?a===0?"Place as your first track":`Place before ${t[0].name} (${t[0].year})`:s===a?`Place after ${t[a-1].name} (${t[a-1].year})`:`Place between ${t[s-1].name} (${t[s-1].year}) and ${t[s].name} (${t[s].year})`}function B(){"vibrate"in navigator&&navigator.vibrate(50)}function G(){var t;const s=((t=d.player)==null?void 0:t.timeline)||[];y.value=new Array(s.length+1).fill(!1)}J(()=>{}),ae(()=>{var s;return(((s=d.player)==null?void 0:s.timeline)||[]).length},()=>{G()},{immediate:!0});function Y(){}function q(s){console.log("performCancel called"),s&&(s.preventDefault(),s.stopPropagation()),"vibrate"in navigator&&navigator.vibrate(50),k.value=null,D.value=!1}function Q(s){console.log("performConfirm called"),s&&(s.preventDefault(),s.stopPropagation()),"vibrate"in navigator&&navigator.vibrate(100),k.value!==null&&d.currentTrack&&(M("placeTrack",d.currentTrack,k.value),k.value=null,D.value=!1)}return(s,t)=>{var a,b,x,T;return n(),i("div",{class:E(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":s.isCurrent}])},[s.isCurrent?(n(),i("div",$t,t[21]||(t[21]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):p("",!0),e("div",_t,[e("div",Ct,[e("h3",Pt,[e("span",{class:E(s.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},o(s.player.name),3),s.isCurrent?(n(),i("span",Tt,"👑")):p("",!0)]),e("div",At,[e("p",It,o(s.player.score),1),e("div",St,[t[22]||(t[22]=e("span",{class:"text-lg"},"🎵",-1)),e("span",Dt,o(s.$t("game.score.tokens",{count:s.player.tokens})),1)])])]),s.isCurrent&&s.canPlace&&s.player.tokens>0?(n(),i("div",Et,[e("h4",Mt,o(s.$t("game.tokenAbilities")),1),e("div",jt,[e("button",{onClick:t[0]||(t[0]=c=>V("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:s.$t("game.tokens.skip.description")},[e("div",Bt,[t[23]||(t[23]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,o(s.$t("game.tokens.skip.label")),1)])],8,zt),e("button",{onClick:t[1]||(t[1]=c=>V("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:s.$t("game.tokens.hint.description")},[e("div",Vt,[t[24]||(t[24]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,o(s.$t("game.tokens.hint.label")),1)])],8,Nt)])])):p("",!0),e("div",Rt,[e("h4",Lt,[t[25]||(t[25]=e("span",{class:"mr-2"},"🎵",-1)),ee(" "+o(s.$t("game.timeline.title")),1)]),!s.player.timeline||s.player.timeline.length===0?(n(),i("div",Ot,[t[26]||(t[26]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Ft,o(s.$t("game.timeline.empty")),1),s.canPlace?(n(),i("div",{key:0,class:E(["timeline-slot mt-6 group",{"drag-over":!r.value&&m.value,selected:k.value===0&&r.value}]),onDragover:t[2]||(t[2]=_(c=>r.value?null:m.value=!0,["prevent"])),onDragleave:t[3]||(t[3]=_(c=>r.value?null:m.value=!1,["prevent"])),onDrop:t[4]||(t[4]=_(c=>r.value?null:S(0),["prevent"])),onTouchstart:t[5]||(t[5]=_(c=>r.value?$(0):null,["prevent"])),onClick:t[6]||(t[6]=c=>r.value?$(0):null),"data-drop-zone":0},[e("div",{class:E(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":k.value===0&&r.value}])},[e("p",Ht,o(r.value?s.$t("game.timeline.tapToSelect"):s.$t("game.timeline.placeHere")),1)],2)],34)):p("",!0)])):s.player.timeline&&s.player.timeline.length>0?(n(),i("div",Ut,[s.canPlace?(n(),i("div",{key:0,class:E(["timeline-slot h-20 group",{"drag-over":!r.value&&y.value[0],selected:k.value===0&&r.value}]),onDragover:t[7]||(t[7]=_(c=>r.value?null:y.value[0]=!0,["prevent"])),onDragleave:t[8]||(t[8]=_(c=>r.value?null:y.value[0]=!1,["prevent"])),onDrop:t[9]||(t[9]=_(c=>r.value?null:S(0),["prevent"])),onTouchstart:t[10]||(t[10]=_(c=>r.value?$(0):null,["prevent"])),onClick:t[11]||(t[11]=c=>r.value?$(0):null),"data-drop-zone":0},[e("div",{class:E(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":k.value===0&&r.value}])},[e("p",Gt,o(r.value?s.$t("game.timeline.tapToSelect"):s.$t("game.placeEarlier")),1)],2)],34)):p("",!0),(n(!0),i(te,null,se(s.player.timeline||[],(c,v)=>{var W;return n(),i("div",{key:c.id,class:"track-card group relative"},[e("div",qt,[e("div",Qt,[e("div",Yt,[c.revealed?(n(),i("img",{key:0,src:N(c),alt:c.name,class:"w-16 h-16 object-cover"},null,8,Kt)):(n(),i("div",Wt,t[27]||(t[27]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",Jt,[e("p",Xt,o(c.name),1),e("p",Zt,o(U(c)),1)]),e("div",es,[e("p",ts,o(c.year),1)])])]),s.canPlace&&v<(((W=s.player.timeline)==null?void 0:W.length)||0)-1?(n(),i("div",{key:0,class:E(["timeline-slot h-20 mt-3 group",{"drag-over":y.value[v+1],selected:k.value===v+1&&r.value}]),onDragover:_(R=>y.value[v+1]=!0,["prevent"]),onDragleave:_(R=>y.value[v+1]=!1,["prevent"]),onDrop:_(R=>S(v+1),["prevent"]),onTouchstart:_(R=>r.value?$(v+1):null,["prevent"]),onClick:R=>r.value?$(v+1):null,"data-drop-zone":v+1},[e("div",{class:E(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":k.value===v+1&&r.value}])},[e("p",os,o(r.value?s.$t("game.timeline.tapToSelect"):s.$t("game.placeBetween")),1)],2)],42,ss)):p("",!0)])}),128)),s.canPlace?(n(),i("div",{key:1,class:E(["timeline-slot h-20 group",{"drag-over":!r.value&&y.value[((a=s.player.timeline)==null?void 0:a.length)||0],selected:k.value===(((b=s.player.timeline)==null?void 0:b.length)||0)&&r.value}]),onDragover:t[12]||(t[12]=_(c=>{var v;return r.value?null:y.value[((v=s.player.timeline)==null?void 0:v.length)||0]=!0},["prevent"])),onDragleave:t[13]||(t[13]=_(c=>{var v;return r.value?null:y.value[((v=s.player.timeline)==null?void 0:v.length)||0]=!1},["prevent"])),onDrop:t[14]||(t[14]=_(c=>{var v;return r.value?null:S(((v=s.player.timeline)==null?void 0:v.length)||0)},["prevent"])),onTouchstart:t[15]||(t[15]=_(c=>{var v;return r.value?$(((v=s.player.timeline)==null?void 0:v.length)||0):null},["prevent"])),onClick:t[16]||(t[16]=c=>{var v;return r.value?$(((v=s.player.timeline)==null?void 0:v.length)||0):null}),"data-drop-zone":((x=s.player.timeline)==null?void 0:x.length)||0},[e("div",{class:E(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":k.value===(((T=s.player.timeline)==null?void 0:T.length)||0)&&r.value}])},[e("p",rs,o(r.value?s.$t("game.timeline.tapToSelect"):s.$t("game.placeLater")),1)],2)],42,as)):p("",!0)])):p("",!0)]),s.canPlace&&s.currentTrack?(n(),i("div",{key:1,class:E(["timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",r.value?"cursor-pointer":"cursor-move"]),draggable:!r.value,onDragstart:t[17]||(t[17]=c=>r.value?null:P),onDragend:t[18]||(t[18]=c=>r.value?null:w),onClick:t[19]||(t[19]=c=>r.value?B:null)},[e("div",ns,[t[28]||(t[28]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",is,[e("p",ds,o(s.$t("game.newTrack")),1),e("p",us,o(r.value?s.$t("game.tapToPlace"):s.$t("game.dragToPlace")),1)]),t[29]||(t[29]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],42,ls)):p("",!0),s.player.timeline&&s.player.timeline.length>0?(n(),i("div",cs,[e("div",vs,[e("span",ms,o(s.$t("game.tracksInTimeline",{count:s.player.timeline.length})),1),C.value?(n(),i("span",ps,o(C.value),1)):p("",!0)])])):p("",!0)]),D.value&&r.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:Y},[e("div",{class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-6 max-w-sm w-full mx-auto relative overflow-hidden",onClick:t[20]||(t[20]=_(()=>{},["stop"]))},[t[31]||(t[31]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",gs,[e("div",fs,[t[30]||(t[30]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",bs,o(s.$t("game.timeline.selectedPosition")),1)]),e("div",hs,[e("p",ys,o(z(k.value)),1)]),e("div",ks,[e("div",{onClick:q,onTouchend:_(q,["prevent","stop"]),class:"flex-1 px-4 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 active:from-gray-500 active:to-gray-600 text-white font-medium rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg select-none cursor-pointer",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},o(s.$t("game.timeline.cancelSelection")),33),e("div",{onClick:Q,onTouchend:_(Q,["prevent","stop"]),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-500 hover:to-blue-500 active:from-green-500 active:to-blue-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-green-500/25 select-none cursor-pointer",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},o(s.$t("game.timeline.confirmPlacement")),33)])])])])):p("",!0)],2)}}}),ws={class:"min-h-screen flex flex-col"},$s={class:"bg-white/10 backdrop-blur-sm p-4"},_s={class:"flex justify-between items-center"},Cs={class:"flex items-center space-x-4"},Ps={class:"text-white"},Ts={class:"text-xl font-bold"},As={class:"flex items-center space-x-3 text-sm opacity-80"},Is={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},Ss={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},Ds={class:"text-white text-right"},Es={class:"text-sm opacity-80"},Ms={class:"flex-1 container mx-auto px-4 py-6"},js={key:0,class:"max-w-2xl mx-auto"},zs={class:"card text-center"},Bs={class:"text-2xl font-semibold mb-4"},Ns={class:"text-gray-600 mb-6"},Vs={key:1,class:"space-y-6"},Rs={class:"card text-center bg-green-50 border-green-200"},Ls={class:"text-2xl font-bold text-white mb-2"},Os={class:"text-white"},Fs={key:0,class:"mt-4"},Hs={key:1,class:"mt-4"},Us={class:"flex items-center justify-center space-x-2"},Gs={key:0,class:"card bg-yellow-50 border-yellow-200"},qs={class:"flex items-center space-x-3"},Qs={class:"flex-1"},Ys={class:"text-lg font-semibold text-yellow-800"},Ks={class:"text-yellow-700 text-sm"},Ws={class:"flex space-x-2"},Js={key:1,class:"card bg-orange-50 border-orange-200"},Xs={key:2,class:"card bg-blue-50 border-blue-200"},Zs={key:4,class:"text-center mb-6"},eo={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},to={class:"mb-4"},so={class:"flex items-center justify-center mb-3"},oo={class:"text-center"},ao={class:"text-2xl font-bold text-red-200 mb-2"},ro={class:"text-red-100"},lo={class:"text-lg font-semibold"},no={class:"text-base"},io={class:"text-sm opacity-90"},uo={class:"text-red-200 text-lg mb-4"},co={class:"text-red-300 text-sm"},vo={key:5,class:"max-w-4xl mx-auto"},mo={class:"card"},po={class:"text-lg font-semibold mb-4 text-gray-100"},go={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},fo={class:"font-semibold text-gray-800"},bo={class:"text-2xl font-bold text-gray-900"},ho={class:"text-sm text-gray-600"},yo={class:"text-xs text-gray-500"},ko={key:2,class:"max-w-2xl mx-auto"},xo={class:"card text-center"},wo={class:"text-3xl font-bold mb-4 text-white"},$o={class:"text-xl mb-6"},_o={class:"mb-6"},Co={class:"text-lg font-semibold mb-3"},Po={class:"space-y-2"},To={class:"font-medium"},Ao={class:"font-bold"},Io={class:"flex space-x-4 justify-center"},So={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Do={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Eo={class:"relative z-10"},Mo={class:"flex items-center space-x-3 mb-6"},jo={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},zo={class:"mb-8"},Bo={class:"text-gray-200 text-lg leading-relaxed"},No={class:"flex justify-center"},Ro=oe({__name:"GameView",setup(O){const L=pe(),d=me(),M=f(!1),m=f(!1),y=f(""),k=f(g.isAuthenticated()),D=f(!1),r=f(!1),C=f(!1),N=f({isCorrect:!1,pointsEarned:0}),U=h(()=>d.players),P=h(()=>d.currentPlayer),w=h(()=>d.currentTrack),S=h(()=>d.gamePhase),V=h(()=>d.round),$=h(()=>d.settings),z=h(()=>d.winner),B=h(()=>k.value),G=h(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),Y=h(()=>B.value?!g.isPlayerReady()&&Q.value>3e4:!1),q=f(Date.now()),Q=h(()=>Date.now()-q.value),s=h(()=>[...U.value].sort((l,u)=>{var F,H;const A=((F=l.timeline)==null?void 0:F.length)||0,j=((H=u.timeline)==null?void 0:H.length)||0;return j!==A?j-A:u.tokens!==l.tokens?u.tokens-l.tokens:u.score-l.score}));async function t(){var l;M.value=!0,D.value=!1,r.value=!1,N.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const u=await d.getNextTrack();u?console.log("Track loaded successfully:",u.name,"by",(l=u.artists[0])==null?void 0:l.name):console.error("No tracks available")}catch(u){console.error("Error loading track:",u)}finally{M.value=!1}}function a(l,u){const A=d.placeTrackOnTimeline(l,u);let j=0;A&&P.value&&(j=1,P.value.timeline.length>=5&&(j=2),P.value.timeline.length>=8&&(j=3)),N.value={isCorrect:A,pointsEarned:j},D.value=!0,setTimeout(()=>{r.value=!0},500),A?setTimeout(()=>{D.value=!1,r.value=!1,d.nextPlayer()},4e3):setTimeout(()=>{if(C.value=!0,P.value&&w.value){const F=b(w.value,P.value.timeline),H={...w.value,revealed:!0};d.addTrackToTimelineAtPosition(H,F)}},1500)}function b(l,u){for(let A=0;A<u.length;A++)if(l.year<=u[A].year)return A;return u.length}function x(){w.value&&P.value&&d.removeTrackFromTimeline(w.value.id),D.value=!1,r.value=!1,C.value=!1,d.nextPlayer()}function T(l){var A;if(!P.value)return;if(d.useToken(P.value.id,l))switch(l){case"skip":t();break;case"hint":const j=Math.floor(((A=w.value)==null?void 0:A.year)/10)*10;y.value=`This track was released in the ${j}s`,m.value=!0;break}}function c(){m.value=!1,y.value=""}function v(){d.resetGame(),L.push("/")}function W(){L.push("/")}function R(){const l=g.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:l,previousState:B.value}),k.value!==l&&(k.value=l,console.log("Spotify auth state updated:",l)),l&&!g.isPlayerReady()&&(console.log("Initializing player after auth check"),g.initializePlayerIfReady())}async function re(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await g.forceReauth(),R()}return X(()=>{d.gamePhase==="setup"&&d.players.length===0&&L.push("/"),R(),g.isAuthenticated()&&g.startSessionMaintenance();const l=setInterval(()=>{k.value?g.startSessionMaintenance():R()},12e4);J(()=>{clearInterval(l),g.stopSessionMaintenance()})}),ae(w,l=>{l&&(D.value=!1,r.value=!1,N.value={isCorrect:!1,pointsEarned:0})}),(l,u)=>{var A,j,F,H,le,ne,ie,de;return n(),i("div",ws,[e("header",$s,[e("div",_s,[e("div",Cs,[e("button",{onClick:u[0]||(u[0]=I=>l.$router.push("/")),class:"btn btn-secondary"}," ← "+o(l.$t("common.back")),1),e("div",Ps,[e("h1",Ts,o(l.$t("game.title")),1),e("div",As,[e("span",null,o(l.$t("game.round"))+" "+o(V.value),1),$.value.theme?(n(),i("span",Is," 🎵 "+o(l.$t(`game.themes.${$.value.theme}`)),1)):(n(),i("span",Ss," 🎵 "+o(l.$t("game.allMusic")),1))])])]),e("div",Ds,[e("p",Es,o(l.$t("game.turn.currentPlayer",{player:(A=P.value)==null?void 0:A.name})),1)])])]),e("main",Ms,[S.value==="setup"?(n(),i("div",js,[e("div",zs,[e("h2",Bs,o(l.$t("game.setupRequired")),1),e("p",Ns,o(l.$t("game.setupMessage")),1),e("button",{onClick:u[1]||(u[1]=I=>l.$router.push("/")),class:"btn btn-primary"},o(l.$t("game.backToSetup")),1)])])):S.value==="playing"?(n(),i("div",Vs,[e("div",Rs,[e("h2",Ls,o(l.$t("game.turn.currentPlayer",{player:(j=P.value)==null?void 0:j.name})),1),e("p",Os,o(l.$t("game.turn.ready")),1),!w.value&&!M.value?(n(),i("div",Fs,[e("button",{onClick:t,class:"btn btn-primary btn-lg"}," 🎵 "+o(l.$t("game.getTrack")),1)])):p("",!0),M.value?(n(),i("div",Hs,[e("div",Us,[u[3]||(u[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,o(l.$t("common.loading")),1)])])):p("",!0)]),B.value?B.value&&Y.value?(n(),i("div",Js,[e("div",{class:"flex items-center space-x-3"},[u[5]||(u[5]=Z('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:re,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):p("",!0):(n(),i("div",Gs,[e("div",qs,[u[4]||(u[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Qs,[e("h3",Ys,o(l.$t("game.spotify.notConnected")),1),e("p",Ks,o(l.$t("game.demoModeActive")),1)]),e("div",Ws,[e("button",{onClick:W,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},o(l.$t("game.spotify.login")),1),e("button",{onClick:re,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:R,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),G.value&&B.value?(n(),i("div",Xs,u[6]||(u[6]=[Z('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):p("",!0),w.value?(n(),ge(wt,{key:3,track:w.value,"show-result":D.value,"show-answer":r.value,"is-correct":N.value.isCorrect,"points-earned":N.value.pointsEarned,onPlaceTrack:a},null,8,["track","show-result","show-answer","is-correct","points-earned"])):p("",!0),C.value&&!N.value.isCorrect?(n(),i("div",Zs,[e("div",eo,[e("div",to,[e("div",so,[u[7]||(u[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",oo,[e("h3",ao,o(l.$t("game.turn.wrongPlacement")),1),e("div",ro,[e("p",lo,o((F=w.value)==null?void 0:F.name),1),e("p",no,o((H=w.value)==null?void 0:H.artists.map(I=>I.name).join(", ")),1),e("p",io,o(l.$t("game.turn.releasedIn",{year:(le=w.value)==null?void 0:le.year})),1)])])]),e("p",uo,o(l.$t("game.turn.correctPlacement")),1),e("p",co,o(l.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:x,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},o(l.$t("game.turn.continue")),1)])])):p("",!0),P.value&&P.value.timeline?(n(),i("div",vo,[fe(xs,{player:P.value,"is-current":!0,"current-track":w.value,"can-place":!!w.value,onPlaceTrack:a,onUseToken:T},null,8,["player","current-track","can-place"])])):p("",!0),e("div",mo,[e("h3",po,o(l.$t("game.score.title")),1),e("div",go,[(n(!0),i(te,null,se(U.value,I=>{var K;return n(),i("div",{key:I.id,class:E(["text-center p-3 rounded-lg",I.id===((K=P.value)==null?void 0:K.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",fo,o(I.name),1),e("p",bo,o(I.tokens),1),e("p",ho,o(l.$t("game.score.tokens",{count:I.tokens})),1),e("p",yo,o(l.$t("game.score.total",{score:I.score})),1)],2)}),128))])])])):S.value==="finished"?(n(),i("div",ko,[e("div",xo,[e("h2",wo,o(l.$t("game.end.title")),1),e("p",$o,o(l.$t("game.end.winner",{player:(ne=z.value)==null?void 0:ne.name,score:((de=(ie=z.value)==null?void 0:ie.timeline)==null?void 0:de.length)||0})),1),e("div",_o,[e("h3",Co,o(l.$t("game.end.finalScores")),1),e("div",Po,[(n(!0),i(te,null,se(s.value,(I,K)=>{var ue;return n(),i("div",{key:I.id,class:E(["flex justify-between items-center p-3 rounded-lg",K===0?"bg-yellow-100":"bg-gray-50"])},[e("span",To,o(K+1)+". "+o(I.name),1),e("span",Ao,o(((ue=I.timeline)==null?void 0:ue.length)||0)+" "+o(l.$t("game.songs"))+" | "+o(I.tokens)+" "+o(l.$t("game.score.tokens",{count:I.tokens})),1)],2)}),128))])]),e("div",Io,[e("button",{onClick:v,class:"btn btn-primary"}," 🔄 "+o(l.$t("game.end.playAgain")),1),e("button",{onClick:u[2]||(u[2]=I=>l.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+o(l.$t("game.backToHome")),1)])])])):p("",!0)]),m.value?(n(),i("div",So,[e("div",Do,[u[9]||(u[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Eo,[e("div",Mo,[u[8]||(u[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",jo,o(l.$t("game.tokens.hint.label")),1)]),e("div",zo,[e("p",Bo,o(y.value),1)]),e("div",No,[e("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},o(l.$t("common.close")),1)])])])])):p("",!0)])}}});export{Ro as default};
