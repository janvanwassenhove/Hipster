import{d as pe,n as ye,r as p,c as w,s as k,o as ce,a as ie,p as he,w as fe,b as i,e,g as y,q as de,t as s,f as ve,x as R,k as n,h as D,F as ge,j as me,u as ke,l as xe,y as we,z as $e}from"./index-C7DSidL5.js";const _e={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},Ce={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},Te={class:"flex-shrink-0"},Pe={key:0,class:"relative group"},Se={key:1,class:"relative group"},Ae=["src","alt"],Ie={class:"flex-1 text-center md:text-left"},Ee={class:"mb-3"},De={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Me={class:"text-xs text-gray-400 mt-1 font-light"},je={class:"mb-3"},ze={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Be={class:"flex items-center justify-between mb-3"},Ne={class:"flex items-center"},Re={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},Ve={class:"text-left space-y-2"},Le={class:"text-amber-200 text-xs font-medium"},Fe={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},Oe={class:"text-amber-100 font-medium mb-2"},He={class:"text-amber-200 space-y-1 list-decimal list-inside"},Ue={class:"flex justify-center space-x-3 mt-4"},Ye=["disabled"],Xe={key:0,class:"flex items-center"},qe={key:1},Ge={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Qe={class:"flex items-center justify-center mb-2"},Ke={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},We={class:"text-green-200 text-xs"},Ze={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Je={class:"flex items-center justify-center mb-2"},et={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},tt={class:"text-blue-200 text-xs"},ot={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},st={class:"flex items-center justify-center space-x-4 mb-3"},at=["disabled"],lt={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},rt={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},nt={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},it={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},ut={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},ct={class:"text-center"},dt={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},vt={class:"text-blue-200 text-sm font-medium mb-1"},gt={class:"text-blue-300 text-sm font-medium"},mt={class:"text-sm text-blue-400 mt-3"},pt=["href"],ft={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},bt={class:"text-center"},ht={class:"flex items-center justify-center mb-2"},yt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},kt={class:"text-purple-200 text-xs font-medium"},xt={class:"flex items-center justify-center mb-2"},wt={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},$t={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},_t={class:"font-bold text-lg"},Ct={key:0,class:"text-sm mt-1 font-semibold"},Tt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Pt=pe({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(K,{emit:q}){const r=K,{t:z}=ye(),v=p(!1),b=p(!1);p(!1);const $=p(0),j=p(0);p(.7),p(!1),p(!1),p(!1);const g=p(null),S=p(!1),H=w(()=>{var M,I,E,U;const a=(I=(M=r.track.images)==null?void 0:M[0])==null?void 0:I.url,u=(U=(E=r.track.album.images)==null?void 0:E[0])==null?void 0:U.url;return a||u||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),d=w(()=>r.track.artists.map(a=>a.name).join(", ")),C=w(()=>r.showResult?r.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),T=w(()=>r.showResult?r.isCorrect?z("game.turn.correct",{year:r.track.year}):z("game.turn.incorrect",{year:r.track.year}):"");w(()=>j.value===0?0:$.value/j.value*100);const A=w(()=>!!r.track.uri),f=w(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),N=w(()=>f.value?A.value&&k.isAuthenticated():A.value&&k.isPlayerReady()),L=w(()=>N.value);async function F(){b.value=!0,g.value=null,S.value=!1;try{if(!await k.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");N.value&&r.track.uri&&(v.value?await k.pausePlayback()&&(v.value=!1):await k.startPlayback(r.track.uri)&&(v.value=!0,f.value?G():ee()))}catch(a){console.error("Playback error:",a),a.message==="NO_DEVICES_AVAILABLE"?(g.value="NO_DEVICES",S.value=!0):a.message==="DEVICE_NOT_FOUND"||a.message==="DEVICE_BECAME_INACTIVE"?(g.value="DEVICE_INACTIVE",S.value=!0):a.message==="PREMIUM_REQUIRED"?g.value="PREMIUM_REQUIRED":a.message==="DEVICE_ACTIVATION_FAILED"?(g.value="ACTIVATION_FAILED",S.value=!0):a.message.includes("No active Spotify device")||a.message.includes("No Spotify devices available")?(g.value="DEVICE_INACTIVE",S.value=!0):g.value="PLAYBACK_FAILED"}finally{b.value=!1}}function J(){S.value=!1,g.value=null}async function oe(){S.value=!1,g.value=null,await F()}function G(){const a=async()=>{var M;if(!N.value||!f.value)return;await k.keepSpotifyConnectActive();const u=await k.getSpotifyConnectState();if(u){const I=((M=u.item)==null?void 0:M.uri)===r.track.uri,E=u.is_playing&&I;v.value!==E&&(v.value=E),v.value&&setTimeout(a,5e3)}else v.value&&(console.log("🔇 No active playback detected - device may have become inactive"),v.value=!1,!S.value&&!g.value&&await k.hasAvailableDevices()&&(g.value="DEVICE_INACTIVE",S.value=!0))};a()}function ee(){const a=async()=>{if(!N.value)return;const u=await k.getPlaybackState();u&&(v.value=!u.paused,$.value=u.position/1e3,j.value=u.duration/1e3,v.value&&setTimeout(a,1e3))};a()}async function V(){var a,u,M,I;if(k.isPlayerReady())try{const E=await k.getPlaybackState();if(E){const U=((u=(a=E.track_window)==null?void 0:a.current_track)==null?void 0:u.uri)===r.track.uri,Q=E.paused===!1&&U;console.log("Playback state check:",{paused:E.paused,currentTrackUri:(I=(M=E.track_window)==null?void 0:M.current_track)==null?void 0:I.uri,expectedUri:r.track.uri,isCurrentTrack:U,isActuallyPlaying:Q,componentIsPlaying:v.value}),v.value!==Q&&(console.log(`🔄 Syncing playback state: ${v.value} → ${Q}`),v.value=Q)}}catch(E){console.warn("Could not check playback state:",E)}}return ce(()=>{const a=setInterval(V,2e3);ie(()=>{clearInterval(a)})}),ce(()=>{k.isAuthenticated()&&he(()=>{k.initializePlayerIfReady()})}),fe(()=>r.track,async(a,u)=>{if(a&&a!==u){console.log("New track detected:",a.name),g.value=null,S.value=!1,await he(),v.value=!1;const M=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:L.value,canPlayFullTrack:N.value,hasSpotifyUri:A.value,isPlayerReady:k.isPlayerReady(),isPlaying:v.value}),L.value&&!v.value){console.log("Auto-starting playback for new track:",a.name);try{await k.ensurePlaybackReady()?(await F(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(I){M?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",I)}}else{const I=L.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${I}`),!M&&A.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),ie(()=>{N.value&&k.stopPlayback()}),(a,u)=>(n(),i("div",_e,[u[13]||(u[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Ce,[e("div",Te,[a.showAnswer?(n(),i("div",Se,[e("img",{src:H.value,alt:a.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,Ae),u[1]||(u[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(n(),i("div",Pe,u[0]||(u[0]=[de('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",Ie,[e("div",Ee,[e("p",De,s(a.$t("game.turn.listening")),1),e("p",Me,s(a.$t("game.turn.placeOnTimeline")),1)]),e("div",je,[S.value?(n(),i("div",ze,[e("div",Be,[e("div",Ne,[u[2]||(u[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",Re,s(g.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):g.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):g.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):a.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:J,class:"text-amber-300 hover:text-amber-100 transition-colors"},u[3]||(u[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ve,[e("p",Le,s(g.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):g.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):g.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):a.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",Fe,[e("p",Oe,s(a.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",He,[e("li",null,s(a.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,s(a.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,s(a.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",Ue,[e("button",{onClick:oe,disabled:b.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[b.value?(n(),i("span",Xe,[u[4]||(u[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),ve(" "+s(a.$t("game.deviceHelp.retrying","Retrying...")),1)])):(n(),i("span",qe,s(a.$t("game.deviceHelp.retry","Try Again")),1))],8,Ye),e("button",{onClick:J,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},s(a.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):y("",!0),!L.value&&f.value&&A.value?(n(),i("div",Ge,[e("div",Qe,[u[5]||(u[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",Ke,s(a.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",We,s(a.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):N.value?y("",!0):(n(),i("div",Ze,[e("div",Je,[u[6]||(u[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",et,s(A.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",tt,s(A.value?a.$t("game.needsPremium"):a.$t("game.needSpotifyForAudio")),1)])),L.value?(n(),i("div",ot,[e("div",st,[e("button",{onClick:F,class:"play-btn group relative",disabled:!L.value},[e("div",lt,[b.value?(n(),i("div",rt)):v.value?(n(),i("svg",nt,u[7]||(u[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(n(),i("svg",it,u[8]||(u[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,at)])])):y("",!0)]),a.showAnswer?(n(),i("div",ut,[e("div",ct,[e("h4",dt,s(a.track.name),1),e("p",vt,s(d.value),1),e("p",gt,s(a.track.album.name)+" ("+s(a.track.year)+")",1),e("p",mt,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[u[9]||(u[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),ve(" "+s(a.$t("game.openInSpotify")),1)],8,pt)])])])):y("",!0)])]),a.showAnswer?y("",!0):(n(),i("div",ft,[e("div",bt,[e("div",ht,[u[10]||(u[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",yt,s(a.$t("game.turn.placing")),1)]),e("p",kt,s(f.value?a.$t("game.timeline.mobileInstructions"):a.$t("game.dragToTimeline")),1)])])),a.showResult?(n(),i("div",{key:1,class:R(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",C.value])},[e("div",xt,[a.isCorrect?(n(),i("div",wt,u[11]||(u[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(n(),i("div",$t,u[12]||(u[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",_t,s(T.value),1)]),a.pointsEarned>0?(n(),i("p",Ct,[e("span",Tt,s(a.$t("game.turn.points",{points:a.pointsEarned})),1)])):y("",!0)],2)):y("",!0)]))}}),St=(K,q)=>{const r=K.__vccOpts||K;for(const[z,v]of q)r[z]=v;return r},At=St(Pt,[["__scopeId","data-v-03b041d1"]]),It={key:0,class:"absolute inset-0 opacity-10"},Et={class:"relative z-10"},Dt={class:"flex items-center justify-between mb-6"},Mt={class:"text-xl font-bold flex items-center space-x-3"},jt={key:0,class:"text-2xl animate-bounce"},zt={class:"text-right"},Bt={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Nt={class:"flex items-center space-x-2 text-sm text-gray-300"},Rt={class:"font-medium"},Vt={key:0,class:"mb-6"},Lt={class:"text-sm font-medium text-gray-300 mb-3"},Ft={class:"flex space-x-3"},Ot=["title"],Ht={class:"flex items-center space-x-2"},Ut=["title"],Yt={class:"flex items-center space-x-2"},Xt={class:"mb-6"},qt={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Gt={key:0,class:"text-center py-12 text-gray-400"},Qt={class:"text-lg font-medium mb-2"},Kt={class:"text-center text-gray-300 font-medium"},Wt={key:1,class:"space-y-3"},Zt={class:"text-center text-gray-400 text-sm font-medium"},Jt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},eo={class:"flex items-center space-x-4"},to={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},oo=["src","alt"],so={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},ao={class:"flex-1 min-w-0"},lo={class:"font-bold text-lg text-gray-100 truncate"},ro={class:"text-sm text-gray-300 truncate font-medium"},no={class:"text-right flex-shrink-0"},io={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},uo=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],co={class:"text-center text-gray-400 text-sm font-medium"},vo=["data-drop-zone"],go={class:"text-center text-gray-400 text-sm font-medium"},mo={class:"flex items-center space-x-4"},po={class:"flex-1 min-w-0"},fo={class:"font-bold text-lg text-blue-200"},bo={class:"text-sm text-blue-300 font-medium"},ho={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},yo={class:"flex justify-between text-sm text-gray-300"},ko={class:"font-medium"},xo={key:0,class:"font-mono"},wo={class:"relative z-10"},$o={class:"flex items-center space-x-3 mb-4"},_o={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},Co={class:"mb-6"},To={class:"text-gray-200 text-lg leading-relaxed"},Po={class:"flex space-x-3"},So=pe({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(K,{emit:q}){const r=K,z=q,v=p(!1),b=p([]),$=p(null),j=p(!1),g=p(!1),S=p({x:0,y:0}),H=p({x:0,y:0}),d=p(null),C=p({x:0,y:0}),T=p(null);let A=null;const f=w(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),N=w(()=>{var m;const t=((m=r.player)==null?void 0:m.timeline)||[];if(t.length<2)return null;const o=t.map(_=>_.year).sort((_,O)=>_-O);return`${o[0]} - ${o[o.length-1]}`});function L(t){var o,m;return t.images&&t.images.length>0&&((o=t.images[0])!=null&&o.url)?t.images[0].url:t.album&&t.album.images&&t.album.images.length>0&&((m=t.album.images[0])!=null&&m.url)?t.album.images[0].url:"/placeholder-album.png"}function F(t){return t.artists.map(o=>o.name).join(", ")}function J(t){var m;if(!r.currentTrack)return;(m=t.dataTransfer)==null||m.setData("text/plain",JSON.stringify(r.currentTrack)),t.target.classList.add("dragging")}function oe(t){t.target.classList.remove("dragging"),v.value=!1,b.value=[]}function G(t){!r.currentTrack||!r.canPlace||(v.value=!1,b.value=[],z("placeTrack",r.currentTrack,t))}function ee(t){z("useToken",t)}function V(t){!r.currentTrack||!r.canPlace||($.value=t,j.value=!0,"vibrate"in navigator&&navigator.vibrate(50))}function a(t){var _;if(t===null)return"";const o=((_=r.player)==null?void 0:_.timeline)||[],m=o.length;return t===0?m===0?"Place as your first track":`Place before ${o[0].name} (${o[0].year})`:t===m?`Place after ${o[m-1].name} (${o[m-1].year})`:`Place between ${o[t-1].name} (${o[t-1].year}) and ${o[t].name} (${o[t].year})`}function u(){$.value!==null&&r.currentTrack&&(z("placeTrack",r.currentTrack,$.value),$.value=null,j.value=!1)}function M(){$.value=null,j.value=!1}function I(t){if(!(!r.currentTrack||!r.canPlace))try{t.preventDefault(),g.value=!0;const o=t.touches[0];if(!o)return;S.value={x:o.clientX,y:o.clientY},H.value={x:o.clientX,y:o.clientY};const m=t.target,_=m.getBoundingClientRect();d.value=m.cloneNode(!0),d.value.style.position="fixed",d.value.style.top=`${_.top}px`,d.value.style.left=`${_.left}px`,d.value.style.width=`${_.width}px`,d.value.style.height=`${_.height}px`,d.value.style.zIndex="9999",d.value.style.opacity="0.8",d.value.style.transform="rotate(2deg)",d.value.style.pointerEvents="none",d.value.classList.add("dragging"),document.body.appendChild(d.value),m.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(50)}catch(o){console.warn("Touch start error:",o),c()}}function E(t){if(!g.value)return;t.preventDefault();const o=t.touches[0];W(o.clientY),C.value={x:o.clientX,y:o.clientY};const m=50,_=50;d.value&&(d.value.style.left=`${o.clientX-m}px`,d.value.style.top=`${o.clientY-_}px`);const O=document.elementFromPoint(o.clientX,o.clientY),Z=O==null?void 0:O.closest("[data-drop-zone]");if(v.value=!1,b.value.fill(!1),Z){const h=parseInt(Z.getAttribute("data-drop-zone")||"0");h===0?v.value=!0:h<=b.value.length&&(b.value[h]=!0)}}function U(t){if(te(),!!g.value)try{t.preventDefault(),g.value=!1;const o=t.changedTouches[0];if(!o){c();return}const m=document.elementFromPoint(o.clientX,o.clientY),_=m==null?void 0:m.closest("[data-drop-zone]");d.value&&(d.value.style.transition="opacity 0.2s ease-out",d.value.style.opacity="0",setTimeout(()=>{d.value&&document.body.contains(d.value)&&document.body.removeChild(d.value),d.value=null},200));const O=document.querySelector(".dragging");if(O&&O.classList.remove("dragging"),v.value=!1,b.value.fill(!1),_&&r.currentTrack){const Z=parseInt(_.getAttribute("data-drop-zone")||"0");"vibrate"in navigator&&navigator.vibrate(100),z("placeTrack",r.currentTrack,Z)}}catch(o){console.warn("Touch end error:",o),c()}}function Q(t){g.value&&(W(t.clientY),C.value={x:t.clientX,y:t.clientY})}function ue(){te(),d.value&&(d.value.style.transition="opacity 0.2s ease-out",d.value.style.opacity="0",setTimeout(()=>{d.value&&document.body.contains(d.value)&&document.body.removeChild(d.value),d.value=null},200));const t=document.querySelector(".dragging");t&&t.classList.remove("dragging"),v.value=!1,b.value.fill(!1)}function W(t){A||(A=setInterval(()=>{const o=window.innerHeight,m=100,_=5;t<m?window.scrollBy(0,-_):t>o-m&&window.scrollBy(0,_)},16))}function te(){A&&(clearInterval(A),A=null)}function l(){var o;const t=((o=r.player)==null?void 0:o.timeline)||[];b.value=new Array(t.length+1).fill(!1)}function c(){g.value=!1,v.value=!1,b.value.fill(!1),d.value&&document.body.contains(d.value)&&(document.body.removeChild(d.value),d.value=null),document.querySelectorAll(".dragging").forEach(o=>o.classList.remove("dragging"))}ie(()=>{te(),c()}),fe(()=>{var t;return(((t=r.player)==null?void 0:t.timeline)||[]).length},()=>{l()},{immediate:!0});function P(){M()}function B(){u()}function Y(t){t.stopPropagation();const o=t.target;o.style.transform="scale(0.95)"}function X(t){t.preventDefault(),t.stopPropagation();const o=t.target;o.style.transform="","vibrate"in navigator&&navigator.vibrate(50),M()}function ae(t){t.stopPropagation();const o=t.target;o.style.transform="scale(0.95)"}function le(t){t.preventDefault(),t.stopPropagation();const o=t.target;o.style.transform="","vibrate"in navigator&&navigator.vibrate(50),u()}function re(){}function se(t){const o=t.target;o.style.transform=""}return(t,o)=>{var m,_,O,Z;return n(),i("div",{class:R(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":t.isCurrent}])},[t.isCurrent?(n(),i("div",It,o[18]||(o[18]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):y("",!0),e("div",Et,[e("div",Dt,[e("h3",Mt,[e("span",{class:R(t.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},s(t.player.name),3),t.isCurrent?(n(),i("span",jt,"👑")):y("",!0)]),e("div",zt,[e("p",Bt,s(t.player.score),1),e("div",Nt,[o[19]||(o[19]=e("span",{class:"text-lg"},"🎵",-1)),e("span",Rt,s(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(n(),i("div",Vt,[e("h4",Lt,s(t.$t("game.tokenAbilities")),1),e("div",Ft,[e("button",{onClick:o[0]||(o[0]=h=>ee("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:t.$t("game.tokens.skip.description")},[e("div",Ht,[o[20]||(o[20]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,s(t.$t("game.tokens.skip.label")),1)])],8,Ot),e("button",{onClick:o[1]||(o[1]=h=>ee("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:t.$t("game.tokens.hint.description")},[e("div",Yt,[o[21]||(o[21]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,s(t.$t("game.tokens.hint.label")),1)])],8,Ut)])])):y("",!0),e("div",Xt,[e("h4",qt,[o[22]||(o[22]=e("span",{class:"mr-2"},"🎵",-1)),ve(" "+s(t.$t("game.timeline.title")),1)]),!t.player.timeline||t.player.timeline.length===0?(n(),i("div",Gt,[o[23]||(o[23]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Qt,s(t.$t("game.timeline.empty")),1),t.canPlace?(n(),i("div",{key:0,class:R(["timeline-slot mt-6 group",{"drag-over":v.value,selected:$.value===0&&f.value}]),onDragover:o[2]||(o[2]=D(h=>v.value=!0,["prevent"])),onDragleave:o[3]||(o[3]=D(h=>v.value=!1,["prevent"])),onDrop:o[4]||(o[4]=D(h=>G(0),["prevent"])),onTouchstart:o[5]||(o[5]=D(h=>f.value?V(0):null,["prevent"])),onClick:o[6]||(o[6]=h=>f.value?V(0):null),"data-drop-zone":0},[e("div",{class:R(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":$.value===0&&f.value}])},[e("p",Kt,s(f.value?t.$t("game.timeline.tapToSelect"):t.$t("game.timeline.placeHere")),1)],2)],34)):y("",!0)])):t.player.timeline&&t.player.timeline.length>0?(n(),i("div",Wt,[t.canPlace?(n(),i("div",{key:0,class:R(["timeline-slot h-20 group",{"drag-over":b.value[0],selected:$.value===0&&f.value}]),onDragover:o[7]||(o[7]=D(h=>b.value[0]=!0,["prevent"])),onDragleave:o[8]||(o[8]=D(h=>b.value[0]=!1,["prevent"])),onDrop:o[9]||(o[9]=D(h=>G(0),["prevent"])),onTouchstart:o[10]||(o[10]=D(h=>f.value?V(0):null,["prevent"])),onClick:o[11]||(o[11]=h=>f.value?V(0):null),"data-drop-zone":0},[e("div",{class:R(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":$.value===0&&f.value}])},[e("p",Zt,s(f.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeEarlier")),1)],2)],34)):y("",!0),(n(!0),i(ge,null,me(t.player.timeline||[],(h,x)=>{var be;return n(),i("div",{key:h.id,class:"track-card group relative"},[e("div",Jt,[e("div",eo,[e("div",to,[h.revealed?(n(),i("img",{key:0,src:L(h),alt:h.name,class:"w-16 h-16 object-cover"},null,8,oo)):(n(),i("div",so,o[24]||(o[24]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",ao,[e("p",lo,s(h.name),1),e("p",ro,s(F(h)),1)]),e("div",no,[e("p",io,s(h.year),1)])])]),t.canPlace&&x<(((be=t.player.timeline)==null?void 0:be.length)||0)-1?(n(),i("div",{key:0,class:R(["timeline-slot h-20 mt-3 group",{"drag-over":b.value[x+1],selected:$.value===x+1&&f.value}]),onDragover:D(ne=>b.value[x+1]=!0,["prevent"]),onDragleave:D(ne=>b.value[x+1]=!1,["prevent"]),onDrop:D(ne=>G(x+1),["prevent"]),onTouchstart:D(ne=>f.value?V(x+1):null,["prevent"]),onClick:ne=>f.value?V(x+1):null,"data-drop-zone":x+1},[e("div",{class:R(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":$.value===x+1&&f.value}])},[e("p",co,s(f.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeBetween")),1)],2)],42,uo)):y("",!0)])}),128)),t.canPlace?(n(),i("div",{key:1,class:R(["timeline-slot h-20 group",{"drag-over":b.value[((m=t.player.timeline)==null?void 0:m.length)||0],selected:$.value===(((_=t.player.timeline)==null?void 0:_.length)||0)&&f.value}]),onDragover:o[12]||(o[12]=D(h=>{var x;return b.value[((x=t.player.timeline)==null?void 0:x.length)||0]=!0},["prevent"])),onDragleave:o[13]||(o[13]=D(h=>{var x;return b.value[((x=t.player.timeline)==null?void 0:x.length)||0]=!1},["prevent"])),onDrop:o[14]||(o[14]=D(h=>{var x;return G(((x=t.player.timeline)==null?void 0:x.length)||0)},["prevent"])),onTouchstart:o[15]||(o[15]=D(h=>{var x;return f.value?V(((x=t.player.timeline)==null?void 0:x.length)||0):null},["prevent"])),onClick:o[16]||(o[16]=h=>{var x;return f.value?V(((x=t.player.timeline)==null?void 0:x.length)||0):null}),"data-drop-zone":((O=t.player.timeline)==null?void 0:O.length)||0},[e("div",{class:R(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":$.value===(((Z=t.player.timeline)==null?void 0:Z.length)||0)&&f.value}])},[e("p",go,s(f.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeLater")),1)],2)],42,vo)):y("",!0)])):y("",!0)]),t.canPlace&&t.currentTrack?(n(),i("div",{key:1,ref_key:"scrollContainer",ref:T,class:"timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl cursor-move touch-manipulation select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",draggable:"true",onDragstart:J,onDragend:oe,onTouchstart:I,onTouchmove:E,onTouchend:U,onMousemove:Q,onMouseup:ue,style:{touchAction:"none"}},[e("div",mo,[o[25]||(o[25]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",po,[e("p",fo,s(t.$t("game.newTrack")),1),e("p",bo,s(t.$t("game.dragToPlace")),1)]),o[26]||(o[26]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],544)):y("",!0),t.player.timeline&&t.player.timeline.length>0?(n(),i("div",ho,[e("div",yo,[e("span",ko,s(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),N.value?(n(),i("span",xo,s(N.value),1)):y("",!0)])])):y("",!0)]),j.value&&f.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:re},[e("div",{class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-6 max-w-sm w-full mx-auto relative overflow-hidden",onClick:o[17]||(o[17]=D(()=>{},["stop"]))},[o[28]||(o[28]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",wo,[e("div",$o,[o[27]||(o[27]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",_o,s(t.$t("game.timeline.selectedPosition")),1)]),e("div",Co,[e("p",To,s(a($.value)),1)]),e("div",Po,[e("button",{onClick:P,onTouchstart:Y,onTouchend:X,onTouchcancel:se,class:"flex-1 px-4 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 active:from-gray-500 active:to-gray-600 text-white font-medium rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg select-none",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},s(t.$t("game.timeline.cancelSelection")),33),e("button",{onClick:B,onTouchstart:ae,onTouchend:le,onTouchcancel:se,class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-500 hover:to-blue-500 active:from-green-500 active:to-blue-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-green-500/25 select-none",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},s(t.$t("game.timeline.confirmPlacement")),33)])])])])):y("",!0)],2)}}}),Ao={class:"min-h-screen flex flex-col"},Io={class:"bg-white/10 backdrop-blur-sm p-4"},Eo={class:"flex justify-between items-center"},Do={class:"flex items-center space-x-4"},Mo={class:"text-white"},jo={class:"text-xl font-bold"},zo={class:"flex items-center space-x-3 text-sm opacity-80"},Bo={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},No={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},Ro={class:"text-white text-right"},Vo={class:"text-sm opacity-80"},Lo={class:"flex-1 container mx-auto px-4 py-6"},Fo={key:0,class:"max-w-2xl mx-auto"},Oo={class:"card text-center"},Ho={class:"text-2xl font-semibold mb-4"},Uo={class:"text-gray-600 mb-6"},Yo={key:1,class:"space-y-6"},Xo={class:"card text-center bg-green-50 border-green-200"},qo={class:"text-2xl font-bold text-white mb-2"},Go={class:"text-white"},Qo={key:0,class:"mt-4"},Ko={key:1,class:"mt-4"},Wo={class:"flex items-center justify-center space-x-2"},Zo={key:0,class:"card bg-yellow-50 border-yellow-200"},Jo={class:"flex items-center space-x-3"},es={class:"flex-1"},ts={class:"text-lg font-semibold text-yellow-800"},os={class:"text-yellow-700 text-sm"},ss={class:"flex space-x-2"},as={key:1,class:"card bg-orange-50 border-orange-200"},ls={key:2,class:"card bg-blue-50 border-blue-200"},rs={key:4,class:"text-center mb-6"},ns={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},is={class:"mb-4"},us={class:"flex items-center justify-center mb-3"},cs={class:"text-center"},ds={class:"text-2xl font-bold text-red-200 mb-2"},vs={class:"text-red-100"},gs={class:"text-lg font-semibold"},ms={class:"text-base"},ps={class:"text-sm opacity-90"},fs={class:"text-red-200 text-lg mb-4"},bs={class:"text-red-300 text-sm"},hs={key:5,class:"max-w-4xl mx-auto"},ys={class:"card"},ks={class:"text-lg font-semibold mb-4 text-gray-100"},xs={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ws={class:"font-semibold text-gray-800"},$s={class:"text-2xl font-bold text-gray-900"},_s={class:"text-sm text-gray-600"},Cs={class:"text-xs text-gray-500"},Ts={key:2,class:"max-w-2xl mx-auto"},Ps={class:"card text-center"},Ss={class:"text-3xl font-bold mb-4 text-white"},As={class:"text-xl mb-6"},Is={class:"mb-6"},Es={class:"text-lg font-semibold mb-3"},Ds={class:"space-y-2"},Ms={class:"font-medium"},js={class:"font-bold"},zs={class:"flex space-x-4 justify-center"},Bs={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Ns={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Rs={class:"relative z-10"},Vs={class:"flex items-center space-x-3 mb-6"},Ls={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Fs={class:"mb-8"},Os={class:"text-gray-200 text-lg leading-relaxed"},Hs={class:"flex justify-center"},Ys=pe({__name:"GameView",setup(K){const q=xe(),r=ke(),z=p(!1),v=p(!1),b=p(""),$=p(k.isAuthenticated()),j=p(!1),g=p(!1),S=p(!1),H=p({isCorrect:!1,pointsEarned:0}),d=w(()=>r.players),C=w(()=>r.currentPlayer),T=w(()=>r.currentTrack),A=w(()=>r.gamePhase),f=w(()=>r.round),N=w(()=>r.settings),L=w(()=>r.winner),F=w(()=>$.value),J=w(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),oe=w(()=>F.value?!k.isPlayerReady()&&ee.value>3e4:!1),G=p(Date.now()),ee=w(()=>Date.now()-G.value),V=w(()=>[...d.value].sort((l,c)=>{var Y,X;const P=((Y=l.timeline)==null?void 0:Y.length)||0,B=((X=c.timeline)==null?void 0:X.length)||0;return B!==P?B-P:c.tokens!==l.tokens?c.tokens-l.tokens:c.score-l.score}));async function a(){var l;z.value=!0,j.value=!1,g.value=!1,H.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const c=await r.getNextTrack();c?console.log("Track loaded successfully:",c.name,"by",(l=c.artists[0])==null?void 0:l.name):console.error("No tracks available")}catch(c){console.error("Error loading track:",c)}finally{z.value=!1}}function u(l,c){const P=r.placeTrackOnTimeline(l,c);let B=0;P&&C.value&&(B=1,C.value.timeline.length>=5&&(B=2),C.value.timeline.length>=8&&(B=3)),H.value={isCorrect:P,pointsEarned:B},j.value=!0,setTimeout(()=>{g.value=!0},500),P?setTimeout(()=>{j.value=!1,g.value=!1,r.nextPlayer()},4e3):setTimeout(()=>{if(S.value=!0,C.value&&T.value){const Y=M(T.value,C.value.timeline),X={...T.value,revealed:!0};r.addTrackToTimelineAtPosition(X,Y)}},1500)}function M(l,c){for(let P=0;P<c.length;P++)if(l.year<=c[P].year)return P;return c.length}function I(){T.value&&C.value&&r.removeTrackFromTimeline(T.value.id),j.value=!1,g.value=!1,S.value=!1,r.nextPlayer()}function E(l){var P;if(!C.value)return;if(r.useToken(C.value.id,l))switch(l){case"skip":a();break;case"hint":const B=Math.floor(((P=T.value)==null?void 0:P.year)/10)*10;b.value=`This track was released in the ${B}s`,v.value=!0;break}}function U(){v.value=!1,b.value=""}function Q(){r.resetGame(),q.push("/")}function ue(){q.push("/")}function W(){const l=k.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:l,previousState:F.value}),$.value!==l&&($.value=l,console.log("Spotify auth state updated:",l)),l&&!k.isPlayerReady()&&(console.log("Initializing player after auth check"),k.initializePlayerIfReady())}async function te(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await k.forceReauth(),W()}return ce(()=>{r.gamePhase==="setup"&&r.players.length===0&&q.push("/"),W(),k.isAuthenticated()&&k.startSessionMaintenance();const l=setInterval(()=>{$.value?k.startSessionMaintenance():W()},12e4);ie(()=>{clearInterval(l),k.stopSessionMaintenance()})}),fe(T,l=>{l&&(j.value=!1,g.value=!1,H.value={isCorrect:!1,pointsEarned:0})}),(l,c)=>{var P,B,Y,X,ae,le,re,se;return n(),i("div",Ao,[e("header",Io,[e("div",Eo,[e("div",Do,[e("button",{onClick:c[0]||(c[0]=t=>l.$router.push("/")),class:"btn btn-secondary"}," ← "+s(l.$t("common.back")),1),e("div",Mo,[e("h1",jo,s(l.$t("game.title")),1),e("div",zo,[e("span",null,s(l.$t("game.round"))+" "+s(f.value),1),N.value.theme?(n(),i("span",Bo," 🎵 "+s(l.$t(`game.themes.${N.value.theme}`)),1)):(n(),i("span",No," 🎵 "+s(l.$t("game.allMusic")),1))])])]),e("div",Ro,[e("p",Vo,s(l.$t("game.turn.currentPlayer",{player:(P=C.value)==null?void 0:P.name})),1)])])]),e("main",Lo,[A.value==="setup"?(n(),i("div",Fo,[e("div",Oo,[e("h2",Ho,s(l.$t("game.setupRequired")),1),e("p",Uo,s(l.$t("game.setupMessage")),1),e("button",{onClick:c[1]||(c[1]=t=>l.$router.push("/")),class:"btn btn-primary"},s(l.$t("game.backToSetup")),1)])])):A.value==="playing"?(n(),i("div",Yo,[e("div",Xo,[e("h2",qo,s(l.$t("game.turn.currentPlayer",{player:(B=C.value)==null?void 0:B.name})),1),e("p",Go,s(l.$t("game.turn.ready")),1),!T.value&&!z.value?(n(),i("div",Qo,[e("button",{onClick:a,class:"btn btn-primary btn-lg"}," 🎵 "+s(l.$t("game.getTrack")),1)])):y("",!0),z.value?(n(),i("div",Ko,[e("div",Wo,[c[3]||(c[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,s(l.$t("common.loading")),1)])])):y("",!0)]),F.value?F.value&&oe.value?(n(),i("div",as,[e("div",{class:"flex items-center space-x-3"},[c[5]||(c[5]=de('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:te,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):y("",!0):(n(),i("div",Zo,[e("div",Jo,[c[4]||(c[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",es,[e("h3",ts,s(l.$t("game.spotify.notConnected")),1),e("p",os,s(l.$t("game.demoModeActive")),1)]),e("div",ss,[e("button",{onClick:ue,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},s(l.$t("game.spotify.login")),1),e("button",{onClick:te,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:W,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),J.value&&F.value?(n(),i("div",ls,c[6]||(c[6]=[de('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):y("",!0),T.value?(n(),we(At,{key:3,track:T.value,"show-result":j.value,"show-answer":g.value,"is-correct":H.value.isCorrect,"points-earned":H.value.pointsEarned,onPlaceTrack:u},null,8,["track","show-result","show-answer","is-correct","points-earned"])):y("",!0),S.value&&!H.value.isCorrect?(n(),i("div",rs,[e("div",ns,[e("div",is,[e("div",us,[c[7]||(c[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",cs,[e("h3",ds,s(l.$t("game.turn.wrongPlacement")),1),e("div",vs,[e("p",gs,s((Y=T.value)==null?void 0:Y.name),1),e("p",ms,s((X=T.value)==null?void 0:X.artists.map(t=>t.name).join(", ")),1),e("p",ps,s(l.$t("game.turn.releasedIn",{year:(ae=T.value)==null?void 0:ae.year})),1)])])]),e("p",fs,s(l.$t("game.turn.correctPlacement")),1),e("p",bs,s(l.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:I,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},s(l.$t("game.turn.continue")),1)])])):y("",!0),C.value&&C.value.timeline?(n(),i("div",hs,[$e(So,{player:C.value,"is-current":!0,"current-track":T.value,"can-place":!!T.value,onPlaceTrack:u,onUseToken:E},null,8,["player","current-track","can-place"])])):y("",!0),e("div",ys,[e("h3",ks,s(l.$t("game.score.title")),1),e("div",xs,[(n(!0),i(ge,null,me(d.value,t=>{var o;return n(),i("div",{key:t.id,class:R(["text-center p-3 rounded-lg",t.id===((o=C.value)==null?void 0:o.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",ws,s(t.name),1),e("p",$s,s(t.tokens),1),e("p",_s,s(l.$t("game.score.tokens",{count:t.tokens})),1),e("p",Cs,s(l.$t("game.score.total",{score:t.score})),1)],2)}),128))])])])):A.value==="finished"?(n(),i("div",Ts,[e("div",Ps,[e("h2",Ss,s(l.$t("game.end.title")),1),e("p",As,s(l.$t("game.end.winner",{player:(le=L.value)==null?void 0:le.name,score:((se=(re=L.value)==null?void 0:re.timeline)==null?void 0:se.length)||0})),1),e("div",Is,[e("h3",Es,s(l.$t("game.end.finalScores")),1),e("div",Ds,[(n(!0),i(ge,null,me(V.value,(t,o)=>{var m;return n(),i("div",{key:t.id,class:R(["flex justify-between items-center p-3 rounded-lg",o===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Ms,s(o+1)+". "+s(t.name),1),e("span",js,s(((m=t.timeline)==null?void 0:m.length)||0)+" "+s(l.$t("game.songs"))+" | "+s(t.tokens)+" "+s(l.$t("game.score.tokens",{count:t.tokens})),1)],2)}),128))])]),e("div",zs,[e("button",{onClick:Q,class:"btn btn-primary"}," 🔄 "+s(l.$t("game.end.playAgain")),1),e("button",{onClick:c[2]||(c[2]=t=>l.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+s(l.$t("game.backToHome")),1)])])])):y("",!0)]),v.value?(n(),i("div",Bs,[e("div",Ns,[c[9]||(c[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Rs,[e("div",Vs,[c[8]||(c[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Ls,s(l.$t("game.tokens.hint.label")),1)]),e("div",Fs,[e("p",Os,s(b.value),1)]),e("div",Hs,[e("button",{onClick:U,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},s(l.$t("common.close")),1)])])])])):y("",!0)])}}});export{Ys as default};
