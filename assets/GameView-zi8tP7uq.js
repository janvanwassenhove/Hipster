import{d as de,n as ve,r as b,c as f,s as h,o as ne,a as te,p as ce,w as se,b as n,e,g,q as re,t as o,f as ie,x as D,k as a,h as A,F as oe,j as le,u as ge,l as pe,y as me,z as be}from"./index-DjvMH0cX.js";const fe={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},he={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},ye={class:"flex-shrink-0"},ke={key:0,class:"relative group"},xe={key:1,class:"relative group"},we=["src","alt"],$e={class:"flex-1 text-center md:text-left"},_e={class:"mb-3"},Ce={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Te={class:"text-xs text-gray-400 mt-1 font-light"},Pe={class:"mb-3"},Ee={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Ie={class:"flex items-center justify-between mb-3"},Se={class:"flex items-center"},Ae={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},De={class:"text-left space-y-2"},Me={class:"text-amber-200 text-xs font-medium"},Ne={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},Le={class:"text-amber-100 font-medium mb-2"},Re={class:"text-amber-200 space-y-1 list-decimal list-inside"},je={class:"flex justify-center space-x-3 mt-4"},ze=["disabled"],Oe={key:0,class:"flex items-center"},Be={key:1},Ve={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Fe={class:"flex items-center justify-center mb-2"},He={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},Ue={class:"text-green-200 text-xs"},We={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Ge={class:"flex items-center justify-center mb-2"},Ye={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Ke={class:"text-blue-200 text-xs"},qe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},Je={class:"flex items-center justify-center space-x-4 mb-3"},Qe=["disabled"],Xe={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},Ze={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},et={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},tt={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},st={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},ot={class:"text-center"},lt={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},at={class:"text-blue-200 text-sm font-medium mb-1"},nt={class:"text-blue-300 text-sm font-medium"},rt={class:"text-sm text-blue-400 mt-3"},it=["href"],dt={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},ut={class:"text-center"},ct={class:"flex items-center justify-center mb-2"},vt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},gt={class:"text-purple-200 text-xs font-medium"},pt={class:"flex items-center justify-center mb-2"},mt={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},bt={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},ft={class:"font-bold text-lg"},ht={key:0,class:"text-sm mt-1 font-semibold"},yt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},kt=de({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(U,{emit:F}){const i=U,{t:M}=ve(),p=b(!1),k=b(!1);b(!1);const y=b(0),T=b(0);b(.7),b(!1),b(!1),b(!1);const c=b(null),x=b(!1),R=f(()=>{var w,E,I,V;const l=(E=(w=i.track.images)==null?void 0:w[0])==null?void 0:E.url,d=(V=(I=i.track.album.images)==null?void 0:I[0])==null?void 0:V.url;return l||d||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),_=f(()=>i.track.artists.map(l=>l.name).join(", ")),P=f(()=>i.showResult?i.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),C=f(()=>i.showResult?i.isCorrect?M("game.turn.correct",{year:i.track.year}):M("game.turn.incorrect",{year:i.track.year}):"");f(()=>T.value===0?0:y.value/T.value*100);const r=f(()=>!!i.track.uri),j=f(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),N=f(()=>j.value?r.value&&h.isAuthenticated():r.value&&h.isPlayerReady()),z=f(()=>N.value);async function O(){k.value=!0,c.value=null,x.value=!1;try{if(!await h.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");N.value&&i.track.uri&&(p.value?await h.pausePlayback()&&(p.value=!1):await h.startPlayback(i.track.uri)&&(p.value=!0,j.value?q():J()))}catch(l){console.error("Playback error:",l),l.message==="NO_DEVICES_AVAILABLE"?(c.value="NO_DEVICES",x.value=!0):l.message==="DEVICE_NOT_FOUND"||l.message==="DEVICE_BECAME_INACTIVE"?(c.value="DEVICE_INACTIVE",x.value=!0):l.message==="PREMIUM_REQUIRED"?c.value="PREMIUM_REQUIRED":l.message==="DEVICE_ACTIVATION_FAILED"?(c.value="ACTIVATION_FAILED",x.value=!0):l.message.includes("No active Spotify device")||l.message.includes("No Spotify devices available")?(c.value="DEVICE_INACTIVE",x.value=!0):c.value="PLAYBACK_FAILED"}finally{k.value=!1}}function W(){x.value=!1,c.value=null}async function K(){x.value=!1,c.value=null,await O()}function q(){const l=async()=>{var w;if(!N.value||!j.value)return;await h.keepSpotifyConnectActive();const d=await h.getSpotifyConnectState();if(d){const E=((w=d.item)==null?void 0:w.uri)===i.track.uri,I=d.is_playing&&E;p.value!==I&&(p.value=I),p.value&&setTimeout(l,5e3)}else p.value&&(console.log("🔇 No active playback detected - device may have become inactive"),p.value=!1,!x.value&&!c.value&&await h.hasAvailableDevices()&&(c.value="DEVICE_INACTIVE",x.value=!0))};l()}function J(){const l=async()=>{if(!N.value)return;const d=await h.getPlaybackState();d&&(p.value=!d.paused,y.value=d.position/1e3,T.value=d.duration/1e3,p.value&&setTimeout(l,1e3))};l()}async function Q(){var l,d,w,E;if(h.isPlayerReady())try{const I=await h.getPlaybackState();if(I){const V=((d=(l=I.track_window)==null?void 0:l.current_track)==null?void 0:d.uri)===i.track.uri,H=I.paused===!1&&V;console.log("Playback state check:",{paused:I.paused,currentTrackUri:(E=(w=I.track_window)==null?void 0:w.current_track)==null?void 0:E.uri,expectedUri:i.track.uri,isCurrentTrack:V,isActuallyPlaying:H,componentIsPlaying:p.value}),p.value!==H&&(console.log(`🔄 Syncing playback state: ${p.value} → ${H}`),p.value=H)}}catch(I){console.warn("Could not check playback state:",I)}}return ne(()=>{const l=setInterval(Q,2e3);te(()=>{clearInterval(l)})}),ne(()=>{h.isAuthenticated()&&ce(()=>{h.initializePlayerIfReady()})}),se(()=>i.track,async(l,d)=>{if(l&&l!==d){console.log("New track detected:",l.name),c.value=null,x.value=!1,await ce(),p.value=!1;const w=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:z.value,canPlayFullTrack:N.value,hasSpotifyUri:r.value,isPlayerReady:h.isPlayerReady(),isPlaying:p.value}),z.value&&!p.value){console.log("Auto-starting playback for new track:",l.name);try{await h.ensurePlaybackReady()?(await O(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(E){w?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",E)}}else{const E=z.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${E}`),!w&&r.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),te(()=>{N.value&&h.stopPlayback()}),(l,d)=>(a(),n("div",fe,[d[13]||(d[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",he,[e("div",ye,[l.showAnswer?(a(),n("div",xe,[e("img",{src:R.value,alt:l.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,we),d[1]||(d[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(a(),n("div",ke,d[0]||(d[0]=[re('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",$e,[e("div",_e,[e("p",Ce,o(l.$t("game.turn.listening")),1),e("p",Te,o(l.$t("game.turn.placeOnTimeline")),1)]),e("div",Pe,[x.value?(a(),n("div",Ee,[e("div",Ie,[e("div",Se,[d[2]||(d[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",Ae,o(c.value==="NO_DEVICES"?l.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):c.value==="DEVICE_INACTIVE"?l.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):c.value==="ACTIVATION_FAILED"?l.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):l.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:W,class:"text-amber-300 hover:text-amber-100 transition-colors"},d[3]||(d[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",De,[e("p",Me,o(c.value==="NO_DEVICES"?l.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):c.value==="DEVICE_INACTIVE"?l.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):c.value==="ACTIVATION_FAILED"?l.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):l.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",Ne,[e("p",Le,o(l.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",Re,[e("li",null,o(l.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,o(l.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,o(l.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",je,[e("button",{onClick:K,disabled:k.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[k.value?(a(),n("span",Oe,[d[4]||(d[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),ie(" "+o(l.$t("game.deviceHelp.retrying","Retrying...")),1)])):(a(),n("span",Be,o(l.$t("game.deviceHelp.retry","Try Again")),1))],8,ze),e("button",{onClick:W,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},o(l.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):g("",!0),!z.value&&j.value&&r.value?(a(),n("div",Ve,[e("div",Fe,[d[5]||(d[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",He,o(l.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",Ue,o(l.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):N.value?g("",!0):(a(),n("div",We,[e("div",Ge,[d[6]||(d[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ye,o(r.value?l.$t("game.premiumRequired"):l.$t("game.demoMode")),1)]),e("p",Ke,o(r.value?l.$t("game.needsPremium"):l.$t("game.needSpotifyForAudio")),1)])),z.value?(a(),n("div",qe,[e("div",Je,[e("button",{onClick:O,class:"play-btn group relative",disabled:!z.value},[e("div",Xe,[k.value?(a(),n("div",Ze)):p.value?(a(),n("svg",et,d[7]||(d[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(a(),n("svg",tt,d[8]||(d[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,Qe)])])):g("",!0)]),l.showAnswer?(a(),n("div",st,[e("div",ot,[e("h4",lt,o(l.track.name),1),e("p",at,o(_.value),1),e("p",nt,o(l.track.album.name)+" ("+o(l.track.year)+")",1),e("p",rt,[e("a",{href:l.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[d[9]||(d[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),ie(" "+o(l.$t("game.openInSpotify")),1)],8,it)])])])):g("",!0)])]),l.showAnswer?g("",!0):(a(),n("div",dt,[e("div",ut,[e("div",ct,[d[10]||(d[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",vt,o(l.$t("game.turn.placing")),1)]),e("p",gt,o(j.value?l.$t("game.timeline.mobileInstructions"):l.$t("game.dragToTimeline")),1)])])),l.showResult?(a(),n("div",{key:1,class:D(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",P.value])},[e("div",pt,[l.isCorrect?(a(),n("div",mt,d[11]||(d[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(a(),n("div",bt,d[12]||(d[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",ft,o(C.value),1)]),l.pointsEarned>0?(a(),n("p",ht,[e("span",yt,o(l.$t("game.turn.points",{points:l.pointsEarned})),1)])):g("",!0)],2)):g("",!0)]))}}),xt=(U,F)=>{const i=U.__vccOpts||U;for(const[M,p]of F)i[M]=p;return i},wt=xt(kt,[["__scopeId","data-v-03b041d1"]]),$t={key:0,class:"absolute inset-0 opacity-10"},_t={class:"relative z-10"},Ct={class:"flex items-center justify-between mb-6"},Tt={class:"text-xl font-bold flex items-center space-x-3"},Pt={key:0,class:"text-2xl animate-bounce"},Et={class:"text-right"},It={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},St={class:"flex items-center space-x-2 text-sm text-gray-300"},At={class:"font-medium"},Dt={key:0,class:"mb-6"},Mt={class:"text-sm font-medium text-gray-300 mb-3"},Nt={class:"flex space-x-3"},Lt=["title"],Rt={class:"flex items-center space-x-2"},jt=["title"],zt={class:"flex items-center space-x-2"},Ot={class:"mb-6"},Bt={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Vt={key:0,class:"text-center py-12 text-gray-400"},Ft={class:"text-lg font-medium mb-2"},Ht={class:"text-center text-gray-300 font-medium"},Ut={key:1,class:"space-y-3"},Wt={class:"text-center text-gray-400 text-sm font-medium"},Gt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},Yt={class:"flex items-center space-x-4"},Kt={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},qt=["src","alt"],Jt={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},Qt={class:"flex-1 min-w-0"},Xt={class:"font-bold text-lg text-gray-100 truncate"},Zt={class:"text-sm text-gray-300 truncate font-medium"},es={class:"text-right flex-shrink-0"},ts={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},ss=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],os={class:"text-center text-gray-400 text-sm font-medium"},ls=["data-drop-zone"],as={class:"text-center text-gray-400 text-sm font-medium"},ns=["draggable"],rs={class:"flex items-center space-x-4"},is={class:"flex-1 min-w-0"},ds={class:"font-bold text-lg text-blue-200"},us={class:"text-sm text-blue-300 font-medium"},cs={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},vs={class:"flex justify-between text-sm text-gray-300"},gs={class:"font-medium"},ps={key:0,class:"font-mono"},ms={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",style:{"z-index":"9999"}},bs={class:"bg-slate-900 border border-purple-500/20 rounded-2xl p-6 max-w-sm w-full mx-auto relative",style:{"z-index":"10000"}},fs={key:0,class:"absolute top-2 right-2 bg-red-500 text-white text-xs p-1 rounded z-50"},hs={class:"relative z-10"},ys={class:"flex items-center space-x-3 mb-4"},ks={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},xs={class:"mb-6"},ws={class:"text-gray-200 text-lg leading-relaxed"},$s={key:0,class:"mb-4 p-2 bg-yellow-900/50 rounded text-xs text-yellow-200"},_s={key:0,class:"mt-2 p-2 bg-black/30 rounded max-h-32 overflow-y-auto"},Cs={class:"mt-4 text-center"},Ts=de({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(U,{emit:F}){const i=U,M=F,p=b(!1),k=b([]),y=b(null),T=b(!1);b({isPressed:!1,action:""});const c=b(!0),x=b([]),R=b("");b(0);function _(t){const u=`[${new Date().toLocaleTimeString()}] ${t}`;x.value.unshift(u),R.value=u,console.log("MOBILE_DEBUG:",u),x.value.length>10&&(x.value=x.value.slice(0,10))}function P(){c.value=!c.value,_(`Debug info ${c.value?"enabled":"disabled"}`)}function C(){_("Debug button clicked - system working")}const r=f(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),j=f(()=>"ontouchstart"in window),N=f(()=>navigator.maxTouchPoints||0),z=f(()=>navigator.userAgent),O=f(()=>`${window.innerWidth}x${window.innerHeight}`);_("PlayerTimeline component initialized"),_(`Environment: ${r.value?"Mobile":"Desktop"}, Touch: ${j.value}`),console.log("COMPONENT MOUNTED - JS DEFINITELY WORKING"),r.value&&console.log("MOBILE DEVICE DETECTED - Touch events should work");const W=f(()=>{var u;const t=((u=i.player)==null?void 0:u.timeline)||[];if(t.length<2)return null;const s=t.map($=>$.year).sort(($,L)=>$-L);return`${s[0]} - ${s[s.length-1]}`});function K(t){var s,u;return t.images&&t.images.length>0&&((s=t.images[0])!=null&&s.url)?t.images[0].url:t.album&&t.album.images&&t.album.images.length>0&&((u=t.album.images[0])!=null&&u.url)?t.album.images[0].url:"/placeholder-album.png"}function q(t){return t.artists.map(s=>s.name).join(", ")}function J(t){var u;if(!i.currentTrack)return;(u=t.dataTransfer)==null||u.setData("text/plain",JSON.stringify(i.currentTrack)),t.target.classList.add("dragging")}function Q(t){t.target.classList.remove("dragging"),p.value=!1,k.value=[]}function l(t){!i.currentTrack||!i.canPlace||(p.value=!1,k.value=[],M("placeTrack",i.currentTrack,t))}function d(t){M("useToken",t)}function w(t){if(_(`Timeline slot touched: position ${t}`),!i.currentTrack||!i.canPlace){_(`Cannot place: currentTrack=${!!i.currentTrack}, canPlace=${i.canPlace}`);return}y.value=t,T.value=!0,_(`Dialog opened: position=${t}, showConfirmation=${T.value}`),"vibrate"in navigator&&(navigator.vibrate(50),_("Haptic feedback triggered"))}function E(t){var $;if(t===null)return"";const s=(($=i.player)==null?void 0:$.timeline)||[],u=s.length;return t===0?u===0?"Place as your first track":`Place before ${s[0].name} (${s[0].year})`:t===u?`Place after ${s[u-1].name} (${s[u-1].year})`:`Place between ${s[t-1].name} (${s[t-1].year}) and ${s[t].name} (${s[t].year})`}function I(){"vibrate"in navigator&&navigator.vibrate(50)}function V(){var s;const t=((s=i.player)==null?void 0:s.timeline)||[];k.value=new Array(t.length+1).fill(!1)}te(()=>{}),se(()=>{var t;return(((t=i.player)==null?void 0:t.timeline)||[]).length},()=>{V()},{immediate:!0}),se(T,(t,s)=>{t&&!s?(console.log("DIALOG OPENED - JS IS WORKING!"),_(`Confirmation dialog opened - position: ${y.value}`),_(`Device info - Mobile: ${r.value}, Touch: ${j.value}, MaxTouch: ${N.value}`),setTimeout(()=>{console.log("DELAYED TEST - Still working after 1 second")},1e3)):!t&&s&&_("Confirmation dialog closed")});function H(){_("SIMPLE CANCEL clicked"),y.value=null,T.value=!1}function ae(){_("SIMPLE CONFIRM clicked"),y.value!==null&&i.currentTrack&&(M("placeTrack",i.currentTrack,y.value),y.value=null,T.value=!1)}function Y(){console.log("ULTRA_BASIC_TEST called"),alert("Vue click handler works!"),_("Ultra basic test clicked")}function ee(){console.log("EMERGENCY CLICK WORKS!"),alert("Emergency click worked!"),_("Emergency click button works")}return(t,s)=>{var u,$,L,B;return a(),n("div",{class:D(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":t.isCurrent}])},[t.isCurrent?(a(),n("div",$t,s[20]||(s[20]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):g("",!0),e("div",_t,[e("div",Ct,[e("h3",Tt,[e("span",{class:D(t.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},o(t.player.name),3),t.isCurrent?(a(),n("span",Pt,"👑")):g("",!0)]),e("div",Et,[e("p",It,o(t.player.score),1),e("div",St,[s[21]||(s[21]=e("span",{class:"text-lg"},"🎵",-1)),e("span",At,o(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(a(),n("div",Dt,[e("h4",Mt,o(t.$t("game.tokenAbilities")),1),e("div",Nt,[e("button",{onClick:s[0]||(s[0]=v=>d("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:t.$t("game.tokens.skip.description")},[e("div",Rt,[s[22]||(s[22]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,o(t.$t("game.tokens.skip.label")),1)])],8,Lt),e("button",{onClick:s[1]||(s[1]=v=>d("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:t.$t("game.tokens.hint.description")},[e("div",zt,[s[23]||(s[23]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,o(t.$t("game.tokens.hint.label")),1)])],8,jt)])])):g("",!0),e("div",Ot,[e("h4",Bt,[s[24]||(s[24]=e("span",{class:"mr-2"},"🎵",-1)),ie(" "+o(t.$t("game.timeline.title")),1)]),!t.player.timeline||t.player.timeline.length===0?(a(),n("div",Vt,[s[25]||(s[25]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Ft,o(t.$t("game.timeline.empty")),1),t.canPlace?(a(),n("div",{key:0,class:D(["timeline-slot mt-6 group",{"drag-over":!r.value&&p.value,selected:y.value===0&&r.value}]),onDragover:s[2]||(s[2]=A(v=>r.value?null:p.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=A(v=>r.value?null:p.value=!1,["prevent"])),onDrop:s[4]||(s[4]=A(v=>r.value?null:l(0),["prevent"])),onTouchstart:s[5]||(s[5]=A(v=>r.value?w(0):null,["prevent"])),onClick:s[6]||(s[6]=v=>r.value?w(0):null),"data-drop-zone":0},[e("div",{class:D(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":y.value===0&&r.value}])},[e("p",Ht,o(r.value?t.$t("game.timeline.tapToSelect"):t.$t("game.timeline.placeHere")),1)],2)],34)):g("",!0)])):t.player.timeline&&t.player.timeline.length>0?(a(),n("div",Ut,[t.canPlace?(a(),n("div",{key:0,class:D(["timeline-slot h-20 group",{"drag-over":!r.value&&k.value[0],selected:y.value===0&&r.value}]),onDragover:s[7]||(s[7]=A(v=>r.value?null:k.value[0]=!0,["prevent"])),onDragleave:s[8]||(s[8]=A(v=>r.value?null:k.value[0]=!1,["prevent"])),onDrop:s[9]||(s[9]=A(v=>r.value?null:l(0),["prevent"])),onTouchstart:s[10]||(s[10]=A(v=>r.value?w(0):null,["prevent"])),onClick:s[11]||(s[11]=v=>r.value?w(0):null),"data-drop-zone":0},[e("div",{class:D(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":y.value===0&&r.value}])},[e("p",Wt,o(r.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeEarlier")),1)],2)],34)):g("",!0),(a(!0),n(oe,null,le(t.player.timeline||[],(v,m)=>{var X;return a(),n("div",{key:v.id,class:"track-card group relative"},[e("div",Gt,[e("div",Yt,[e("div",Kt,[v.revealed?(a(),n("img",{key:0,src:K(v),alt:v.name,class:"w-16 h-16 object-cover"},null,8,qt)):(a(),n("div",Jt,s[26]||(s[26]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",Qt,[e("p",Xt,o(v.name),1),e("p",Zt,o(q(v)),1)]),e("div",es,[e("p",ts,o(v.year),1)])])]),t.canPlace&&m<(((X=t.player.timeline)==null?void 0:X.length)||0)-1?(a(),n("div",{key:0,class:D(["timeline-slot h-20 mt-3 group",{"drag-over":k.value[m+1],selected:y.value===m+1&&r.value}]),onDragover:A(G=>k.value[m+1]=!0,["prevent"]),onDragleave:A(G=>k.value[m+1]=!1,["prevent"]),onDrop:A(G=>l(m+1),["prevent"]),onTouchstart:A(G=>r.value?w(m+1):null,["prevent"]),onClick:G=>r.value?w(m+1):null,"data-drop-zone":m+1},[e("div",{class:D(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":y.value===m+1&&r.value}])},[e("p",os,o(r.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeBetween")),1)],2)],42,ss)):g("",!0)])}),128)),t.canPlace?(a(),n("div",{key:1,class:D(["timeline-slot h-20 group",{"drag-over":!r.value&&k.value[((u=t.player.timeline)==null?void 0:u.length)||0],selected:y.value===((($=t.player.timeline)==null?void 0:$.length)||0)&&r.value}]),onDragover:s[12]||(s[12]=A(v=>{var m;return r.value?null:k.value[((m=t.player.timeline)==null?void 0:m.length)||0]=!0},["prevent"])),onDragleave:s[13]||(s[13]=A(v=>{var m;return r.value?null:k.value[((m=t.player.timeline)==null?void 0:m.length)||0]=!1},["prevent"])),onDrop:s[14]||(s[14]=A(v=>{var m;return r.value?null:l(((m=t.player.timeline)==null?void 0:m.length)||0)},["prevent"])),onTouchstart:s[15]||(s[15]=A(v=>{var m;return r.value?w(((m=t.player.timeline)==null?void 0:m.length)||0):null},["prevent"])),onClick:s[16]||(s[16]=v=>{var m;return r.value?w(((m=t.player.timeline)==null?void 0:m.length)||0):null}),"data-drop-zone":((L=t.player.timeline)==null?void 0:L.length)||0},[e("div",{class:D(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":y.value===(((B=t.player.timeline)==null?void 0:B.length)||0)&&r.value}])},[e("p",as,o(r.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeLater")),1)],2)],42,ls)):g("",!0)])):g("",!0)]),t.canPlace&&t.currentTrack?(a(),n("div",{key:1,class:D(["timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",r.value?"cursor-pointer":"cursor-move"]),draggable:!r.value,onDragstart:s[17]||(s[17]=v=>r.value?null:J),onDragend:s[18]||(s[18]=v=>r.value?null:Q),onClick:s[19]||(s[19]=v=>r.value?I:null)},[e("div",rs,[s[27]||(s[27]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",is,[e("p",ds,o(t.$t("game.newTrack")),1),e("p",us,o(r.value?t.$t("game.tapToPlace"):t.$t("game.dragToPlace")),1)]),s[28]||(s[28]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],42,ns)):g("",!0),t.player.timeline&&t.player.timeline.length>0?(a(),n("div",cs,[e("div",vs,[e("span",gs,o(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),W.value?(a(),n("span",ps,o(W.value),1)):g("",!0)])])):g("",!0)]),T.value&&r.value?(a(),n("div",ms,[e("div",bs,[e("div",{class:"bg-red-600 text-white p-2 mb-4 text-center font-bold",onClick:ee}," TOUCH TO TEST: If you see this, JavaScript is working! "),s[34]||(s[34]=e("div",{style:{background:"yellow",padding:"20px",margin:"10px 0"}},[e("button",{onclick:"alert('BASIC ONCLICK WORKS')",style:{background:"blue",color:"white",padding:"10px","font-size":"16px",border:"none",width:"100%"}}," BASIC TEST ")],-1)),c.value?(a(),n("div",fs," DEBUG: "+o(R.value),1)):g("",!0),s[35]||(s[35]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",hs,[e("div",ys,[s[29]||(s[29]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",ks,o(t.$t("game.timeline.selectedPosition")),1)]),e("div",xs,[e("p",ws,o(E(y.value)),1)]),c.value?(a(),n("div",$s,[e("p",null,"Mobile Device: "+o(r.value),1),e("p",null,"Selected Position: "+o(y.value),1),e("p",null,"Show Confirmation: "+o(T.value),1),e("p",null,"Current Track: "+o(!!t.currentTrack),1),e("p",null,"Can Place: "+o(t.canPlace),1),e("p",null,"Touch Events Supported: "+o(j.value),1),e("p",null,"Max Touch Points: "+o(N.value),1),e("p",null,"User Agent: "+o(z.value),1),e("p",null,"Window Size: "+o(O.value),1),e("button",{onClick:C,class:"bg-red-500 text-white px-2 py-1 rounded mt-1"},"Test Debug"),e("div",{class:"mt-2 flex space-x-2"},[s[30]||(s[30]=e("button",{onclick:"console.log('RAW ONCLICK CANCEL'); alert('Cancel clicked');",class:"bg-red-600 text-white px-2 py-1 rounded text-xs"}," Raw Cancel ",-1)),s[31]||(s[31]=e("button",{onclick:"console.log('RAW ONCLICK CONFIRM'); alert('Confirm clicked');",class:"bg-green-600 text-white px-2 py-1 rounded text-xs"}," Raw Confirm ",-1)),e("button",{onClick:Y,class:"bg-blue-600 text-white px-2 py-1 rounded text-xs"}," Vue Test ")]),x.value.length>0?(a(),n("div",_s,[s[32]||(s[32]=e("p",{class:"font-bold mb-1"},"Event Log:",-1)),(a(!0),n(oe,null,le(x.value.slice(0,5),(v,m)=>(a(),n("div",{key:m,class:"text-xs"},o(v),1))),128))])):g("",!0),s[33]||(s[33]=e("div",{style:{background:"yellow",padding:"10px",margin:"10px 0",border:"2px solid red"}},[e("p",{style:{color:"black","font-weight":"bold"}},"EMERGENCY BUTTONS (no CSS conflicts):"),e("button",{onclick:"console.log('RAW YELLOW CANCEL'); alert('Raw cancel worked!');",style:{background:"red",color:"white",padding:"5px",margin:"5px",border:"none"}}," YELLOW CANCEL "),e("button",{onclick:"console.log('RAW YELLOW CONFIRM'); alert('Raw confirm worked!');",style:{background:"green",color:"white",padding:"5px",margin:"5px",border:"none"}}," YELLOW CONFIRM ")],-1))])):g("",!0),e("div",{class:"flex space-x-3 mt-6"},[e("button",{onClick:H,class:"flex-1 bg-red-600 text-white p-4 rounded text-center font-bold"}," Cancel "),e("button",{onClick:ae,class:"flex-1 bg-green-600 text-white p-4 rounded text-center font-bold"}," Confirm ")]),e("div",Cs,[e("button",{onClick:P,class:"text-xs text-gray-400 hover:text-gray-200 underline"},o(c.value?"Hide Debug":"Show Debug"),1)])])])])):g("",!0)],2)}}}),Ps={class:"min-h-screen flex flex-col"},Es={class:"bg-white/10 backdrop-blur-sm p-4"},Is={class:"flex justify-between items-center"},Ss={class:"flex items-center space-x-4"},As={class:"text-white"},Ds={class:"text-xl font-bold"},Ms={class:"flex items-center space-x-3 text-sm opacity-80"},Ns={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},Ls={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},Rs={class:"text-white text-right"},js={class:"text-sm opacity-80"},zs={class:"flex-1 container mx-auto px-4 py-6"},Os={key:0,class:"max-w-2xl mx-auto"},Bs={class:"card text-center"},Vs={class:"text-2xl font-semibold mb-4"},Fs={class:"text-gray-600 mb-6"},Hs={key:1,class:"space-y-6"},Us={class:"card text-center bg-green-50 border-green-200"},Ws={class:"text-2xl font-bold text-white mb-2"},Gs={class:"text-white"},Ys={key:0,class:"mt-4"},Ks={key:1,class:"mt-4"},qs={class:"flex items-center justify-center space-x-2"},Js={key:0,class:"card bg-yellow-50 border-yellow-200"},Qs={class:"flex items-center space-x-3"},Xs={class:"flex-1"},Zs={class:"text-lg font-semibold text-yellow-800"},eo={class:"text-yellow-700 text-sm"},to={class:"flex space-x-2"},so={key:1,class:"card bg-orange-50 border-orange-200"},oo={key:2,class:"card bg-blue-50 border-blue-200"},lo={key:4,class:"text-center mb-6"},ao={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},no={class:"mb-4"},ro={class:"flex items-center justify-center mb-3"},io={class:"text-center"},uo={class:"text-2xl font-bold text-red-200 mb-2"},co={class:"text-red-100"},vo={class:"text-lg font-semibold"},go={class:"text-base"},po={class:"text-sm opacity-90"},mo={class:"text-red-200 text-lg mb-4"},bo={class:"text-red-300 text-sm"},fo={key:5,class:"max-w-4xl mx-auto"},ho={class:"card"},yo={class:"text-lg font-semibold mb-4 text-gray-100"},ko={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},xo={class:"font-semibold text-gray-800"},wo={class:"text-2xl font-bold text-gray-900"},$o={class:"text-sm text-gray-600"},_o={class:"text-xs text-gray-500"},Co={key:2,class:"max-w-2xl mx-auto"},To={class:"card text-center"},Po={class:"text-3xl font-bold mb-4 text-white"},Eo={class:"text-xl mb-6"},Io={class:"mb-6"},So={class:"text-lg font-semibold mb-3"},Ao={class:"space-y-2"},Do={class:"font-medium"},Mo={class:"font-bold"},No={class:"flex space-x-4 justify-center"},Lo={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Ro={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},jo={class:"relative z-10"},zo={class:"flex items-center space-x-3 mb-6"},Oo={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Bo={class:"mb-8"},Vo={class:"text-gray-200 text-lg leading-relaxed"},Fo={class:"flex justify-center"},Uo=de({__name:"GameView",setup(U){const F=pe(),i=ge(),M=b(!1),p=b(!1),k=b(""),y=b(h.isAuthenticated()),T=b(!1),c=b(!1),x=b(!1),R=b({isCorrect:!1,pointsEarned:0}),_=f(()=>i.players),P=f(()=>i.currentPlayer),C=f(()=>i.currentTrack),r=f(()=>i.gamePhase),j=f(()=>i.round),N=f(()=>i.settings),z=f(()=>i.winner),O=f(()=>y.value),W=f(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),K=f(()=>O.value?!h.isPlayerReady()&&J.value>3e4:!1),q=b(Date.now()),J=f(()=>Date.now()-q.value),Q=f(()=>[..._.value].sort((t,s)=>{var L,B;const u=((L=t.timeline)==null?void 0:L.length)||0,$=((B=s.timeline)==null?void 0:B.length)||0;return $!==u?$-u:s.tokens!==t.tokens?s.tokens-t.tokens:s.score-t.score}));async function l(){var t;M.value=!0,T.value=!1,c.value=!1,R.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const s=await i.getNextTrack();s?console.log("Track loaded successfully:",s.name,"by",(t=s.artists[0])==null?void 0:t.name):console.error("No tracks available")}catch(s){console.error("Error loading track:",s)}finally{M.value=!1}}function d(t,s){const u=i.placeTrackOnTimeline(t,s);let $=0;u&&P.value&&($=1,P.value.timeline.length>=5&&($=2),P.value.timeline.length>=8&&($=3)),R.value={isCorrect:u,pointsEarned:$},T.value=!0,setTimeout(()=>{c.value=!0},500),u?setTimeout(()=>{T.value=!1,c.value=!1,i.nextPlayer()},4e3):setTimeout(()=>{if(x.value=!0,P.value&&C.value){const L=w(C.value,P.value.timeline),B={...C.value,revealed:!0};i.addTrackToTimelineAtPosition(B,L)}},1500)}function w(t,s){for(let u=0;u<s.length;u++)if(t.year<=s[u].year)return u;return s.length}function E(){C.value&&P.value&&i.removeTrackFromTimeline(C.value.id),T.value=!1,c.value=!1,x.value=!1,i.nextPlayer()}function I(t){var u;if(!P.value)return;if(i.useToken(P.value.id,t))switch(t){case"skip":l();break;case"hint":const $=Math.floor(((u=C.value)==null?void 0:u.year)/10)*10;k.value=`This track was released in the ${$}s`,p.value=!0;break}}function V(){p.value=!1,k.value=""}function H(){i.resetGame(),F.push("/")}function ae(){F.push("/")}function Y(){const t=h.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:t,previousState:O.value}),y.value!==t&&(y.value=t,console.log("Spotify auth state updated:",t)),t&&!h.isPlayerReady()&&(console.log("Initializing player after auth check"),h.initializePlayerIfReady())}async function ee(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await h.forceReauth(),Y()}return ne(()=>{i.gamePhase==="setup"&&i.players.length===0&&F.push("/"),Y(),h.isAuthenticated()&&h.startSessionMaintenance();const t=setInterval(()=>{y.value?h.startSessionMaintenance():Y()},12e4);te(()=>{clearInterval(t),h.stopSessionMaintenance()})}),se(C,t=>{t&&(T.value=!1,c.value=!1,R.value={isCorrect:!1,pointsEarned:0})}),(t,s)=>{var u,$,L,B,v,m,X,G;return a(),n("div",Ps,[e("header",Es,[e("div",Is,[e("div",Ss,[e("button",{onClick:s[0]||(s[0]=S=>t.$router.push("/")),class:"btn btn-secondary"}," ← "+o(t.$t("common.back")),1),e("div",As,[e("h1",Ds,o(t.$t("game.title")),1),e("div",Ms,[e("span",null,o(t.$t("game.round"))+" "+o(j.value),1),N.value.theme?(a(),n("span",Ns," 🎵 "+o(t.$t(`game.themes.${N.value.theme}`)),1)):(a(),n("span",Ls," 🎵 "+o(t.$t("game.allMusic")),1))])])]),e("div",Rs,[e("p",js,o(t.$t("game.turn.currentPlayer",{player:(u=P.value)==null?void 0:u.name})),1)])])]),e("main",zs,[r.value==="setup"?(a(),n("div",Os,[e("div",Bs,[e("h2",Vs,o(t.$t("game.setupRequired")),1),e("p",Fs,o(t.$t("game.setupMessage")),1),e("button",{onClick:s[1]||(s[1]=S=>t.$router.push("/")),class:"btn btn-primary"},o(t.$t("game.backToSetup")),1)])])):r.value==="playing"?(a(),n("div",Hs,[e("div",Us,[e("h2",Ws,o(t.$t("game.turn.currentPlayer",{player:($=P.value)==null?void 0:$.name})),1),e("p",Gs,o(t.$t("game.turn.ready")),1),!C.value&&!M.value?(a(),n("div",Ys,[e("button",{onClick:l,class:"btn btn-primary btn-lg"}," 🎵 "+o(t.$t("game.getTrack")),1)])):g("",!0),M.value?(a(),n("div",Ks,[e("div",qs,[s[3]||(s[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,o(t.$t("common.loading")),1)])])):g("",!0)]),O.value?O.value&&K.value?(a(),n("div",so,[e("div",{class:"flex items-center space-x-3"},[s[5]||(s[5]=re('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:ee,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):g("",!0):(a(),n("div",Js,[e("div",Qs,[s[4]||(s[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Xs,[e("h3",Zs,o(t.$t("game.spotify.notConnected")),1),e("p",eo,o(t.$t("game.demoModeActive")),1)]),e("div",to,[e("button",{onClick:ae,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},o(t.$t("game.spotify.login")),1),e("button",{onClick:ee,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:Y,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),W.value&&O.value?(a(),n("div",oo,s[6]||(s[6]=[re('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):g("",!0),C.value?(a(),me(wt,{key:3,track:C.value,"show-result":T.value,"show-answer":c.value,"is-correct":R.value.isCorrect,"points-earned":R.value.pointsEarned,onPlaceTrack:d},null,8,["track","show-result","show-answer","is-correct","points-earned"])):g("",!0),x.value&&!R.value.isCorrect?(a(),n("div",lo,[e("div",ao,[e("div",no,[e("div",ro,[s[7]||(s[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",io,[e("h3",uo,o(t.$t("game.turn.wrongPlacement")),1),e("div",co,[e("p",vo,o((L=C.value)==null?void 0:L.name),1),e("p",go,o((B=C.value)==null?void 0:B.artists.map(S=>S.name).join(", ")),1),e("p",po,o(t.$t("game.turn.releasedIn",{year:(v=C.value)==null?void 0:v.year})),1)])])]),e("p",mo,o(t.$t("game.turn.correctPlacement")),1),e("p",bo,o(t.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:E,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},o(t.$t("game.turn.continue")),1)])])):g("",!0),P.value&&P.value.timeline?(a(),n("div",fo,[be(Ts,{player:P.value,"is-current":!0,"current-track":C.value,"can-place":!!C.value,onPlaceTrack:d,onUseToken:I},null,8,["player","current-track","can-place"])])):g("",!0),e("div",ho,[e("h3",yo,o(t.$t("game.score.title")),1),e("div",ko,[(a(!0),n(oe,null,le(_.value,S=>{var Z;return a(),n("div",{key:S.id,class:D(["text-center p-3 rounded-lg",S.id===((Z=P.value)==null?void 0:Z.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",xo,o(S.name),1),e("p",wo,o(S.tokens),1),e("p",$o,o(t.$t("game.score.tokens",{count:S.tokens})),1),e("p",_o,o(t.$t("game.score.total",{score:S.score})),1)],2)}),128))])])])):r.value==="finished"?(a(),n("div",Co,[e("div",To,[e("h2",Po,o(t.$t("game.end.title")),1),e("p",Eo,o(t.$t("game.end.winner",{player:(m=z.value)==null?void 0:m.name,score:((G=(X=z.value)==null?void 0:X.timeline)==null?void 0:G.length)||0})),1),e("div",Io,[e("h3",So,o(t.$t("game.end.finalScores")),1),e("div",Ao,[(a(!0),n(oe,null,le(Q.value,(S,Z)=>{var ue;return a(),n("div",{key:S.id,class:D(["flex justify-between items-center p-3 rounded-lg",Z===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Do,o(Z+1)+". "+o(S.name),1),e("span",Mo,o(((ue=S.timeline)==null?void 0:ue.length)||0)+" "+o(t.$t("game.songs"))+" | "+o(S.tokens)+" "+o(t.$t("game.score.tokens",{count:S.tokens})),1)],2)}),128))])]),e("div",No,[e("button",{onClick:H,class:"btn btn-primary"}," 🔄 "+o(t.$t("game.end.playAgain")),1),e("button",{onClick:s[2]||(s[2]=S=>t.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+o(t.$t("game.backToHome")),1)])])])):g("",!0)]),p.value?(a(),n("div",Lo,[e("div",Ro,[s[9]||(s[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",jo,[e("div",zo,[s[8]||(s[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Oo,o(t.$t("game.tokens.hint.label")),1)]),e("div",Bo,[e("p",Vo,o(k.value),1)]),e("div",Fo,[e("button",{onClick:V,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},o(t.$t("common.close")),1)])])])])):g("",!0)])}}});export{Uo as default};
