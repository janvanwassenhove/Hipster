import{d as ee,m as ge,r as b,c as h,s as k,o as ae,n as K,w as J,p as te,a as u,e,b as f,q as le,t as s,x as se,f as ne,y as L,k as n,g as S,F as W,i as Q,u as ve,j as me,z as fe,A as he}from"./index-BILbtfZl.js";const be={class:"card relative overflow-hidden bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10"},ye={class:"relative z-10 flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8 p-6"},ke={class:"flex-shrink-0"},xe={key:0,class:"relative group"},we={key:1,class:"relative group"},$e=["src","alt"],_e={class:"flex-1 text-center md:text-left"},Te={class:"mb-6"},Pe={class:"text-gray-300 font-medium text-lg bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Ce={class:"text-sm text-gray-400 mt-2 font-light"},Me={class:"mb-6"},ze={key:0,class:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 border border-blue-400/30 rounded-2xl p-6 text-center backdrop-blur-sm"},Ae={class:"flex items-center justify-center mb-3"},Se={class:"text-xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},je={class:"text-blue-200 mb-4 font-medium"},De={class:"bg-blue-800/30 rounded-xl p-4 border border-blue-500/30"},Be={class:"text-blue-100 text-sm font-medium"},Le={key:1,class:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 border border-blue-400/30 rounded-2xl p-6 text-center backdrop-blur-sm"},Re={class:"flex items-center justify-center mb-3"},Ee={class:"text-xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Ie={class:"text-blue-200 mb-3 font-medium"},Ne={class:"text-sm text-blue-300 font-semibold"},Ve={class:"text-xs text-blue-400 mt-2 opacity-80"},Fe=["src"],Oe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/80 to-black/80 rounded-2xl p-6 backdrop-blur-sm border border-gray-700/50 shadow-2xl"},Ue={class:"flex items-center justify-center space-x-8 mb-6"},Xe=["disabled"],He=["disabled"],Ye={class:"w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-2xl shadow-purple-500/50 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/60"},qe={key:0,class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},Ge={key:1,class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Je={key:2,class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Ze=["disabled"],Ke={class:"w-12 h-12 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center border border-gray-600/50 shadow-lg group-hover:from-cyan-600 group-hover:to-blue-600 group-hover:border-cyan-400/50 transition-all duration-300 group-hover:scale-110"},We={key:0,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},Qe={key:1,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},et={key:2,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},tt={class:"mb-4"},ot={class:"flex items-center space-x-4 text-sm text-gray-300"},rt={class:"w-12 text-right font-mono"},st={class:"flex-1 relative"},at={class:"w-12 font-mono"},lt={class:"flex items-center space-x-4"},nt={class:"flex-1 relative group"},it=["value","disabled"],ut={class:"text-sm text-gray-400 w-10 font-mono"},dt={key:0,class:"p-6 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-2xl backdrop-blur-sm"},ct={class:"text-center"},pt={class:"text-2xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-2"},gt={class:"text-blue-200 text-lg font-medium mb-1"},vt={class:"text-blue-300 font-medium"},mt={class:"text-sm text-blue-400 mt-4"},ft=["href"],ht={key:0,class:"mt-6 p-6 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-2xl backdrop-blur-sm"},bt={class:"text-center"},yt={class:"flex items-center justify-center mb-3"},kt={class:"font-bold text-lg bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},xt={class:"text-purple-200 text-sm font-medium"},wt={class:"flex items-center justify-center mb-3"},$t={key:0,class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-3 animate-bounce"},_t={key:1,class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},Tt={class:"font-bold text-2xl"},Pt={key:0,class:"text-lg mt-2 font-semibold"},Ct={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Mt=ee({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(I,{emit:R}){const i=I,{t:T}=ge(),d=b(),v=b(!1),C=b(!1),N=b(!1),x=b(0),p=b(0),w=b(.7),j=b(!1),D=b(!1);b(!1);const B=h(()=>{var m,_,G,X;const o=(_=(m=i.track.images)==null?void 0:m[0])==null?void 0:_.url,l=(X=(G=i.track.album.images)==null?void 0:G[0])==null?void 0:X.url;return o||l||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),H=h(()=>i.track.artists.map(o=>o.name).join(", ")),E=h(()=>i.showResult?i.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),U=h(()=>i.showResult?i.isCorrect?T("game.turn.correct",{year:i.track.year}):T("game.turn.incorrect",{year:i.track.year}):""),V=h(()=>p.value===0?0:x.value/p.value*100),M=h(()=>!!i.track.uri),F=h(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),P=h(()=>M.value&&k.isPlayerReady()&&!F.value),$=h(()=>!1),r=h(()=>P.value||$.value);async function t(){console.log("Toggle playback called, isPlaying:",v.value),console.log("Can play full track:",P.value),console.log("Can play preview:",$.value),console.log("Spotify player ready:",k.isPlayerReady());const o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(P.value&&!o){if(await k.getAvailableDevices(),v.value)await k.pausePlayback(),v.value=!1;else if(await k.playTrack(i.track.uri))v.value=!0,a();else if(console.warn("Failed to play track, falling back to preview if available"),$.value&&d.value)try{await d.value.play()}catch(m){console.error("Error playing preview fallback:",m)}}else if($.value&&d.value)if(v.value)d.value.pause();else try{await d.value.play()}catch(l){console.error("Error playing audio:",l),l instanceof Error&&l.name==="NotAllowedError"&&console.warn("Autoplay blocked - user interaction required")}else console.log("Mobile device without audio playback - visual mode only")}async function g(){console.log("Restart track called"),P.value?await k.playTrack(i.track.uri)&&(v.value=!0,a()):d.value&&(d.value.currentTime=0,v.value&&d.value.play().catch(o=>{console.error("Error playing audio after restart:",o)}))}function a(){const o=async()=>{if(!P.value)return;const l=await k.getPlaybackState();l&&(v.value=!l.paused,x.value=l.position/1e3,p.value=l.duration/1e3,v.value&&setTimeout(o,1e3))};o()}function c(){d.value&&(j.value?(d.value.volume=w.value,j.value=!1):(d.value.volume=0,j.value=!0))}function z(o){if(!d.value)return;const l=o.target,m=parseFloat(l.value);w.value=m,d.value.volume=m,m===0?j.value=!0:j.value&&(j.value=!1)}function A(o){o.stopPropagation()}function Y(o){if(!d.value||!i.track.preview_url)return;const m=o.currentTarget.getBoundingClientRect();let _;if("touches"in o)if(o.touches.length>0)_=o.touches[0].clientX;else if(o.changedTouches.length>0)_=o.changedTouches[0].clientX;else return;else _=o.clientX;const X=Math.max(0,Math.min(1,(_-m.left)/m.width))*p.value;d.value.currentTime=X}function q(o){!d.value||!i.track.preview_url||(o.preventDefault(),D.value=!0,Z(o))}function y(o){D.value&&(o.preventDefault(),Z(o))}function O(o){D.value&&(o.preventDefault(),D.value=!1,Z(o))}function Z(o){if(!d.value||!i.track.preview_url)return;const m=o.currentTarget.getBoundingClientRect(),_=o.touches[0]||o.changedTouches[0];if(!_)return;const X=Math.max(0,Math.min(1,(_.clientX-m.left)/m.width))*p.value;d.value.currentTime=X}function oe(o){if(isNaN(o))return"0:00";const l=Math.floor(o/60),m=Math.floor(o%60);return`${l}:${m.toString().padStart(2,"0")}`}function ie(){d.value&&(x.value=d.value.currentTime)}function ue(){d.value&&(p.value=d.value.duration,d.value.volume=w.value)}function de(){C.value=!0,N.value=!1}function ce(){C.value=!1,N.value=!0}function pe(){v.value=!1}ae(()=>{k.isAuthenticated()&&K(()=>{k.initializePlayerIfReady()}),K(()=>{d.value&&re()})}),J(d,o=>{o&&re()}),J(()=>i.track,async(o,l)=>{if(o&&o!==l){console.log("New track detected:",o.name),await K(),v.value=!1;const m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:r.value,canPlayFullTrack:P.value,canPlayPreview:$.value,hasSpotifyUri:M.value,hasPreviewUrl:!!o.preview_url,isPlayerReady:k.isPlayerReady(),isPlaying:v.value}),r.value&&!v.value){console.log("Auto-starting playback for new track:",o.name);try{await t(),console.log("✅ Auto-playback started successfully")}catch(_){m?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",_)}}else{const _=r.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${_}`),!m&&M.value&&!$.value&&console.log("No preview available but has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),J(()=>i.track.preview_url,async(o,l)=>{o&&!l&&!v.value&&(console.log("Preview URL became available for track:",i.track.name),setTimeout(async()=>{if(r.value&&!v.value){console.log("Auto-starting playback now that preview URL is available");try{await t(),console.log("✅ Auto-playback started after preview URL enhancement")}catch(m){console.warn("Failed to auto-start after preview enhancement:",m)}}},100))});function re(){d.value&&(d.value.addEventListener("play",()=>{v.value=!0}),d.value.addEventListener("pause",()=>{v.value=!1}),d.value.volume=w.value,F.value&&d.value.addEventListener("touchstart",o=>{o.preventDefault()},{passive:!1}))}return te(()=>{P.value?k.stopPlayback():d.value&&d.value.pause()}),(o,l)=>(n(),u("div",be,[l[20]||(l[20]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",ye,[e("div",ke,[o.showAnswer?(n(),u("div",we,[e("img",{src:B.value,alt:o.track.name,class:"w-40 h-40 rounded-2xl shadow-2xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,$e),l[5]||(l[5]=e("div",{class:"absolute inset-0 w-40 h-40 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(n(),u("div",xe,l[4]||(l[4]=[le('<div class="w-40 h-40 rounded-2xl shadow-2xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-3eb694d6><div class="w-32 h-32 rounded-full bg-gradient-to-br from-gray-900 to-black shadow-inner flex items-center justify-center" data-v-3eb694d6><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-3eb694d6><svg class="w-12 h-12 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-3eb694d6><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-3eb694d6></path></svg></div></div></div><div class="absolute inset-0 w-40 h-40 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-3eb694d6></div>',2)])))]),e("div",_e,[e("div",Te,[e("p",Pe,s(o.$t("game.turn.listening")),1),e("p",Ce,s(o.$t("game.turn.placeOnTimeline")),1)]),e("div",Me,[!r.value&&F.value&&M.value?(n(),u("div",ze,[e("div",Ae,[l[6]||(l[6]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3 shadow-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Se,s(o.$t("game.mobileListening")),1)]),e("p",je,s(o.$t("game.mobileGameMode")),1),e("div",De,[e("p",Be,s(o.$t("game.listenCarefully")),1)])])):P.value?f("",!0):(n(),u("div",Le,[e("div",Re,[l[7]||(l[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3 shadow-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ee,s(M.value?o.$t("game.premiumRequired"):o.$t("game.demoMode")),1)]),e("p",Ie,s(M.value?o.$t("game.needsPremium"):o.$t("game.noPreview")),1),e("p",Ne,[e("strong",null,s(M.value?o.$t("game.premiumNeededForFullPlay"):o.$t("game.needSpotifyForAudio")),1)]),e("p",Ve,s(o.$t("game.demoModeInstructions")),1)])),$.value&&!P.value?(n(),u("audio",{key:2,ref_key:"audioPlayer",ref:d,src:o.track.preview_url||void 0,onEnded:pe,onTimeupdate:ie,onLoadedmetadata:ue,onLoadstart:de,onCanplay:ce,preload:"metadata",playsinline:"","webkit-playsinline":"",crossorigin:"anonymous"},s(o.$t("game.audioNotSupported")),41,Fe)):f("",!0),r.value?(n(),u("div",Oe,[e("div",Ue,[e("button",{onClick:g,class:"control-btn group relative",disabled:!r.value,title:"Restart"},l[8]||(l[8]=[e("div",{class:"w-12 h-12 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center border border-gray-600/50 shadow-lg group-hover:from-purple-600 group-hover:to-pink-600 group-hover:border-purple-400/50 transition-all duration-300 group-hover:scale-110"},[e("svg",{class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})])],-1)]),8,Xe),e("button",{onClick:t,class:"play-btn group relative",disabled:!r.value},[e("div",Ye,[C.value?(n(),u("div",qe)):v.value?(n(),u("svg",Ge,l[9]||(l[9]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(n(),u("svg",Je,l[10]||(l[10]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,He),e("button",{onClick:c,class:"control-btn group relative",disabled:!r.value,title:"Mute/Unmute"},[e("div",Ke,[j.value||w.value===0?(n(),u("svg",We,l[11]||(l[11]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM16 8.4A1 1 0 1117.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1),e("path",{d:"M18.293 6.293a1 1 0 011.414 1.414L17.414 10l2.293 2.293a1 1 0 01-1.414 1.414L16 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L14.586 10l-2.293-2.293a1 1 0 011.414-1.414L16 8.586l2.293-2.293z"},null,-1)]))):w.value<.5?(n(),u("svg",Qe,l[12]||(l[12]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a2 2 0 010 6 1 1 0 11-1.6-1.2V8.4z","clip-rule":"evenodd"},null,-1)]))):(n(),u("svg",et,l[13]||(l[13]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1)])))])],8,Ze)]),e("div",tt,[e("div",ot,[e("span",rt,s(oe(x.value)),1),e("div",st,[e("div",{class:"progress-track relative h-2 bg-gradient-to-r from-gray-800 to-gray-700 rounded-full cursor-pointer group overflow-hidden",onClick:l[0]||(l[0]=m=>Y(m)),onTouchstart:l[1]||(l[1]=m=>q(m)),onTouchmove:l[2]||(l[2]=m=>y(m)),onTouchend:l[3]||(l[3]=m=>O(m))},[l[14]||(l[14]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300"},null,-1)),e("div",{class:"progress-fill absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full shadow-lg transition-all duration-150 ease-out",style:se({width:V.value+"%"})},null,4),e("div",{class:"progress-handle absolute top-1/2 w-4 h-4 bg-white rounded-full shadow-lg transform -translate-y-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:se({left:V.value+"%"})},null,4)],32)]),e("span",at,s(oe(p.value)),1)])]),e("div",lt,[l[15]||(l[15]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793z","clip-rule":"evenodd"})],-1)),e("div",nt,[e("input",{type:"range",min:"0",max:"1",step:"0.1",value:w.value,onInput:z,onTouchstart:A,onTouchmove:A,onTouchend:A,class:"volume-slider w-full h-2 bg-gradient-to-r from-gray-800 to-gray-700 rounded-full appearance-none cursor-pointer slider-thumb",disabled:!o.track.preview_url},null,40,it)]),e("span",ut,s(Math.round(w.value*100))+"%",1)])])):f("",!0)]),o.showAnswer?(n(),u("div",dt,[e("div",ct,[e("h4",pt,s(o.track.name),1),e("p",gt,s(H.value),1),e("p",vt,s(o.track.album.name)+" ("+s(o.track.year)+")",1),e("p",mt,[e("a",{href:o.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25"},[l[16]||(l[16]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),ne(" "+s(o.$t("game.openInSpotify")),1)],8,ft)])])])):f("",!0)])]),o.showAnswer?f("",!0):(n(),u("div",ht,[e("div",bt,[e("div",yt,[l[17]||(l[17]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",kt,s(o.$t("game.turn.placing")),1)]),e("p",xt,s(o.$t("game.dragToTimeline")),1)])])),o.showResult?(n(),u("div",{key:1,class:L(["mt-6 p-6 rounded-2xl text-center backdrop-blur-sm",E.value])},[e("div",wt,[o.isCorrect?(n(),u("div",$t,l[18]||(l[18]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(n(),u("div",_t,l[19]||(l[19]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",Tt,s(U.value),1)]),o.pointsEarned>0?(n(),u("p",Pt,[e("span",Ct,s(o.$t("game.turn.points",{points:o.pointsEarned})),1)])):f("",!0)],2)):f("",!0)]))}}),zt=(I,R)=>{const i=I.__vccOpts||I;for(const[T,d]of R)i[T]=d;return i},At=zt(Mt,[["__scopeId","data-v-3eb694d6"]]),St={key:0,class:"absolute inset-0 opacity-10"},jt={class:"relative z-10"},Dt={class:"flex items-center justify-between mb-6"},Bt={class:"text-xl font-bold flex items-center space-x-3"},Lt={key:0,class:"text-2xl animate-bounce"},Rt={class:"text-right"},Et={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},It={class:"flex items-center space-x-2 text-sm text-gray-300"},Nt={class:"font-medium"},Vt={key:0,class:"mb-6"},Ft={class:"text-sm font-medium text-gray-300 mb-3"},Ot={class:"flex space-x-3"},Ut=["title"],Xt={class:"flex items-center space-x-2"},Ht=["title"],Yt={class:"flex items-center space-x-2"},qt={class:"mb-6"},Gt={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Jt={key:0,class:"text-center py-12 text-gray-400"},Zt={class:"text-lg font-medium mb-2"},Kt={class:"p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm"},Wt={class:"text-center text-gray-300 font-medium"},Qt={key:1,class:"space-y-3"},eo={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},to={class:"text-center text-gray-400 text-sm font-medium"},oo={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},ro={class:"flex items-center space-x-4"},so={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},ao=["src","alt"],lo={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},no={class:"flex-1 min-w-0"},io={class:"font-bold text-lg text-gray-100 truncate"},uo={class:"text-sm text-gray-300 truncate font-medium"},co={class:"text-right flex-shrink-0"},po={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},go=["onDragover","onDragleave","onDrop","data-drop-zone"],vo={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},mo={class:"text-center text-gray-400 text-sm font-medium"},fo=["data-drop-zone"],ho={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},bo={class:"text-center text-gray-400 text-sm font-medium"},yo={class:"flex items-center space-x-4"},ko={class:"flex-1 min-w-0"},xo={class:"font-bold text-lg text-blue-200"},wo={class:"text-sm text-blue-300 font-medium"},$o={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},_o={class:"flex justify-between text-sm text-gray-300"},To={class:"font-medium"},Po={key:0,class:"font-mono"},Co=ee({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(I,{emit:R}){const i=I,T=R,d=b(!1),v=b([]),C=b(!1),N=b({x:0,y:0}),x=b({x:0,y:0}),p=b(null),w=h(()=>{if(i.player.timeline.length<2)return null;const r=i.player.timeline.map(t=>t.year).sort((t,g)=>t-g);return`${r[0]} - ${r[r.length-1]}`});function j(r){var t,g,a,c;return((g=(t=r.images)==null?void 0:t[0])==null?void 0:g.url)||((c=(a=r.album.images)==null?void 0:a[0])==null?void 0:c.url)||"/placeholder-album.png"}function D(r){return r.artists.map(t=>t.name).join(", ")}function B(r){var g;if(!i.currentTrack)return;(g=r.dataTransfer)==null||g.setData("text/plain",JSON.stringify(i.currentTrack)),r.target.classList.add("dragging")}function H(r){r.target.classList.remove("dragging"),d.value=!1,v.value=[]}function E(r){!i.currentTrack||!i.canPlace||(d.value=!1,v.value=[],T("placeTrack",i.currentTrack,r))}function U(r){T("useToken",r)}function V(r){if(!(!i.currentTrack||!i.canPlace))try{r.preventDefault(),C.value=!0;const t=r.touches[0];if(!t)return;N.value={x:t.clientX,y:t.clientY},x.value={x:t.clientX,y:t.clientY};const g=r.target,a=g.getBoundingClientRect();p.value=g.cloneNode(!0),p.value.style.position="fixed",p.value.style.top=`${a.top}px`,p.value.style.left=`${a.left}px`,p.value.style.width=`${a.width}px`,p.value.style.height=`${a.height}px`,p.value.style.zIndex="9999",p.value.style.opacity="0.8",p.value.style.transform="rotate(2deg)",p.value.style.pointerEvents="none",p.value.classList.add("dragging"),document.body.appendChild(p.value),g.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(50)}catch(t){console.warn("Touch start error:",t),$()}}function M(r){if(!(!C.value||!p.value))try{r.preventDefault();const t=r.touches[0];if(!t)return;x.value={x:t.clientX,y:t.clientY};const g=50,a=50;p.value.style.left=`${t.clientX-g}px`,p.value.style.top=`${t.clientY-a}px`;const c=document.elementFromPoint(t.clientX,t.clientY),z=c==null?void 0:c.closest("[data-drop-zone]");if(d.value=!1,v.value.fill(!1),z){const A=parseInt(z.getAttribute("data-drop-zone")||"0");A===0?d.value=!0:A<=v.value.length&&(v.value[A]=!0)}}catch(t){console.warn("Touch move error:",t)}}function F(r){if(C.value)try{r.preventDefault(),C.value=!1;const t=r.changedTouches[0];if(!t){$();return}const g=document.elementFromPoint(t.clientX,t.clientY),a=g==null?void 0:g.closest("[data-drop-zone]");p.value&&(p.value.style.transition="opacity 0.2s ease-out",p.value.style.opacity="0",setTimeout(()=>{p.value&&document.body.contains(p.value)&&document.body.removeChild(p.value),p.value=null},200));const c=document.querySelector(".dragging");if(c&&c.classList.remove("dragging"),d.value=!1,v.value.fill(!1),a&&i.currentTrack){const z=parseInt(a.getAttribute("data-drop-zone")||"0");"vibrate"in navigator&&navigator.vibrate(100),T("placeTrack",i.currentTrack,z)}}catch(t){console.warn("Touch end error:",t),$()}}function P(){v.value=new Array(i.player.timeline.length+1).fill(!1)}function $(){C.value=!1,d.value=!1,v.value.fill(!1),p.value&&document.body.contains(p.value)&&(document.body.removeChild(p.value),p.value=null),document.querySelectorAll(".dragging").forEach(t=>t.classList.remove("dragging"))}return te(()=>{$()}),J(()=>i.player.timeline.length,()=>{P()},{immediate:!0}),(r,t)=>(n(),u("div",{class:L(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":r.isCurrent}])},[r.isCurrent?(n(),u("div",St,t[11]||(t[11]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):f("",!0),e("div",jt,[e("div",Dt,[e("h3",Bt,[e("span",{class:L(r.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},s(r.player.name),3),r.isCurrent?(n(),u("span",Lt,"👑")):f("",!0)]),e("div",Rt,[e("p",Et,s(r.player.score),1),e("div",It,[t[12]||(t[12]=e("span",{class:"text-lg"},"🎵",-1)),e("span",Nt,s(r.$t("game.score.tokens",{count:r.player.tokens})),1)])])]),r.isCurrent&&r.canPlace&&r.player.tokens>0?(n(),u("div",Vt,[e("h4",Ft,s(r.$t("game.tokenAbilities")),1),e("div",Ot,[e("button",{onClick:t[0]||(t[0]=g=>U("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:r.$t("game.tokens.skip.description")},[e("div",Xt,[t[13]||(t[13]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,s(r.$t("game.tokens.skip.label")),1)])],8,Ut),e("button",{onClick:t[1]||(t[1]=g=>U("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:r.$t("game.tokens.hint.description")},[e("div",Yt,[t[14]||(t[14]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,s(r.$t("game.tokens.hint.label")),1)])],8,Ht)])])):f("",!0),e("div",qt,[e("h4",Gt,[t[15]||(t[15]=e("span",{class:"mr-2"},"🎵",-1)),ne(" "+s(r.$t("game.timeline.title")),1)]),r.player.timeline.length===0?(n(),u("div",Jt,[t[16]||(t[16]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Zt,s(r.$t("game.timeline.empty")),1),r.canPlace?(n(),u("div",{key:0,class:L(["timeline-slot mt-6 group",{"drag-over":d.value}]),onDragover:t[2]||(t[2]=S(g=>d.value=!0,["prevent"])),onDragleave:t[3]||(t[3]=S(g=>d.value=!1,["prevent"])),onDrop:t[4]||(t[4]=S(g=>E(0),["prevent"])),"data-drop-zone":0},[e("div",Kt,[e("p",Wt,s(r.$t("game.timeline.placeHere")),1)])],34)):f("",!0)])):(n(),u("div",Qt,[r.canPlace?(n(),u("div",{key:0,class:L(["timeline-slot h-20 group",{"drag-over":v.value[0]}]),onDragover:t[5]||(t[5]=S(g=>v.value[0]=!0,["prevent"])),onDragleave:t[6]||(t[6]=S(g=>v.value[0]=!1,["prevent"])),onDrop:t[7]||(t[7]=S(g=>E(0),["prevent"])),"data-drop-zone":0},[e("div",eo,[e("p",to,s(r.$t("game.placeEarlier")),1)])],34)):f("",!0),(n(!0),u(W,null,Q(r.player.timeline,(g,a)=>(n(),u("div",{key:g.id,class:"track-card group relative"},[e("div",oo,[e("div",ro,[e("div",so,[g.revealed?(n(),u("img",{key:0,src:j(g),alt:g.name,class:"w-16 h-16 object-cover"},null,8,ao)):(n(),u("div",lo,t[17]||(t[17]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",no,[e("p",io,s(g.name),1),e("p",uo,s(D(g)),1)]),e("div",co,[e("p",po,s(g.year),1)])])]),r.canPlace&&a<r.player.timeline.length-1?(n(),u("div",{key:0,class:L(["timeline-slot h-20 mt-3 group",{"drag-over":v.value[a+1]}]),onDragover:S(c=>v.value[a+1]=!0,["prevent"]),onDragleave:S(c=>v.value[a+1]=!1,["prevent"]),onDrop:S(c=>E(a+1),["prevent"]),"data-drop-zone":a+1},[e("div",vo,[e("p",mo,s(r.$t("game.placeBetween")),1)])],42,go)):f("",!0)]))),128)),r.canPlace?(n(),u("div",{key:1,class:L(["timeline-slot h-20 group",{"drag-over":v.value[r.player.timeline.length]}]),onDragover:t[8]||(t[8]=S(g=>v.value[r.player.timeline.length]=!0,["prevent"])),onDragleave:t[9]||(t[9]=S(g=>v.value[r.player.timeline.length]=!1,["prevent"])),onDrop:t[10]||(t[10]=S(g=>E(r.player.timeline.length),["prevent"])),"data-drop-zone":r.player.timeline.length},[e("div",ho,[e("p",bo,s(r.$t("game.placeLater")),1)])],42,fo)):f("",!0)]))]),r.canPlace&&r.currentTrack?(n(),u("div",{key:1,class:"p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl cursor-move touch-manipulation select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",draggable:"true",onDragstart:B,onDragend:H,onTouchstart:V,onTouchmove:M,onTouchend:F,style:{touchAction:"none"}},[e("div",yo,[t[18]||(t[18]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",ko,[e("p",xo,s(r.$t("game.newTrack")),1),e("p",wo,s(r.$t("game.dragToPlace")),1)]),t[19]||(t[19]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],32)):f("",!0),r.player.timeline.length>0?(n(),u("div",$o,[e("div",_o,[e("span",To,s(r.$t("game.tracksInTimeline",{count:r.player.timeline.length})),1),w.value?(n(),u("span",Po,s(w.value),1)):f("",!0)])])):f("",!0)])],2))}}),Mo={class:"min-h-screen flex flex-col"},zo={class:"bg-white/10 backdrop-blur-sm p-4"},Ao={class:"flex justify-between items-center"},So={class:"flex items-center space-x-4"},jo={class:"text-white"},Do={class:"text-xl font-bold"},Bo={class:"text-sm opacity-80"},Lo={class:"text-white text-right"},Ro={class:"text-sm opacity-80"},Eo={class:"flex-1 container mx-auto px-4 py-6"},Io={key:0,class:"max-w-2xl mx-auto"},No={class:"card text-center"},Vo={class:"text-2xl font-semibold mb-4"},Fo={class:"text-gray-600 mb-6"},Oo={key:1,class:"space-y-6"},Uo={class:"card text-center bg-green-50 border-green-200"},Xo={class:"text-2xl font-bold text-green-800 mb-2"},Ho={class:"text-green-700"},Yo={key:0,class:"mt-4"},qo={key:1,class:"mt-4"},Go={class:"flex items-center justify-center space-x-2"},Jo={class:"card bg-blue-50 border-blue-200 text-sm text-blue-800"},Zo={key:0,class:"card bg-yellow-50 border-yellow-200"},Ko={class:"flex items-center space-x-3"},Wo={class:"flex-1"},Qo={class:"text-lg font-semibold text-yellow-800"},er={class:"text-yellow-700 text-sm"},tr={class:"flex space-x-2"},or={key:1,class:"card bg-orange-50 border-orange-200"},rr={key:3,class:"max-w-4xl mx-auto"},sr={class:"card"},ar={class:"text-lg font-semibold mb-4"},lr={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},nr={class:"font-semibold"},ir={class:"text-2xl font-bold text-green-600"},ur={class:"text-sm text-gray-600"},dr={class:"text-xs text-gray-500"},cr={key:2,class:"max-w-2xl mx-auto"},pr={class:"card text-center"},gr={class:"text-3xl font-bold mb-4 text-green-600"},vr={class:"text-xl mb-6"},mr={class:"mb-6"},fr={class:"text-lg font-semibold mb-3"},hr={class:"space-y-2"},br={class:"font-medium"},yr={class:"font-bold"},kr={class:"flex space-x-4 justify-center"},xr={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},wr={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},$r={class:"relative z-10"},_r={class:"flex items-center space-x-3 mb-6"},Tr={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Pr={class:"mb-8"},Cr={class:"text-gray-200 text-lg leading-relaxed"},Mr={class:"flex justify-center"},Ar=ee({__name:"GameView",setup(I){const R=me(),i=ve(),T=b(!1),d=b(!1),v=b(""),C=b(k.isAuthenticated()),N=h(()=>i.players),x=h(()=>i.currentPlayer),p=h(()=>i.currentTrack),w=h(()=>i.gamePhase),j=h(()=>i.round);h(()=>i.settings);const D=h(()=>i.winner),B=h(()=>C.value),H=h(()=>k.isAuthenticated()),E=h(()=>B.value&&!k.isPlayerReady()),U=h(()=>[...N.value].sort((a,c)=>c.timeline.length!==a.timeline.length?c.timeline.length-a.timeline.length:c.tokens!==a.tokens?c.tokens-a.tokens:c.score-a.score));async function V(){var a;T.value=!0;try{console.log("Loading next track...");const c=await i.getNextTrack();c?console.log("Track loaded successfully:",c.name,"by",(a=c.artists[0])==null?void 0:a.name):console.error("No tracks available")}catch(c){console.error("Error loading track:",c)}finally{T.value=!1}}function M(a,c){i.placeTrackOnTimeline(a,c),setTimeout(()=>{i.nextPlayer()},2e3)}function F(a){var z;if(!x.value)return;if(i.useToken(x.value.id,a))switch(a){case"skip":V();break;case"hint":const A=Math.floor(((z=p.value)==null?void 0:z.year)/10)*10;v.value=`This track was released in the ${A}s`,d.value=!0;break}}function P(){d.value=!1,v.value=""}function $(){i.resetGame(),R.push("/")}function r(){R.push("/")}function t(){const a=k.isAuthenticated(),c=localStorage.getItem("spotify_auth");console.log("Spotify auth check:",{isAuthenticated:a,authStateInStorage:c?JSON.parse(c):null,isSpotifyConnected:B.value}),C.value=a,a&&k.initializePlayerIfReady()}async function g(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await k.forceReauth(),t()}return ae(()=>{i.gamePhase==="setup"&&i.players.length===0&&R.push("/"),t();const a=setInterval(()=>{t()},2e3);te(()=>{clearInterval(a)})}),(a,c)=>{var z,A,Y,q;return n(),u("div",Mo,[e("header",zo,[e("div",Ao,[e("div",So,[e("button",{onClick:c[0]||(c[0]=y=>a.$router.push("/")),class:"btn btn-secondary"}," ← "+s(a.$t("common.back")),1),e("div",jo,[e("h1",Do,s(a.$t("game.title")),1),e("p",Bo,s(a.$t("game.round"))+" "+s(j.value),1)])]),e("div",Lo,[e("p",Ro,s(a.$t("game.turn.currentPlayer",{player:(z=x.value)==null?void 0:z.name})),1)])])]),e("main",Eo,[w.value==="setup"?(n(),u("div",Io,[e("div",No,[e("h2",Vo,s(a.$t("game.setupRequired")),1),e("p",Fo,s(a.$t("game.setupMessage")),1),e("button",{onClick:c[1]||(c[1]=y=>a.$router.push("/")),class:"btn btn-primary"},s(a.$t("game.backToSetup")),1)])])):w.value==="playing"?(n(),u("div",Oo,[e("div",Uo,[e("h2",Xo,s(a.$t("game.turn.currentPlayer",{player:(A=x.value)==null?void 0:A.name})),1),e("p",Ho,s(a.$t("game.turn.ready")),1),!p.value&&!T.value?(n(),u("div",Yo,[e("button",{onClick:V,class:"btn btn-primary btn-lg"}," 🎵 "+s(a.$t("game.getTrack")),1)])):f("",!0),T.value?(n(),u("div",qo,[e("div",Go,[c[3]||(c[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,s(a.$t("common.loading")),1)])])):f("",!0)]),e("div",Jo,[e("p",null,"Debug: isSpotifyConnected = "+s(B.value),1),e("p",null,"Debug: Direct check = "+s(H.value),1)]),B.value?B.value&&E.value?(n(),u("div",or,[e("div",{class:"flex items-center space-x-3"},[c[5]||(c[5]=le('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:g,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):f("",!0):(n(),u("div",Zo,[e("div",Ko,[c[4]||(c[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Wo,[e("h3",Qo,s(a.$t("game.spotify.notConnected")),1),e("p",er,s(a.$t("game.demoModeActive")),1)]),e("div",tr,[e("button",{onClick:r,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},s(a.$t("game.spotify.login")),1),e("button",{onClick:g,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:t,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),p.value?(n(),fe(At,{key:2,track:p.value,onPlaceTrack:M},null,8,["track"])):f("",!0),x.value?(n(),u("div",rr,[he(Co,{player:x.value,"is-current":!0,"current-track":p.value,"can-place":!!p.value,onPlaceTrack:M,onUseToken:F},null,8,["player","current-track","can-place"])])):f("",!0),e("div",sr,[e("h3",ar,s(a.$t("game.score.title")),1),e("div",lr,[(n(!0),u(W,null,Q(N.value,y=>{var O;return n(),u("div",{key:y.id,class:L(["text-center p-3 rounded-lg",y.id===((O=x.value)==null?void 0:O.id)?"bg-green-100":"bg-gray-50"])},[e("p",nr,s(y.name),1),e("p",ir,s(y.tokens),1),e("p",ur,s(a.$t("game.score.tokens",{count:y.tokens})),1),e("p",dr,s(a.$t("game.score.total",{score:y.score})),1)],2)}),128))])])])):w.value==="finished"?(n(),u("div",cr,[e("div",pr,[e("h2",gr,s(a.$t("game.end.title")),1),e("p",vr,s(a.$t("game.end.winner",{player:(Y=D.value)==null?void 0:Y.name,score:(q=D.value)==null?void 0:q.timeline.length})),1),e("div",mr,[e("h3",fr,s(a.$t("game.end.finalScores")),1),e("div",hr,[(n(!0),u(W,null,Q(U.value,(y,O)=>(n(),u("div",{key:y.id,class:L(["flex justify-between items-center p-3 rounded-lg",O===0?"bg-yellow-100":"bg-gray-50"])},[e("span",br,s(O+1)+". "+s(y.name),1),e("span",yr,s(y.timeline.length)+" "+s(a.$t("game.songs"))+" | "+s(y.tokens)+" "+s(a.$t("game.score.tokens",{count:y.tokens})),1)],2))),128))])]),e("div",kr,[e("button",{onClick:$,class:"btn btn-primary"}," 🔄 "+s(a.$t("game.end.playAgain")),1),e("button",{onClick:c[2]||(c[2]=y=>a.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+s(a.$t("game.backToHome")),1)])])])):f("",!0)]),d.value?(n(),u("div",xr,[e("div",wr,[c[7]||(c[7]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",$r,[e("div",_r,[c[6]||(c[6]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Tr,s(a.$t("game.tokens.hint.label")),1)]),e("div",Pr,[e("p",Cr,s(v.value),1)]),e("div",Mr,[e("button",{onClick:P,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},s(a.$t("common.close")),1)])])])])):f("",!0)])}}});export{Ar as default};
