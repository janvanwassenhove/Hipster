import{d as ce,n as ve,r as k,c as x,s as w,o as ie,a as oe,p as me,w as ae,b as u,e,g as y,q as ue,t as o,f as de,x as N,k as r,y as pe,h as S,F as le,j as ne,T as fe,u as be,l as he,z as ye}from"./index-Cif8iBo5.js";const ke={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},xe={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},we={class:"flex-shrink-0"},$e={key:0,class:"relative group"},_e={key:1,class:"relative group"},Ce=["src","alt"],Te={class:"flex-1 text-center md:text-left"},Pe={class:"mb-3"},De={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Ee={class:"text-xs text-gray-400 mt-1 font-light"},Se={class:"mb-3"},Ie={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Ae={class:"flex items-center justify-between mb-3"},Me={class:"flex items-center"},je={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},Ne={class:"text-left space-y-2"},ze={class:"text-amber-200 text-xs font-medium"},Be={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},Re={class:"text-amber-100 font-medium mb-2"},Ve={class:"text-amber-200 space-y-1 list-decimal list-inside"},Le={class:"flex justify-center space-x-3 mt-4"},Oe=["disabled"],He={key:0,class:"flex items-center"},Fe={key:1},Ue={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Ge={class:"flex items-center justify-center mb-2"},qe={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},Je={class:"text-green-200 text-xs"},We={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Ye={class:"flex items-center justify-center mb-2"},Ke={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Qe={class:"text-blue-200 text-xs"},Xe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},Ze={class:"flex items-center justify-center space-x-4 mb-3"},et=["disabled"],tt={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},st={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},ot={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},at={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},lt={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},nt={class:"text-center"},rt={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},it={class:"text-blue-200 text-sm font-medium mb-1"},ut={class:"text-blue-300 text-sm font-medium"},dt={class:"text-sm text-blue-400 mt-3"},ct=["href"],gt={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},mt={class:"text-center"},pt={class:"flex items-center justify-center mb-2"},vt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},ft={class:"text-purple-200 text-xs font-medium"},bt={class:"flex items-center justify-center mb-2"},ht={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},yt={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},kt={class:"font-bold text-lg"},xt={key:0,class:"text-sm mt-1 font-semibold"},wt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},$t=ce({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(W,{emit:G}){const i=W,{t:z}=ve(),f=k(!1),$=k(!1);k(!1);const b=k(0),C=k(0);k(.7),k(!1),k(!1),k(!1);const p=k(null),_=k(!1),O=x(()=>{var I,D,E,F;const a=(D=(I=i.track.images)==null?void 0:I[0])==null?void 0:D.url,d=(F=(E=i.track.album.images)==null?void 0:E[0])==null?void 0:F.url;return a||d||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),Q=x(()=>i.track.artists.map(a=>a.name).join(", ")),c=x(()=>i.showResult?i.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),n=x(()=>i.showResult?i.isCorrect?z("game.turn.correct",{year:i.track.year}):z("game.turn.incorrect",{year:i.track.year}):"");x(()=>C.value===0?0:b.value/C.value*100);const M=x(()=>!!i.track.uri),H=x(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),B=x(()=>H.value?M.value&&w.isAuthenticated():M.value&&w.isPlayerReady()),V=x(()=>B.value);async function L(){$.value=!0,p.value=null,_.value=!1;try{if(!await w.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");B.value&&i.track.uri&&(f.value?await w.pausePlayback()&&(f.value=!1):await w.startPlayback(i.track.uri)&&(f.value=!0,H.value?q():Z()))}catch(a){console.error("Playback error:",a),a.message==="NO_DEVICES_AVAILABLE"?(p.value="NO_DEVICES",_.value=!0):a.message==="DEVICE_NOT_FOUND"||a.message==="DEVICE_BECAME_INACTIVE"?(p.value="DEVICE_INACTIVE",_.value=!0):a.message==="PREMIUM_REQUIRED"?p.value="PREMIUM_REQUIRED":a.message==="DEVICE_ACTIVATION_FAILED"?(p.value="ACTIVATION_FAILED",_.value=!0):a.message.includes("No active Spotify device")||a.message.includes("No Spotify devices available")?(p.value="DEVICE_INACTIVE",_.value=!0):p.value="PLAYBACK_FAILED"}finally{$.value=!1}}function X(){_.value=!1,p.value=null}async function ee(){_.value=!1,p.value=null,await L()}function q(){const a=async()=>{var I;if(!B.value||!H.value)return;await w.keepSpotifyConnectActive();const d=await w.getSpotifyConnectState();if(d){const D=((I=d.item)==null?void 0:I.uri)===i.track.uri,E=d.is_playing&&D;f.value!==E&&(f.value=E),f.value&&setTimeout(a,5e3)}else f.value&&(console.log("🔇 No active playback detected - device may have become inactive"),f.value=!1,!_.value&&!p.value&&await w.hasAvailableDevices()&&(p.value="DEVICE_INACTIVE",_.value=!0))};a()}function Z(){const a=async()=>{if(!B.value)return;const d=await w.getPlaybackState();d&&(f.value=!d.paused,b.value=d.position/1e3,C.value=d.duration/1e3,f.value&&setTimeout(a,1e3))};a()}async function R(){var a,d,I,D;if(w.isPlayerReady())try{const E=await w.getPlaybackState();if(E){const F=((d=(a=E.track_window)==null?void 0:a.current_track)==null?void 0:d.uri)===i.track.uri,J=E.paused===!1&&F;console.log("Playback state check:",{paused:E.paused,currentTrackUri:(D=(I=E.track_window)==null?void 0:I.current_track)==null?void 0:D.uri,expectedUri:i.track.uri,isCurrentTrack:F,isActuallyPlaying:J,componentIsPlaying:f.value}),f.value!==J&&(console.log(`🔄 Syncing playback state: ${f.value} → ${J}`),f.value=J)}}catch(E){console.warn("Could not check playback state:",E)}}return ie(()=>{const a=setInterval(R,2e3);oe(()=>{clearInterval(a)})}),ie(()=>{w.isAuthenticated()&&me(()=>{w.initializePlayerIfReady()})}),ae(()=>i.track,async(a,d)=>{if(a&&a!==d){console.log("New track detected:",a.name),p.value=null,_.value=!1,await me(),f.value=!1;const I=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:V.value,canPlayFullTrack:B.value,hasSpotifyUri:M.value,isPlayerReady:w.isPlayerReady(),isPlaying:f.value}),V.value&&!f.value){console.log("Auto-starting playback for new track:",a.name);try{await w.ensurePlaybackReady()?(await L(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(D){I?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",D)}}else{const D=V.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${D}`),!I&&M.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),oe(()=>{B.value&&w.stopPlayback()}),(a,d)=>(r(),u("div",ke,[d[13]||(d[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",xe,[e("div",we,[a.showAnswer?(r(),u("div",_e,[e("img",{src:O.value,alt:a.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,Ce),d[1]||(d[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(r(),u("div",$e,d[0]||(d[0]=[ue('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",Te,[e("div",Pe,[e("p",De,o(a.$t("game.turn.listening")),1),e("p",Ee,o(a.$t("game.turn.placeOnTimeline")),1)]),e("div",Se,[_.value?(r(),u("div",Ie,[e("div",Ae,[e("div",Me,[d[2]||(d[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",je,o(p.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):p.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):p.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):a.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:X,class:"text-amber-300 hover:text-amber-100 transition-colors"},d[3]||(d[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ne,[e("p",ze,o(p.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):p.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):p.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):a.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",Be,[e("p",Re,o(a.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",Ve,[e("li",null,o(a.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",Le,[e("button",{onClick:ee,disabled:$.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[$.value?(r(),u("span",He,[d[4]||(d[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),de(" "+o(a.$t("game.deviceHelp.retrying","Retrying...")),1)])):(r(),u("span",Fe,o(a.$t("game.deviceHelp.retry","Try Again")),1))],8,Oe),e("button",{onClick:X,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},o(a.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):y("",!0),!V.value&&H.value&&M.value?(r(),u("div",Ue,[e("div",Ge,[d[5]||(d[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",qe,o(a.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",Je,o(a.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):B.value?y("",!0):(r(),u("div",We,[e("div",Ye,[d[6]||(d[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ke,o(M.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",Qe,o(M.value?a.$t("game.needsPremium"):a.$t("game.needSpotifyForAudio")),1)])),V.value?(r(),u("div",Xe,[e("div",Ze,[e("button",{onClick:L,class:"play-btn group relative",disabled:!V.value},[e("div",tt,[$.value?(r(),u("div",st)):f.value?(r(),u("svg",ot,d[7]||(d[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(r(),u("svg",at,d[8]||(d[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,et)])])):y("",!0)]),a.showAnswer?(r(),u("div",lt,[e("div",nt,[e("h4",rt,o(a.track.name),1),e("p",it,o(Q.value),1),e("p",ut,o(a.track.album.name)+" ("+o(a.track.year)+")",1),e("p",dt,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[d[9]||(d[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),de(" "+o(a.$t("game.openInSpotify")),1)],8,ct)])])])):y("",!0)])]),a.showAnswer?y("",!0):(r(),u("div",gt,[e("div",mt,[e("div",pt,[d[10]||(d[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",vt,o(a.$t("game.turn.placing")),1)]),e("p",ft,o(H.value?a.$t("game.timeline.mobileInstructions"):a.$t("game.dragToTimeline")),1)])])),a.showResult?(r(),u("div",{key:1,class:N(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",c.value])},[e("div",bt,[a.isCorrect?(r(),u("div",ht,d[11]||(d[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(r(),u("div",yt,d[12]||(d[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",kt,o(n.value),1)]),a.pointsEarned>0?(r(),u("p",xt,[e("span",wt,o(a.$t("game.turn.points",{points:a.pointsEarned})),1)])):y("",!0)],2)):y("",!0)]))}}),_t=(W,G)=>{const i=W.__vccOpts||W;for(const[z,f]of G)i[z]=f;return i},Ct=_t($t,[["__scopeId","data-v-03b041d1"]]),Tt={key:0,class:"absolute inset-0 opacity-10"},Pt={class:"relative z-10"},Dt={class:"flex items-center justify-between mb-6"},Et={class:"text-xl font-bold flex items-center space-x-3"},St={key:0,class:"text-2xl animate-bounce"},It={class:"text-right"},At={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Mt={class:"flex items-center space-x-2 text-sm text-gray-300"},jt={class:"font-medium"},Nt={key:0,class:"mb-6"},zt={class:"text-sm font-medium text-gray-300 mb-3"},Bt={class:"flex space-x-3"},Rt=["title"],Vt={class:"flex items-center space-x-2"},Lt=["title"],Ot={class:"flex items-center space-x-2"},Ht={class:"mb-6"},Ft={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Ut={key:0,class:"text-center py-12 text-gray-400"},Gt={class:"text-lg font-medium mb-2"},qt={class:"text-center text-gray-300 font-medium"},Jt={key:1,class:"space-y-3"},Wt={class:"text-center text-gray-400 text-sm font-medium"},Yt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},Kt={class:"flex items-center space-x-4"},Qt={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},Xt=["src","alt"],Zt={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},es={class:"flex-1 min-w-0"},ts={class:"font-bold text-lg text-gray-100 truncate"},ss={class:"text-sm text-gray-300 truncate font-medium"},os={class:"text-right flex-shrink-0"},as={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},ls=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],ns={class:"text-center text-gray-400 text-sm font-medium"},rs=["data-drop-zone"],is={class:"text-center text-gray-400 text-sm font-medium"},us=["draggable"],ds={class:"flex items-center space-x-4"},cs={class:"flex-1 min-w-0"},gs={class:"font-bold text-lg text-blue-200"},ms={class:"text-sm text-blue-300 font-medium"},ps={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},vs={class:"flex justify-between text-sm text-gray-300"},fs={class:"font-medium"},bs={key:0,class:"font-mono"},hs={key:0,class:"bg-yellow-900/50 text-yellow-200 p-3 mb-4 rounded text-xs"},ys={class:"flex items-center space-x-3 mb-4"},ks={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},xs={class:"mb-6"},ws={class:"text-gray-200 text-lg leading-relaxed"},$s={class:"flex space-x-3"},_s={class:"mt-4 text-center"},Cs={key:1,class:"mt-4 p-3 bg-black/30 rounded max-h-32 overflow-y-auto"},Ts=ce({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(W,{emit:G}){const i=W,z=G,f=k(!1),$=k([]),b=k(null),C=k(!1);k({isPressed:!1,action:""});const p=k(!0),_=k([]),O=k("");k(0);function Q(t){const v=`[${new Date().toLocaleTimeString()}] ${t}`;_.value.unshift(v),O.value=v,console.log("MOBILE_DEBUG:",v),_.value.length>10&&(_.value=_.value.slice(0,10))}function c(t,s){const A=`[${new Date().toLocaleTimeString()}] ${t}`;console.log("🎵 TIMELINE_DEBUG:",A,s||""),Q(A)}const n=x(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),M=x(()=>"ontouchstart"in window);x(()=>navigator.maxTouchPoints||0);const H=x(()=>navigator.userAgent);x(()=>`${window.innerWidth}x${window.innerHeight}`),c("PlayerTimeline component initialized",{isMobile:n.value,touchSupport:M.value}),console.log("COMPONENT MOUNTED - JS DEFINITELY WORKING"),n.value&&console.log("MOBILE DEVICE DETECTED - Touch events should work");const B=x(()=>{var v;const t=((v=i.player)==null?void 0:v.timeline)||[];if(t.length<2)return null;const s=t.map(A=>A.year).sort((A,K)=>A-K);return`${s[0]} - ${s[s.length-1]}`});function V(t){var s,v;return t.images&&t.images.length>0&&((s=t.images[0])!=null&&s.url)?t.images[0].url:t.album&&t.album.images&&t.album.images.length>0&&((v=t.album.images[0])!=null&&v.url)?t.album.images[0].url:"/placeholder-album.png"}function L(t){return t.artists.map(s=>s.name).join(", ")}function X(t){var v;if(!i.currentTrack)return;(v=t.dataTransfer)==null||v.setData("text/plain",JSON.stringify(i.currentTrack)),t.target.classList.add("dragging")}function ee(t){t.target.classList.remove("dragging"),f.value=!1,$.value=[]}function q(t){!i.currentTrack||!i.canPlace||(f.value=!1,$.value=[],z("placeTrack",i.currentTrack,t))}function Z(t){z("useToken",t)}function R(t){if(c(`Timeline slot touched: position ${t}`),!i.currentTrack||!i.canPlace){c("Cannot place track",{hasCurrentTrack:!!i.currentTrack,canPlace:i.canPlace});return}b.value=t,C.value=!0,c("Dialog should open",{position:b.value,showConfirmation:C.value}),"vibrate"in navigator&&(navigator.vibrate(50),c("Haptic feedback triggered")),setTimeout(()=>{const s=document.querySelector('[style*="z-index: 99999"]');c("Dialog element check",{found:!!s,visible:s?getComputedStyle(s).display:"not found"})},100)}function a(t){var A;if(t===null)return"";const s=((A=i.player)==null?void 0:A.timeline)||[],v=s.length;return t===0?v===0?"Place as your first track":`Place before ${s[0].name} (${s[0].year})`:t===v?`Place after ${s[v-1].name} (${s[v-1].year})`:`Place between ${s[t-1].name} (${s[t-1].year}) and ${s[t].name} (${s[t].year})`}function d(){"vibrate"in navigator&&navigator.vibrate(50)}function I(t){var s;c("Cancel button clicked (main handler)",{eventType:t.type,target:(s=t.target)==null?void 0:s.tagName}),t.preventDefault(),t.stopPropagation(),Y()}function D(t){var s;c("Confirm button clicked (main handler)",{eventType:t.type,target:(s=t.target)==null?void 0:s.tagName}),t.preventDefault(),t.stopPropagation(),te()}function E(t){var v;c("Cancel touch start",{touches:t.touches.length,target:(v=t.target)==null?void 0:v.tagName}),t.preventDefault();const s=t.target;s.style.transform="scale(0.95)",s.style.opacity="0.8",c("Cancel touch visual feedback applied")}function F(t){c("Cancel touch end"),t.preventDefault();const s=t.target;s.style.transform="",s.style.opacity="",setTimeout(()=>Y(),50)}function J(t){var v;c("Confirm touch start",{touches:t.touches.length,target:(v=t.target)==null?void 0:v.tagName}),t.preventDefault();const s=t.target;s.style.transform="scale(0.95)",s.style.opacity="0.8",c("Confirm touch visual feedback applied")}function re(t){c("Confirm touch end"),t.preventDefault();const s=t.target;s.style.transform="",s.style.opacity="",setTimeout(()=>te(),50)}function Y(){c("Performing cancel action",{currentPosition:b.value,dialogShown:C.value}),"vibrate"in navigator&&navigator.vibrate(50),b.value=null,C.value=!1,c("Cancel completed",{position:b.value,dialogShown:C.value})}function te(){var t;c("Performing confirm action",{position:b.value,hasTrack:!!i.currentTrack,trackName:(t=i.currentTrack)==null?void 0:t.name}),"vibrate"in navigator&&navigator.vibrate(100),b.value!==null&&i.currentTrack?(c("Emitting placeTrack event",{position:b.value,trackName:i.currentTrack.name}),z("placeTrack",i.currentTrack,b.value),b.value=null,C.value=!1,c("Confirm completed successfully")):c("Confirm failed - missing data",{position:b.value,hasTrack:!!i.currentTrack})}function l(){c("Dialog background clicked - ignoring to prevent accidental dismissal")}function g(){c("Ultra basic test clicked"),alert("Vue click handler works!")}function P(){c("Emergency test clicked"),alert("Emergency click worked! JS is functional!")}function j(){p.value=!p.value,c(`Debug info ${p.value?"enabled":"disabled"}`)}function U(){var s;const t=((s=i.player)==null?void 0:s.timeline)||[];$.value=new Array(t.length+1).fill(!1)}return oe(()=>{}),ae(()=>{var t;return(((t=i.player)==null?void 0:t.timeline)||[]).length},()=>{U()},{immediate:!0}),ae(C,(t,s)=>{c(`Dialog state changed: ${s} → ${t}`,{position:b.value,mobile:n.value,timestamp:Date.now()}),t&&setTimeout(()=>{const v=document.querySelectorAll('[style*="z-index: 99999"]');c("Dialog render check",{dialogCount:v.length,bodyChildren:document.body.children.length})},50)}),(t,s)=>{var v,A,K,T;return r(),u("div",{class:N(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":t.isCurrent}])},[t.isCurrent?(r(),u("div",Tt,s[21]||(s[21]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):y("",!0),e("div",Pt,[e("div",Dt,[e("h3",Et,[e("span",{class:N(t.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},o(t.player.name),3),t.isCurrent?(r(),u("span",St,"👑")):y("",!0)]),e("div",It,[e("p",At,o(t.player.score),1),e("div",Mt,[s[22]||(s[22]=e("span",{class:"text-lg"},"🎵",-1)),e("span",jt,o(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(r(),u("div",Nt,[e("h4",zt,o(t.$t("game.tokenAbilities")),1),e("div",Bt,[e("button",{onClick:s[0]||(s[0]=m=>Z("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:t.$t("game.tokens.skip.description")},[e("div",Vt,[s[23]||(s[23]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,o(t.$t("game.tokens.skip.label")),1)])],8,Rt),e("button",{onClick:s[1]||(s[1]=m=>Z("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:t.$t("game.tokens.hint.description")},[e("div",Ot,[s[24]||(s[24]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,o(t.$t("game.tokens.hint.label")),1)])],8,Lt)])])):y("",!0),e("div",Ht,[e("h4",Ft,[s[25]||(s[25]=e("span",{class:"mr-2"},"🎵",-1)),de(" "+o(t.$t("game.timeline.title")),1)]),!t.player.timeline||t.player.timeline.length===0?(r(),u("div",Ut,[s[26]||(s[26]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Gt,o(t.$t("game.timeline.empty")),1),t.canPlace?(r(),u("div",{key:0,class:N(["timeline-slot mt-6 group",{"drag-over":!n.value&&f.value,selected:b.value===0&&n.value}]),onDragover:s[2]||(s[2]=S(m=>n.value?null:f.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=S(m=>n.value?null:f.value=!1,["prevent"])),onDrop:s[4]||(s[4]=S(m=>n.value?null:q(0),["prevent"])),onTouchstart:s[5]||(s[5]=S(m=>n.value?R(0):null,["prevent"])),onClick:s[6]||(s[6]=m=>n.value?R(0):null),"data-drop-zone":0},[e("div",{class:N(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":b.value===0&&n.value}])},[e("p",qt,o(n.value?t.$t("game.timeline.tapToSelect"):t.$t("game.timeline.placeHere")),1)],2)],34)):y("",!0)])):t.player.timeline&&t.player.timeline.length>0?(r(),u("div",Jt,[t.canPlace?(r(),u("div",{key:0,class:N(["timeline-slot h-20 group",{"drag-over":!n.value&&$.value[0],selected:b.value===0&&n.value}]),onDragover:s[7]||(s[7]=S(m=>n.value?null:$.value[0]=!0,["prevent"])),onDragleave:s[8]||(s[8]=S(m=>n.value?null:$.value[0]=!1,["prevent"])),onDrop:s[9]||(s[9]=S(m=>n.value?null:q(0),["prevent"])),onTouchstart:s[10]||(s[10]=S(m=>n.value?R(0):null,["prevent"])),onClick:s[11]||(s[11]=m=>n.value?R(0):null),"data-drop-zone":0},[e("div",{class:N(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":b.value===0&&n.value}])},[e("p",Wt,o(n.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeEarlier")),1)],2)],34)):y("",!0),(r(!0),u(le,null,ne(t.player.timeline||[],(m,h)=>{var ge;return r(),u("div",{key:m.id,class:"track-card group relative"},[e("div",Yt,[e("div",Kt,[e("div",Qt,[m.revealed?(r(),u("img",{key:0,src:V(m),alt:m.name,class:"w-16 h-16 object-cover"},null,8,Xt)):(r(),u("div",Zt,s[27]||(s[27]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",es,[e("p",ts,o(m.name),1),e("p",ss,o(L(m)),1)]),e("div",os,[e("p",as,o(m.year),1)])])]),t.canPlace&&h<(((ge=t.player.timeline)==null?void 0:ge.length)||0)-1?(r(),u("div",{key:0,class:N(["timeline-slot h-20 mt-3 group",{"drag-over":$.value[h+1],selected:b.value===h+1&&n.value}]),onDragover:S(se=>$.value[h+1]=!0,["prevent"]),onDragleave:S(se=>$.value[h+1]=!1,["prevent"]),onDrop:S(se=>q(h+1),["prevent"]),onTouchstart:S(se=>n.value?R(h+1):null,["prevent"]),onClick:se=>n.value?R(h+1):null,"data-drop-zone":h+1},[e("div",{class:N(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":b.value===h+1&&n.value}])},[e("p",ns,o(n.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeBetween")),1)],2)],42,ls)):y("",!0)])}),128)),t.canPlace?(r(),u("div",{key:1,class:N(["timeline-slot h-20 group",{"drag-over":!n.value&&$.value[((v=t.player.timeline)==null?void 0:v.length)||0],selected:b.value===(((A=t.player.timeline)==null?void 0:A.length)||0)&&n.value}]),onDragover:s[12]||(s[12]=S(m=>{var h;return n.value?null:$.value[((h=t.player.timeline)==null?void 0:h.length)||0]=!0},["prevent"])),onDragleave:s[13]||(s[13]=S(m=>{var h;return n.value?null:$.value[((h=t.player.timeline)==null?void 0:h.length)||0]=!1},["prevent"])),onDrop:s[14]||(s[14]=S(m=>{var h;return n.value?null:q(((h=t.player.timeline)==null?void 0:h.length)||0)},["prevent"])),onTouchstart:s[15]||(s[15]=S(m=>{var h;return n.value?R(((h=t.player.timeline)==null?void 0:h.length)||0):null},["prevent"])),onClick:s[16]||(s[16]=m=>{var h;return n.value?R(((h=t.player.timeline)==null?void 0:h.length)||0):null}),"data-drop-zone":((K=t.player.timeline)==null?void 0:K.length)||0},[e("div",{class:N(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":b.value===(((T=t.player.timeline)==null?void 0:T.length)||0)&&n.value}])},[e("p",is,o(n.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeLater")),1)],2)],42,rs)):y("",!0)])):y("",!0)])]),t.canPlace&&t.currentTrack?(r(),u("div",{key:1,class:N(["timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",n.value?"cursor-pointer":"cursor-move"]),draggable:!n.value,onDragstart:s[17]||(s[17]=m=>n.value?null:X),onDragend:s[18]||(s[18]=m=>n.value?null:ee),onClick:s[19]||(s[19]=m=>n.value?d:null)},[e("div",ds,[s[28]||(s[28]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",cs,[e("p",gs,o(t.$t("game.newTrack")),1),e("p",ms,o(n.value?t.$t("game.tapToPlace"):t.$t("game.dragToPlace")),1)]),s[29]||(s[29]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],42,us)):y("",!0),t.player.timeline&&t.player.timeline.length>0?(r(),u("div",ps,[e("div",vs,[e("span",fs,o(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),B.value?(r(),u("span",bs,o(B.value),1)):y("",!0)])])):y("",!0),C.value&&n.value?(r(),pe(fe,{key:3,to:"body"},[e("div",{class:"fixed inset-0 bg-black/70 flex items-center justify-center p-4",style:{"z-index":"99999"},onClick:l},[e("div",{class:"bg-slate-900 border border-purple-500/20 rounded-2xl p-6 max-w-sm w-full mx-auto shadow-2xl",style:{"z-index":"100000"},onClick:s[20]||(s[20]=S(()=>{},["stop"]))},[e("div",{class:"bg-red-600 text-white p-3 mb-4 text-center font-bold rounded cursor-pointer",onClick:P}," 🚨 TOUCH TO TEST: JavaScript Working! "),p.value?(r(),u("div",hs,[s[31]||(s[31]=e("p",null,[e("strong",null,"Debug Info:")],-1)),e("p",null,"Mobile: "+o(n.value),1),e("p",null,"Position: "+o(b.value),1),e("p",null,"Show Dialog: "+o(C.value),1),e("p",null,"Current Track: "+o(!!t.currentTrack),1),e("p",null,"Touch Support: "+o(M.value),1),e("p",null,"User Agent: "+o(H.value.substring(0,50))+"...",1),e("div",{class:"mt-2 flex space-x-2"},[e("button",{onClick:g,class:"bg-blue-600 text-white px-2 py-1 rounded"},"Vue Test"),s[30]||(s[30]=e("button",{onclick:"alert('Raw JS works!')",class:"bg-green-600 text-white px-2 py-1 rounded"},"Raw Test",-1))])])):y("",!0),e("div",ys,[s[32]||(s[32]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",ks,o(t.$t("game.timeline.selectedPosition")),1)]),e("div",xs,[e("p",ws,o(a(b.value)),1)]),e("div",$s,[e("button",{onClick:I,onTouchstart:E,onTouchend:F,class:"flex-1 bg-red-600 hover:bg-red-700 text-white p-4 rounded-xl text-center font-bold transition-colors text-lg shadow-lg",style:{"min-height":"60px","touch-action":"manipulation"}}," ❌ Cancel ",32),e("button",{onClick:D,onTouchstart:J,onTouchend:re,class:"flex-1 bg-green-600 hover:bg-green-700 text-white p-4 rounded-xl text-center font-bold transition-colors text-lg shadow-lg",style:{"min-height":"60px","touch-action":"manipulation"}}," ✅ Confirm ",32)]),e("div",_s,[e("button",{onClick:j,class:"text-xs text-gray-400 hover:text-gray-200 underline p-2"},o(p.value?"Hide Debug":"Show Debug"),1)]),p.value&&_.value.length>0?(r(),u("div",Cs,[s[33]||(s[33]=e("p",{class:"font-bold mb-1 text-xs"},"Recent Events:",-1)),(r(!0),u(le,null,ne(_.value.slice(0,8),(m,h)=>(r(),u("div",{key:h,class:"text-xs mb-1"},o(m),1))),128))])):y("",!0)])])])):y("",!0)],2)}}}),Ps={class:"min-h-screen flex flex-col"},Ds={class:"bg-white/10 backdrop-blur-sm p-4"},Es={class:"flex justify-between items-center"},Ss={class:"flex items-center space-x-4"},Is={class:"text-white"},As={class:"text-xl font-bold"},Ms={class:"flex items-center space-x-3 text-sm opacity-80"},js={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},Ns={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},zs={class:"text-white text-right"},Bs={class:"text-sm opacity-80"},Rs={class:"flex-1 container mx-auto px-4 py-6"},Vs={key:0,class:"max-w-2xl mx-auto"},Ls={class:"card text-center"},Os={class:"text-2xl font-semibold mb-4"},Hs={class:"text-gray-600 mb-6"},Fs={key:1,class:"space-y-6"},Us={class:"card text-center bg-green-50 border-green-200"},Gs={class:"text-2xl font-bold text-white mb-2"},qs={class:"text-white"},Js={key:0,class:"mt-4"},Ws={key:1,class:"mt-4"},Ys={class:"flex items-center justify-center space-x-2"},Ks={key:0,class:"card bg-yellow-50 border-yellow-200"},Qs={class:"flex items-center space-x-3"},Xs={class:"flex-1"},Zs={class:"text-lg font-semibold text-yellow-800"},eo={class:"text-yellow-700 text-sm"},to={class:"flex space-x-2"},so={key:1,class:"card bg-orange-50 border-orange-200"},oo={key:2,class:"card bg-blue-50 border-blue-200"},ao={key:4,class:"text-center mb-6"},lo={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},no={class:"mb-4"},ro={class:"flex items-center justify-center mb-3"},io={class:"text-center"},uo={class:"text-2xl font-bold text-red-200 mb-2"},co={class:"text-red-100"},go={class:"text-lg font-semibold"},mo={class:"text-base"},po={class:"text-sm opacity-90"},vo={class:"text-red-200 text-lg mb-4"},fo={class:"text-red-300 text-sm"},bo={key:5,class:"max-w-4xl mx-auto"},ho={class:"card"},yo={class:"text-lg font-semibold mb-4 text-gray-100"},ko={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},xo={class:"font-semibold text-gray-800"},wo={class:"text-2xl font-bold text-gray-900"},$o={class:"text-sm text-gray-600"},_o={class:"text-xs text-gray-500"},Co={key:2,class:"max-w-2xl mx-auto"},To={class:"card text-center"},Po={class:"text-3xl font-bold mb-4 text-white"},Do={class:"text-xl mb-6"},Eo={class:"mb-6"},So={class:"text-lg font-semibold mb-3"},Io={class:"space-y-2"},Ao={class:"font-medium"},Mo={class:"font-bold"},jo={class:"flex space-x-4 justify-center"},No={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},zo={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Bo={class:"relative z-10"},Ro={class:"flex items-center space-x-3 mb-6"},Vo={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Lo={class:"mb-8"},Oo={class:"text-gray-200 text-lg leading-relaxed"},Ho={class:"flex justify-center"},Uo=ce({__name:"GameView",setup(W){const G=he(),i=be(),z=k(!1),f=k(!1),$=k(""),b=k(w.isAuthenticated()),C=k(!1),p=k(!1),_=k(!1),O=k({isCorrect:!1,pointsEarned:0}),Q=x(()=>i.players),c=x(()=>i.currentPlayer),n=x(()=>i.currentTrack),M=x(()=>i.gamePhase),H=x(()=>i.round),B=x(()=>i.settings),V=x(()=>i.winner),L=x(()=>b.value),X=x(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),ee=x(()=>L.value?!w.isPlayerReady()&&Z.value>3e4:!1),q=k(Date.now()),Z=x(()=>Date.now()-q.value),R=x(()=>[...Q.value].sort((l,g)=>{var U,t;const P=((U=l.timeline)==null?void 0:U.length)||0,j=((t=g.timeline)==null?void 0:t.length)||0;return j!==P?j-P:g.tokens!==l.tokens?g.tokens-l.tokens:g.score-l.score}));async function a(){var l;z.value=!0,C.value=!1,p.value=!1,O.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const g=await i.getNextTrack();g?console.log("Track loaded successfully:",g.name,"by",(l=g.artists[0])==null?void 0:l.name):console.error("No tracks available")}catch(g){console.error("Error loading track:",g)}finally{z.value=!1}}function d(l,g){const P=i.placeTrackOnTimeline(l,g);let j=0;P&&c.value&&(j=1,c.value.timeline.length>=5&&(j=2),c.value.timeline.length>=8&&(j=3)),O.value={isCorrect:P,pointsEarned:j},C.value=!0,setTimeout(()=>{p.value=!0},500),P?setTimeout(()=>{C.value=!1,p.value=!1,i.nextPlayer()},4e3):setTimeout(()=>{if(_.value=!0,c.value&&n.value){const U=I(n.value,c.value.timeline),t={...n.value,revealed:!0};i.addTrackToTimelineAtPosition(t,U)}},1500)}function I(l,g){for(let P=0;P<g.length;P++)if(l.year<=g[P].year)return P;return g.length}function D(){n.value&&c.value&&i.removeTrackFromTimeline(n.value.id),C.value=!1,p.value=!1,_.value=!1,i.nextPlayer()}function E(l){var P;if(!c.value)return;if(i.useToken(c.value.id,l))switch(l){case"skip":a();break;case"hint":const j=Math.floor(((P=n.value)==null?void 0:P.year)/10)*10;$.value=`This track was released in the ${j}s`,f.value=!0;break}}function F(){f.value=!1,$.value=""}function J(){i.resetGame(),G.push("/")}function re(){G.push("/")}function Y(){const l=w.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:l,previousState:L.value}),b.value!==l&&(b.value=l,console.log("Spotify auth state updated:",l)),l&&!w.isPlayerReady()&&(console.log("Initializing player after auth check"),w.initializePlayerIfReady())}async function te(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await w.forceReauth(),Y()}return ie(()=>{i.gamePhase==="setup"&&i.players.length===0&&G.push("/"),Y(),w.isAuthenticated()&&w.startSessionMaintenance();const l=setInterval(()=>{b.value?w.startSessionMaintenance():Y()},12e4);oe(()=>{clearInterval(l),w.stopSessionMaintenance()})}),ae(n,l=>{l&&(C.value=!1,p.value=!1,O.value={isCorrect:!1,pointsEarned:0})}),(l,g)=>{var P,j,U,t,s,v,A,K;return r(),u("div",Ps,[e("header",Ds,[e("div",Es,[e("div",Ss,[e("button",{onClick:g[0]||(g[0]=T=>l.$router.push("/")),class:"btn btn-secondary"}," ← "+o(l.$t("common.back")),1),e("div",Is,[e("h1",As,o(l.$t("game.title")),1),e("div",Ms,[e("span",null,o(l.$t("game.round"))+" "+o(H.value),1),B.value.theme?(r(),u("span",js," 🎵 "+o(l.$t(`game.themes.${B.value.theme}`)),1)):(r(),u("span",Ns," 🎵 "+o(l.$t("game.allMusic")),1))])])]),e("div",zs,[e("p",Bs,o(l.$t("game.turn.currentPlayer",{player:(P=c.value)==null?void 0:P.name})),1)])])]),e("main",Rs,[M.value==="setup"?(r(),u("div",Vs,[e("div",Ls,[e("h2",Os,o(l.$t("game.setupRequired")),1),e("p",Hs,o(l.$t("game.setupMessage")),1),e("button",{onClick:g[1]||(g[1]=T=>l.$router.push("/")),class:"btn btn-primary"},o(l.$t("game.backToSetup")),1)])])):M.value==="playing"?(r(),u("div",Fs,[e("div",Us,[e("h2",Gs,o(l.$t("game.turn.currentPlayer",{player:(j=c.value)==null?void 0:j.name})),1),e("p",qs,o(l.$t("game.turn.ready")),1),!n.value&&!z.value?(r(),u("div",Js,[e("button",{onClick:a,class:"btn btn-primary btn-lg"}," 🎵 "+o(l.$t("game.getTrack")),1)])):y("",!0),z.value?(r(),u("div",Ws,[e("div",Ys,[g[3]||(g[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,o(l.$t("common.loading")),1)])])):y("",!0)]),L.value?L.value&&ee.value?(r(),u("div",so,[e("div",{class:"flex items-center space-x-3"},[g[5]||(g[5]=ue('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:te,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):y("",!0):(r(),u("div",Ks,[e("div",Qs,[g[4]||(g[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Xs,[e("h3",Zs,o(l.$t("game.spotify.notConnected")),1),e("p",eo,o(l.$t("game.demoModeActive")),1)]),e("div",to,[e("button",{onClick:re,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},o(l.$t("game.spotify.login")),1),e("button",{onClick:te,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:Y,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),X.value&&L.value?(r(),u("div",oo,g[6]||(g[6]=[ue('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):y("",!0),n.value?(r(),pe(Ct,{key:3,track:n.value,"show-result":C.value,"show-answer":p.value,"is-correct":O.value.isCorrect,"points-earned":O.value.pointsEarned,onPlaceTrack:d},null,8,["track","show-result","show-answer","is-correct","points-earned"])):y("",!0),_.value&&!O.value.isCorrect?(r(),u("div",ao,[e("div",lo,[e("div",no,[e("div",ro,[g[7]||(g[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",io,[e("h3",uo,o(l.$t("game.turn.wrongPlacement")),1),e("div",co,[e("p",go,o((U=n.value)==null?void 0:U.name),1),e("p",mo,o((t=n.value)==null?void 0:t.artists.map(T=>T.name).join(", ")),1),e("p",po,o(l.$t("game.turn.releasedIn",{year:(s=n.value)==null?void 0:s.year})),1)])])]),e("p",vo,o(l.$t("game.turn.correctPlacement")),1),e("p",fo,o(l.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:D,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},o(l.$t("game.turn.continue")),1)])])):y("",!0),c.value&&c.value.timeline?(r(),u("div",bo,[ye(Ts,{player:c.value,"is-current":!0,"current-track":n.value,"can-place":!!n.value,onPlaceTrack:d,onUseToken:E},null,8,["player","current-track","can-place"])])):y("",!0),e("div",ho,[e("h3",yo,o(l.$t("game.score.title")),1),e("div",ko,[(r(!0),u(le,null,ne(Q.value,T=>{var m;return r(),u("div",{key:T.id,class:N(["text-center p-3 rounded-lg",T.id===((m=c.value)==null?void 0:m.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",xo,o(T.name),1),e("p",wo,o(T.tokens),1),e("p",$o,o(l.$t("game.score.tokens",{count:T.tokens})),1),e("p",_o,o(l.$t("game.score.total",{score:T.score})),1)],2)}),128))])])])):M.value==="finished"?(r(),u("div",Co,[e("div",To,[e("h2",Po,o(l.$t("game.end.title")),1),e("p",Do,o(l.$t("game.end.winner",{player:(v=V.value)==null?void 0:v.name,score:((K=(A=V.value)==null?void 0:A.timeline)==null?void 0:K.length)||0})),1),e("div",Eo,[e("h3",So,o(l.$t("game.end.finalScores")),1),e("div",Io,[(r(!0),u(le,null,ne(R.value,(T,m)=>{var h;return r(),u("div",{key:T.id,class:N(["flex justify-between items-center p-3 rounded-lg",m===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Ao,o(m+1)+". "+o(T.name),1),e("span",Mo,o(((h=T.timeline)==null?void 0:h.length)||0)+" "+o(l.$t("game.songs"))+" | "+o(T.tokens)+" "+o(l.$t("game.score.tokens",{count:T.tokens})),1)],2)}),128))])]),e("div",jo,[e("button",{onClick:J,class:"btn btn-primary"}," 🔄 "+o(l.$t("game.end.playAgain")),1),e("button",{onClick:g[2]||(g[2]=T=>l.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+o(l.$t("game.backToHome")),1)])])])):y("",!0)]),f.value?(r(),u("div",No,[e("div",zo,[g[9]||(g[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Bo,[e("div",Ro,[g[8]||(g[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Vo,o(l.$t("game.tokens.hint.label")),1)]),e("div",Lo,[e("p",Oo,o($.value),1)]),e("div",Ho,[e("button",{onClick:F,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},o(l.$t("common.close")),1)])])])])):y("",!0)])}}});export{Uo as default};
