import{d as G,l as ne,r as w,c as f,s as C,o as Y,n as K,w as Z,m as ee,a as o,b as e,e as g,t,p as Q,q as B,j as n,f as x,F as O,h as U,u as oe,i as re,x as W}from"./index-CkALMGd9.js";const ie={class:"card"},ue={class:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6"},ce={class:"flex-shrink-0"},de={key:0,class:"w-32 h-32 rounded-lg shadow-lg bg-gray-200 flex items-center justify-center"},ve=["src","alt"],me={class:"flex-1 text-center md:text-left"},ge={key:0,class:"mb-4"},pe={class:"text-gray-600"},fe={class:"text-sm text-gray-500"},he={key:1,class:"mb-4"},ye={class:"text-xl font-bold text-gray-800"},ke={class:"text-lg text-gray-600"},be={class:"text-sm text-gray-500"},$e={key:2,class:"mb-4"},_e={class:"text-xl font-bold text-gray-800"},xe={class:"text-lg text-gray-600"},we={class:"text-gray-600"},Te={class:"text-sm text-gray-500"},Pe={class:"mb-4"},Ce={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center"},Me={class:"flex items-center justify-center mb-2"},Ae={class:"text-lg font-semibold text-blue-800"},ze={class:"text-blue-700 mb-2"},Se={class:"text-sm text-blue-600"},Be={class:"text-xs text-blue-500 mt-1"},Le=["src"],De={key:2,class:"music-player-controls bg-gray-900 rounded-lg p-4"},je={class:"flex items-center justify-center space-x-6 mb-4"},Ve=["disabled"],Ie=["disabled"],Ee={key:0,class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},Fe={key:1,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},Ne={key:2,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},Re=["disabled"],He={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Oe={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ue={key:2,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},qe={class:"mb-3"},Ge={class:"flex items-center space-x-3 text-xs text-gray-300"},Je={class:"w-12 text-right"},Xe={class:"flex-1 relative"},Ke={class:"w-12"},Qe={class:"flex items-center space-x-3"},We={class:"flex-1 relative"},Ye=["value","disabled"],Ze={class:"text-xs text-gray-400 w-8"},et={key:3,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},tt={class:"text-center"},st={class:"text-lg font-bold text-blue-800"},at={class:"text-blue-700"},lt={class:"text-blue-600"},nt={class:"text-sm text-blue-500 mt-2"},ot=["href"],rt={key:0,class:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},it={class:"text-center font-medium text-yellow-800"},ut={class:"text-center text-sm text-yellow-700 mt-1"},ct={class:"font-bold text-lg"},dt={key:0,class:"text-sm mt-1"},vt=G({__name:"TrackPlayer",props:{track:{},difficulty:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(E,{emit:j}){const i=E,{t:M}=ne(),u=w(),v=w(!1),b=w(!1),T=w(!1),A=w(0),z=w(0),_=w(.7),y=w(!1),V=f(()=>{var $,q,H,X;const a=(q=($=i.track.images)==null?void 0:$[0])==null?void 0:q.url,c=(X=(H=i.track.album.images)==null?void 0:H[0])==null?void 0:X.url;return a||c||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),L=f(()=>i.track.artists.map(a=>a.name).join(", ")),s=f(()=>i.showResult?i.isCorrect?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800":""),r=f(()=>i.showResult?i.isCorrect?M("game.turn.correct",{year:i.track.year}):M("game.turn.incorrect",{year:i.track.year}):""),d=f(()=>z.value===0?0:A.value/z.value*100),k=f(()=>!!i.track.uri),h=f(()=>k.value&&C.isPlayerReady()),S=f(()=>!!i.track.preview_url),l=f(()=>h.value||S.value);async function m(){console.log("Toggle playback called, isPlaying:",v.value),console.log("Can play full track:",h.value),console.log("Can play preview:",S.value),h.value?v.value?(await C.pausePlayback(),v.value=!1):await C.playTrack(i.track.uri)&&(v.value=!0,I()):S.value&&u.value&&(v.value?u.value.pause():u.value.play().catch(a=>{console.error("Error playing audio:",a)}))}async function D(){console.log("Restart track called"),h.value?await C.playTrack(i.track.uri)&&(v.value=!0,I()):u.value&&(u.value.currentTime=0,v.value&&u.value.play().catch(a=>{console.error("Error playing audio after restart:",a)}))}function I(){const a=async()=>{if(!h.value)return;const c=await C.getPlaybackState();c&&(v.value=!c.paused,A.value=c.position/1e3,z.value=c.duration/1e3,v.value&&setTimeout(a,1e3))};a()}function F(){u.value&&(y.value?(u.value.volume=_.value,y.value=!1):(u.value.volume=0,y.value=!0))}function N(a){if(!u.value)return;const c=a.target,$=parseFloat(c.value);_.value=$,u.value.volume=$,$===0?y.value=!0:y.value&&(y.value=!1)}function p(a){if(!u.value||!i.track.preview_url)return;const $=a.currentTarget.getBoundingClientRect(),H=(a.clientX-$.left)/$.width*z.value;u.value.currentTime=H}function P(a){if(isNaN(a))return"0:00";const c=Math.floor(a/60),$=Math.floor(a%60);return`${c}:${$.toString().padStart(2,"0")}`}function R(){u.value&&(A.value=u.value.currentTime)}function te(){u.value&&(z.value=u.value.duration,u.value.volume=_.value)}function se(){b.value=!0,T.value=!1}function ae(){b.value=!1,T.value=!0}function le(){v.value=!1}Y(()=>{C.isAuthenticated()&&K(()=>{C.initializePlayerIfReady()}),K(()=>{u.value&&J()})}),Z(u,a=>{a&&J()});function J(){u.value&&(u.value.addEventListener("play",()=>{v.value=!0}),u.value.addEventListener("pause",()=>{v.value=!1}),u.value.volume=_.value)}return ee(()=>{h.value?C.stopPlayback():u.value&&u.value.pause()}),(a,c)=>(n(),o("div",ie,[e("div",ue,[e("div",ce,[a.showAnswer?(n(),o("img",{key:1,src:V.value,alt:a.track.name,class:"w-32 h-32 rounded-lg shadow-lg object-cover"},null,8,ve)):(n(),o("div",de,c[1]||(c[1]=[e("svg",{class:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",me,[a.difficulty==="original"?(n(),o("div",ge,[e("p",pe,t(a.$t("game.turn.listening")),1),e("p",fe,t(a.$t("game.difficulties.originalHint")),1)])):a.difficulty==="pro"?(n(),o("div",he,[e("h3",ye,t(a.track.name),1),e("p",ke,t(L.value),1),e("p",be,t(a.$t("game.difficulties.proHint")),1)])):a.difficulty==="expert"?(n(),o("div",$e,[e("h3",_e,t(a.track.name),1),e("p",xe,t(L.value),1),e("p",we,t(a.track.album.name),1),e("p",Te,t(a.$t("game.difficulties.expertHint")),1)])):g("",!0),e("div",Pe,[h.value?g("",!0):(n(),o("div",Ce,[e("div",Me,[c[2]||(c[2]=e("svg",{class:"w-8 h-8 text-blue-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)),e("h3",Ae,t(k.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",ze,t(k.value?a.$t("game.needsPremium"):a.$t("game.noPreview")),1),e("p",Se,[e("strong",null,t(k.value?a.$t("game.premiumNeededForFullPlay"):a.$t("game.needSpotifyForAudio")),1)]),e("p",Be,t(a.$t("game.demoModeInstructions")),1)])),S.value&&!h.value?(n(),o("audio",{key:1,ref_key:"audioPlayer",ref:u,src:a.track.preview_url||void 0,onEnded:le,onTimeupdate:R,onLoadedmetadata:te,onLoadstart:se,onCanplay:ae,preload:"metadata"},t(a.$t("game.audioNotSupported")),41,Le)):g("",!0),l.value?(n(),o("div",De,[e("div",je,[e("button",{onClick:D,class:"control-btn",disabled:!l.value,title:"Restart"},c[3]||(c[3]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)]),8,Ve),e("button",{onClick:m,class:"play-btn",disabled:!l.value},[b.value?(n(),o("div",Ee)):v.value?(n(),o("svg",Fe,c[4]||(c[4]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(n(),o("svg",Ne,c[5]||(c[5]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))],8,Ie),e("button",{onClick:F,class:"control-btn",disabled:!l.value,title:"Mute/Unmute"},[y.value||_.value===0?(n(),o("svg",He,c[6]||(c[6]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM16 8.4A1 1 0 1117.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1),e("path",{d:"M18.293 6.293a1 1 0 011.414 1.414L17.414 10l2.293 2.293a1 1 0 01-1.414 1.414L16 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L14.586 10l-2.293-2.293a1 1 0 011.414-1.414L16 8.586l2.293-2.293z"},null,-1)]))):_.value<.5?(n(),o("svg",Oe,c[7]||(c[7]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a2 2 0 010 6 1 1 0 11-1.6-1.2V8.4z","clip-rule":"evenodd"},null,-1)]))):(n(),o("svg",Ue,c[8]||(c[8]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1)])))],8,Re)]),e("div",qe,[e("div",Ge,[e("span",Je,t(P(A.value)),1),e("div",Xe,[e("div",{class:"progress-track",onClick:c[0]||(c[0]=$=>p($))},[e("div",{class:"progress-fill",style:Q({width:d.value+"%"})},null,4),e("div",{class:"progress-handle",style:Q({left:d.value+"%"})},null,4)])]),e("span",Ke,t(P(z.value)),1)])]),e("div",Qe,[c[9]||(c[9]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793z","clip-rule":"evenodd"})],-1)),e("div",We,[e("input",{type:"range",min:"0",max:"1",step:"0.1",value:_.value,onInput:N,class:"volume-slider",disabled:!a.track.preview_url},null,40,Ye)]),e("span",Ze,t(Math.round(_.value*100))+"%",1)])])):g("",!0)]),a.showAnswer?(n(),o("div",et,[e("div",tt,[e("h4",st,t(a.track.name),1),e("p",at,t(L.value),1),e("p",lt,t(a.track.album.name)+" ("+t(a.track.year)+")",1),e("p",nt,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"underline hover:no-underline"},t(a.$t("game.openInSpotify"))+" ↗ ",9,ot)])])])):g("",!0)])]),a.showAnswer?g("",!0):(n(),o("div",rt,[e("p",it,t(a.$t("game.turn.placing")),1),e("p",ut,t(a.$t("game.dragToTimeline")),1)])),a.showResult?(n(),o("div",{key:1,class:B(["mt-4 p-4 rounded-lg text-center",s.value])},[e("p",ct,t(r.value),1),a.pointsEarned>0?(n(),o("p",dt,t(a.$t("game.turn.points",{points:a.pointsEarned})),1)):g("",!0)],2)):g("",!0)]))}}),mt={class:"flex items-center justify-between mb-4"},gt={class:"text-lg font-semibold flex items-center space-x-2"},pt={key:0,class:"text-green-500"},ft={class:"text-right"},ht={class:"text-2xl font-bold"},yt={class:"flex items-center space-x-2 text-sm text-gray-600"},kt={key:0,class:"mb-4"},bt={class:"text-sm font-medium text-gray-700 mb-2"},$t={class:"flex space-x-2"},_t=["title"],xt=["title"],wt={class:"mb-4"},Tt={class:"text-sm font-medium text-gray-700 mb-2"},Pt={key:0,class:"text-center py-8 text-gray-500"},Ct={class:"text-center text-gray-500"},Mt={key:1,class:"space-y-2"},At={class:"text-center text-gray-500 text-sm"},zt={class:"flex items-center space-x-3"},St={class:"w-12 h-12 rounded object-cover flex-shrink-0 relative"},Bt=["src","alt"],Lt={key:1,class:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center"},Dt={class:"flex-1 min-w-0"},jt={class:"font-medium truncate"},Vt={class:"text-sm text-gray-600 truncate"},It={class:"text-right flex-shrink-0"},Et={class:"font-bold text-lg"},Ft=["onDragover","onDragleave","onDrop"],Nt={class:"text-center text-gray-500 text-sm"},Rt={class:"text-center text-gray-500 text-sm"},Ht={class:"flex items-center space-x-3"},Ot={class:"flex-1 min-w-0"},Ut={class:"font-medium text-blue-800"},qt={class:"text-sm text-blue-600"},Gt={key:2,class:"mt-4 pt-4 border-t border-gray-200"},Jt={class:"flex justify-between text-sm text-gray-600"},Xt={key:0},Kt=G({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(E,{emit:j}){const i=E,M=j,u=w(!1),v=w([]),b=f(()=>{if(i.player.timeline.length<2)return null;const s=i.player.timeline.map(r=>r.year).sort((r,d)=>r-d);return`${s[0]} - ${s[s.length-1]}`});function T(s){var r,d,k,h;return((d=(r=s.images)==null?void 0:r[0])==null?void 0:d.url)||((h=(k=s.album.images)==null?void 0:k[0])==null?void 0:h.url)||"/placeholder-album.png"}function A(s){return s.artists.map(r=>r.name).join(", ")}function z(s){var d;if(!i.currentTrack)return;(d=s.dataTransfer)==null||d.setData("text/plain",JSON.stringify(i.currentTrack)),s.target.classList.add("dragging")}function _(s){s.target.classList.remove("dragging"),u.value=!1,v.value=[]}function y(s){!i.currentTrack||!i.canPlace||(u.value=!1,v.value=[],M("placeTrack",i.currentTrack,s))}function V(s){M("useToken",s)}function L(){v.value=new Array(i.player.timeline.length+1).fill(!1)}return Z(()=>i.player.timeline.length,()=>{L()},{immediate:!0}),(s,r)=>(n(),o("div",{class:B(["card",{"ring-2 ring-green-500":s.isCurrent}])},[e("div",mt,[e("h3",gt,[e("span",null,t(s.player.name),1),s.isCurrent?(n(),o("span",pt,"👑")):g("",!0)]),e("div",ft,[e("p",ht,t(s.player.score),1),e("div",yt,[r[11]||(r[11]=e("span",null,"🎵",-1)),e("span",null,t(s.$t("game.score.tokens",{count:s.player.tokens})),1)])])]),s.isCurrent&&s.canPlace&&s.player.tokens>0?(n(),o("div",kt,[e("h4",bt,t(s.$t("game.tokenAbilities")),1),e("div",$t,[e("button",{onClick:r[0]||(r[0]=d=>V("skip")),class:"btn btn-sm bg-yellow-100 hover:bg-yellow-200 text-yellow-800",title:s.$t("game.tokens.skip.description")}," ⏭️ "+t(s.$t("game.tokens.skip.label")),9,_t),e("button",{onClick:r[1]||(r[1]=d=>V("hint")),class:"btn btn-sm bg-blue-100 hover:bg-blue-200 text-blue-800",title:s.$t("game.tokens.hint.description")}," 💡 "+t(s.$t("game.tokens.hint.label")),9,xt)])])):g("",!0),e("div",wt,[e("h4",Tt,t(s.$t("game.timeline.title")),1),s.player.timeline.length===0?(n(),o("div",Pt,[e("p",null,t(s.$t("game.timeline.empty")),1),s.canPlace?(n(),o("div",{key:0,class:B(["timeline-slot mt-4",{"drag-over":u.value}]),onDragover:r[2]||(r[2]=x(d=>u.value=!0,["prevent"])),onDragleave:r[3]||(r[3]=x(d=>u.value=!1,["prevent"])),onDrop:r[4]||(r[4]=x(d=>y(0),["prevent"]))},[e("p",Ct,t(s.$t("game.timeline.placeHere")),1)],34)):g("",!0)])):(n(),o("div",Mt,[s.canPlace?(n(),o("div",{key:0,class:B(["timeline-slot h-16",{"drag-over":v.value[0]}]),onDragover:r[5]||(r[5]=x(d=>v.value[0]=!0,["prevent"])),onDragleave:r[6]||(r[6]=x(d=>v.value[0]=!1,["prevent"])),onDrop:r[7]||(r[7]=x(d=>y(0),["prevent"]))},[e("p",At,t(s.$t("game.placeEarlier")),1)],34)):g("",!0),(n(!0),o(O,null,U(s.player.timeline,(d,k)=>(n(),o("div",{key:d.id,class:"track-card"},[e("div",zt,[e("div",St,[d.revealed?(n(),o("img",{key:0,src:T(d),alt:d.name,class:"w-12 h-12 rounded object-cover"},null,8,Bt)):(n(),o("div",Lt,r[12]||(r[12]=[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",Dt,[e("p",jt,t(d.name),1),e("p",Vt,t(A(d)),1)]),e("div",It,[e("p",Et,t(d.year),1)])]),s.canPlace&&k<s.player.timeline.length-1?(n(),o("div",{key:0,class:B(["timeline-slot h-16 mt-2",{"drag-over":v.value[k+1]}]),onDragover:x(h=>v.value[k+1]=!0,["prevent"]),onDragleave:x(h=>v.value[k+1]=!1,["prevent"]),onDrop:x(h=>y(k+1),["prevent"])},[e("p",Nt,t(s.$t("game.placeBetween")),1)],42,Ft)):g("",!0)]))),128)),s.canPlace?(n(),o("div",{key:1,class:B(["timeline-slot h-16",{"drag-over":v.value[s.player.timeline.length]}]),onDragover:r[8]||(r[8]=x(d=>v.value[s.player.timeline.length]=!0,["prevent"])),onDragleave:r[9]||(r[9]=x(d=>v.value[s.player.timeline.length]=!1,["prevent"])),onDrop:r[10]||(r[10]=x(d=>y(s.player.timeline.length),["prevent"]))},[e("p",Rt,t(s.$t("game.placeLater")),1)],34)):g("",!0)]))]),s.canPlace&&s.currentTrack?(n(),o("div",{key:1,class:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg cursor-move",draggable:"true",onDragstart:z,onDragend:_},[e("div",Ht,[r[13]||(r[13]=e("div",{class:"w-12 h-12 rounded bg-blue-200 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",Ot,[e("p",Ut,t(s.$t("game.newTrack")),1),e("p",qt,t(s.$t("game.dragToPlace")),1)]),r[14]||(r[14]=e("div",{class:"text-blue-500"},[e("span",{class:"text-2xl"},"🎵")],-1))])],32)):g("",!0),s.player.timeline.length>0?(n(),o("div",Gt,[e("div",Jt,[e("span",null,t(s.$t("game.tracksInTimeline",{count:s.player.timeline.length})),1),b.value?(n(),o("span",Xt,t(b.value),1)):g("",!0)])])):g("",!0)],2))}}),Qt={class:"min-h-screen flex flex-col"},Wt={class:"bg-white/10 backdrop-blur-sm p-4"},Yt={class:"flex justify-between items-center"},Zt={class:"flex items-center space-x-4"},es={class:"text-white"},ts={class:"text-xl font-bold"},ss={class:"text-sm opacity-80"},as={class:"text-white text-right"},ls={class:"text-sm opacity-80"},ns={class:"flex-1 container mx-auto px-4 py-6"},os={key:0,class:"max-w-2xl mx-auto"},rs={class:"card text-center"},is={class:"text-2xl font-semibold mb-4"},us={class:"text-gray-600 mb-6"},cs={key:1,class:"space-y-6"},ds={class:"card text-center bg-green-50 border-green-200"},vs={class:"text-2xl font-bold text-green-800 mb-2"},ms={class:"text-green-700"},gs={key:0,class:"mt-4"},ps={key:1,class:"mt-4"},fs={class:"flex items-center justify-center space-x-2"},hs={key:0,class:"card bg-yellow-50 border-yellow-200"},ys={class:"flex items-center space-x-3"},ks={class:"flex-1"},bs={class:"text-lg font-semibold text-yellow-800"},$s={class:"text-yellow-700 text-sm"},_s={class:"flex space-x-2"},xs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ws={class:"card"},Ts={class:"text-lg font-semibold mb-4"},Ps={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Cs={class:"font-semibold"},Ms={class:"text-2xl font-bold text-green-600"},As={class:"text-sm text-gray-600"},zs={class:"text-xs text-gray-500"},Ss={key:2,class:"max-w-2xl mx-auto"},Bs={class:"card text-center"},Ls={class:"text-3xl font-bold mb-4 text-green-600"},Ds={class:"text-xl mb-6"},js={class:"mb-6"},Vs={class:"text-lg font-semibold mb-3"},Is={class:"space-y-2"},Es={class:"font-medium"},Fs={class:"font-bold"},Ns={class:"flex space-x-4 justify-center"},Hs=G({__name:"GameView",setup(E){const j=re(),i=oe(),M=w(!1),u=w(C.isAuthenticated()),v=f(()=>i.players),b=f(()=>i.currentPlayer),T=f(()=>i.currentTrack),A=f(()=>i.gamePhase),z=f(()=>i.round),_=f(()=>i.settings),y=f(()=>i.winner),V=f(()=>u.value),L=f(()=>[...v.value].sort((l,m)=>m.tokens!==l.tokens?m.tokens-l.tokens:m.score-l.score));async function s(){M.value=!0;try{await i.getNextTrack()||console.error("No tracks available")}catch(l){console.error("Error loading track:",l)}finally{M.value=!1}}function r(l,m){i.placeTrackOnTimeline(l,m),setTimeout(()=>{i.nextPlayer()},2e3)}function d(l){var D;if(!b.value)return;if(i.useToken(b.value.id,l))switch(l){case"skip":s();break;case"hint":alert(`Hint: This track was released in the ${Math.floor(((D=T.value)==null?void 0:D.year)/10)*10}s`);break}}function k(){i.resetGame(),j.push("/")}function h(){j.push("/")}function S(){const l=C.isAuthenticated(),m=localStorage.getItem("spotify_auth");console.log("Spotify auth check:",{isAuthenticated:l,authStateInStorage:m?JSON.parse(m):null,currentValue:u.value}),u.value=l,l&&C.initializePlayerIfReady()}return Y(()=>{i.gamePhase==="setup"&&i.players.length===0&&j.push("/"),S();const l=setInterval(()=>{S()},2e3);ee(()=>{clearInterval(l)})}),(l,m)=>{var D,I,F,N;return n(),o("div",Qt,[e("header",Wt,[e("div",Yt,[e("div",Zt,[e("button",{onClick:m[0]||(m[0]=p=>l.$router.push("/")),class:"btn btn-secondary"}," ← "+t(l.$t("common.back")),1),e("div",es,[e("h1",ts,t(l.$t("game.title")),1),e("p",ss,t(l.$t("game.round"))+" "+t(z.value),1)])]),e("div",as,[e("p",ls,t(l.$t("game.turn.currentPlayer",{player:(D=b.value)==null?void 0:D.name})),1)])])]),e("main",ns,[A.value==="setup"?(n(),o("div",os,[e("div",rs,[e("h2",is,t(l.$t("game.setupRequired")),1),e("p",us,t(l.$t("game.setupMessage")),1),e("button",{onClick:m[1]||(m[1]=p=>l.$router.push("/")),class:"btn btn-primary"},t(l.$t("game.backToSetup")),1)])])):A.value==="playing"?(n(),o("div",cs,[e("div",ds,[e("h2",vs,t(l.$t("game.turn.currentPlayer",{player:(I=b.value)==null?void 0:I.name})),1),e("p",ms,t(l.$t("game.turn.ready")),1),!T.value&&!M.value?(n(),o("div",gs,[e("button",{onClick:s,class:"btn btn-primary btn-lg"}," 🎵 "+t(l.$t("game.getTrack")),1)])):g("",!0),M.value?(n(),o("div",ps,[e("div",fs,[m[3]||(m[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,t(l.$t("common.loading")),1)])])):g("",!0)]),V.value?g("",!0):(n(),o("div",hs,[e("div",ys,[m[4]||(m[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ks,[e("h3",bs,t(l.$t("game.spotify.notConnected")),1),e("p",$s,t(l.$t("game.demoModeActive")),1)]),e("div",_s,[e("button",{onClick:h,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},t(l.$t("game.spotify.login")),1),e("button",{onClick:S,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),T.value?(n(),W(vt,{key:1,track:T.value,difficulty:_.value.difficulty,onPlaceTrack:r},null,8,["track","difficulty"])):g("",!0),e("div",xs,[(n(!0),o(O,null,U(v.value,p=>{var P,R;return n(),W(Kt,{key:p.id,player:p,"is-current":p.id===((P=b.value)==null?void 0:P.id),"current-track":T.value,"can-place":p.id===((R=b.value)==null?void 0:R.id)&&!!T.value,onPlaceTrack:r,onUseToken:d},null,8,["player","is-current","current-track","can-place"])}),128))]),e("div",ws,[e("h3",Ts,t(l.$t("game.score.title")),1),e("div",Ps,[(n(!0),o(O,null,U(v.value,p=>{var P;return n(),o("div",{key:p.id,class:B(["text-center p-3 rounded-lg",p.id===((P=b.value)==null?void 0:P.id)?"bg-green-100":"bg-gray-50"])},[e("p",Cs,t(p.name),1),e("p",Ms,t(p.tokens),1),e("p",As,t(l.$t("game.score.tokens",{count:p.tokens})),1),e("p",zs,t(l.$t("game.score.total",{score:p.score})),1)],2)}),128))])])])):A.value==="finished"?(n(),o("div",Ss,[e("div",Bs,[e("h2",Ls,t(l.$t("game.end.title")),1),e("p",Ds,t(l.$t("game.end.winner",{player:(F=y.value)==null?void 0:F.name,score:(N=y.value)==null?void 0:N.tokens})),1),e("div",js,[e("h3",Vs,t(l.$t("game.end.finalScores")),1),e("div",Is,[(n(!0),o(O,null,U(L.value,(p,P)=>(n(),o("div",{key:p.id,class:B(["flex justify-between items-center p-3 rounded-lg",P===0?"bg-yellow-100":"bg-gray-50"])},[e("span",Es,t(P+1)+". "+t(p.name),1),e("span",Fs,t(p.tokens)+" "+t(l.$t("game.score.tokens",{count:p.tokens})),1)],2))),128))])]),e("div",Ns,[e("button",{onClick:k,class:"btn btn-primary"}," 🔄 "+t(l.$t("game.end.playAgain")),1),e("button",{onClick:m[2]||(m[2]=p=>l.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+t(l.$t("game.backToHome")),1)])])])):g("",!0)])])}}});export{Hs as default};
