import{d as ce,n as pe,r as b,c as x,s as k,o as ie,a as ae,p as me,w as ve,b as n,e,g as p,q as ue,t as o,f as de,x as j,k as r,h as A,F as le,j as re,u as fe,l as be,y as he,z as ye}from"./index-x2DyAyEc.js";const ke={class:"card relative overflow-hidden border border-purple-500/20 shadow-2xl shadow-purple-500/10"},xe={class:"relative z-10 flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 p-4"},we={class:"flex-shrink-0"},$e={key:0,class:"relative group"},_e={key:1,class:"relative group"},Ce=["src","alt"],Te={class:"flex-1 text-center md:text-left"},Pe={class:"mb-3"},De={class:"text-gray-300 font-medium text-base bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Se={class:"text-xs text-gray-400 mt-1 font-light"},Ae={class:"mb-3"},Me={key:0,class:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 border border-amber-400/30 rounded-xl p-4 text-center backdrop-blur-sm mb-4"},Ee={class:"flex items-center justify-between mb-3"},Ie={class:"flex items-center"},je={class:"text-sm font-bold bg-gradient-to-r from-amber-300 to-orange-300 bg-clip-text text-transparent"},ze={class:"text-left space-y-2"},Be={class:"text-amber-200 text-xs font-medium"},Ne={class:"bg-amber-800/30 rounded-lg p-3 text-xs"},Ve={class:"text-amber-100 font-medium mb-2"},Re={class:"text-amber-200 space-y-1 list-decimal list-inside"},Le={class:"flex justify-center space-x-3 mt-4"},Oe=["disabled"],Fe={key:0,class:"flex items-center"},He={key:1},Ue={key:1,class:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Ge={class:"flex items-center justify-center mb-2"},qe={class:"text-sm font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent"},Qe={class:"text-green-200 text-xs"},Ye={key:2,class:"bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-400/30 rounded-xl p-4 text-center backdrop-blur-sm"},Je={class:"flex items-center justify-center mb-2"},Ke={class:"text-sm font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},We={class:"text-blue-200 text-xs"},Xe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/40 to-purple-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30 shadow-lg"},Ze={class:"flex items-center justify-center space-x-4 mb-3"},et=["disabled"],tt={class:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-xl shadow-purple-500/30 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/40"},st={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},ot={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},at={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},lt={key:0,class:"p-4 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-xl backdrop-blur-sm"},rt={class:"text-center"},nt={class:"text-lg font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-1"},it={class:"text-blue-200 text-sm font-medium mb-1"},ut={class:"text-blue-300 text-sm font-medium"},dt={class:"text-sm text-blue-400 mt-3"},ct=["href"],vt={key:0,class:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-xl backdrop-blur-sm"},gt={class:"text-center"},mt={class:"flex items-center justify-center mb-2"},pt={class:"font-bold text-sm bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},ft={class:"text-purple-200 text-xs font-medium"},bt={class:"flex items-center justify-center mb-2"},ht={key:0,class:"w-8 h-8 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-2 animate-bounce"},yt={key:1,class:"w-8 h-8 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},kt={class:"font-bold text-lg"},xt={key:0,class:"text-sm mt-1 font-semibold"},wt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},$t=ce({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(W,{emit:Y}){const u=W,{t:I}=pe(),f=b(!1),w=b(!1);b(!1);const h=b(0),P=b(0);b(.7),b(!1),b(!1),b(!1);const g=b(null),$=b(!1),z=x(()=>{var M,D,S,q;const a=(D=(M=u.track.images)==null?void 0:M[0])==null?void 0:D.url,c=(q=(S=u.track.album.images)==null?void 0:S[0])==null?void 0:q.url;return a||c||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),L=x(()=>u.track.artists.map(a=>a.name).join(", ")),C=x(()=>u.showResult?u.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),i=x(()=>u.showResult?u.isCorrect?I("game.turn.correct",{year:u.track.year}):I("game.turn.incorrect",{year:u.track.year}):"");x(()=>P.value===0?0:h.value/P.value*100);const B=x(()=>!!u.track.uri),G=x(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),N=x(()=>G.value?B.value&&k.isAuthenticated():B.value&&k.isPlayerReady()),O=x(()=>N.value);async function F(){w.value=!0,g.value=null,$.value=!1;try{if(!await k.ensurePlaybackReady())throw new Error("NO_DEVICES_AVAILABLE");N.value&&u.track.uri&&(f.value?await k.pausePlayback()&&(f.value=!1):await k.startPlayback(u.track.uri)&&(f.value=!0,G.value?J():Z()))}catch(a){console.error("Playback error:",a),a.message==="NO_DEVICES_AVAILABLE"?(g.value="NO_DEVICES",$.value=!0):a.message==="DEVICE_NOT_FOUND"||a.message==="DEVICE_BECAME_INACTIVE"?(g.value="DEVICE_INACTIVE",$.value=!0):a.message==="PREMIUM_REQUIRED"?g.value="PREMIUM_REQUIRED":a.message==="DEVICE_ACTIVATION_FAILED"?(g.value="ACTIVATION_FAILED",$.value=!0):a.message.includes("No active Spotify device")||a.message.includes("No Spotify devices available")?(g.value="DEVICE_INACTIVE",$.value=!0):g.value="PLAYBACK_FAILED"}finally{w.value=!1}}function X(){$.value=!1,g.value=null}async function te(){$.value=!1,g.value=null,await F()}function J(){const a=async()=>{var M;if(!N.value||!G.value)return;await k.keepSpotifyConnectActive();const c=await k.getSpotifyConnectState();if(c){const D=((M=c.item)==null?void 0:M.uri)===u.track.uri,S=c.is_playing&&D;f.value!==S&&(f.value=S),f.value&&setTimeout(a,5e3)}else f.value&&(console.log("🔇 No active playback detected - device may have become inactive"),f.value=!1,!$.value&&!g.value&&await k.hasAvailableDevices()&&(g.value="DEVICE_INACTIVE",$.value=!0))};a()}function Z(){const a=async()=>{if(!N.value)return;const c=await k.getPlaybackState();c&&(f.value=!c.paused,h.value=c.position/1e3,P.value=c.duration/1e3,f.value&&setTimeout(a,1e3))};a()}async function V(){var a,c,M,D;if(k.isPlayerReady())try{const S=await k.getPlaybackState();if(S){const q=((c=(a=S.track_window)==null?void 0:a.current_track)==null?void 0:c.uri)===u.track.uri,Q=S.paused===!1&&q;console.log("Playback state check:",{paused:S.paused,currentTrackUri:(D=(M=S.track_window)==null?void 0:M.current_track)==null?void 0:D.uri,expectedUri:u.track.uri,isCurrentTrack:q,isActuallyPlaying:Q,componentIsPlaying:f.value}),f.value!==Q&&(console.log(`🔄 Syncing playback state: ${f.value} → ${Q}`),f.value=Q)}}catch(S){console.warn("Could not check playback state:",S)}}return ie(()=>{const a=setInterval(V,2e3);ae(()=>{clearInterval(a)})}),ie(()=>{k.isAuthenticated()&&me(()=>{k.initializePlayerIfReady()})}),ve(()=>u.track,async(a,c)=>{if(a&&a!==c){console.log("New track detected:",a.name),g.value=null,$.value=!1,await me(),f.value=!1;const M=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:O.value,canPlayFullTrack:N.value,hasSpotifyUri:B.value,isPlayerReady:k.isPlayerReady(),isPlaying:f.value}),O.value&&!f.value){console.log("Auto-starting playback for new track:",a.name);try{await k.ensurePlaybackReady()?(await F(),console.log("✅ Auto-playback started successfully")):console.log("🔇 Auto-playback skipped - no devices available")}catch(D){M?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",D)}}else{const D=O.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${D}`),!M&&B.value&&console.log("Has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),ae(()=>{N.value&&k.stopPlayback()}),(a,c)=>(r(),n("div",ke,[c[13]||(c[13]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",xe,[e("div",we,[a.showAnswer?(r(),n("div",_e,[e("img",{src:z.value,alt:a.track.name,class:"w-24 h-24 rounded-xl shadow-xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,Ce),c[1]||(c[1]=e("div",{class:"absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(r(),n("div",$e,c[0]||(c[0]=[ue('<div class="w-24 h-24 rounded-xl shadow-xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-03b041d1><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-900 to-gray-800 shadow-inner flex items-center justify-center" data-v-03b041d1><div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-03b041d1><svg class="w-6 h-6 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-03b041d1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-03b041d1></path></svg></div></div></div><div class="absolute inset-0 w-24 h-24 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-03b041d1></div>',2)])))]),e("div",Te,[e("div",Pe,[e("p",De,o(a.$t("game.turn.listening")),1),e("p",Se,o(a.$t("game.turn.placeOnTimeline")),1)]),e("div",Ae,[$.value?(r(),n("div",Me,[e("div",Ee,[e("div",Ie,[c[2]||(c[2]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("h3",je,o(g.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.title","No Spotify App Found"):g.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.title","Spotify App Inactive"):g.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.title","Device Activation Failed"):a.$t("game.deviceHelp.generic.title","Playback Issue")),1)]),e("button",{onClick:X,class:"text-amber-300 hover:text-amber-100 transition-colors"},c[3]||(c[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ze,[e("p",Be,o(g.value==="NO_DEVICES"?a.$t("game.deviceHelp.noDevices.message","No Spotify devices detected."):g.value==="DEVICE_INACTIVE"?a.$t("game.deviceHelp.inactive.message","Your Spotify app became inactive after being idle."):g.value==="ACTIVATION_FAILED"?a.$t("game.deviceHelp.activationFailed.message","Could not activate your Spotify device."):a.$t("game.deviceHelp.generic.message","There was a problem with playback.")),1),e("div",Ne,[e("p",Ve,o(a.$t("game.deviceHelp.steps.title","Quick Fix:")),1),e("ol",Re,[e("li",null,o(a.$t("game.deviceHelp.steps.step1","Open the Spotify app on your device")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step2","Play any song (you can pause it right away)")),1),e("li",null,o(a.$t("game.deviceHelp.steps.step3","Come back to this game and try again")),1)])]),e("div",Le,[e("button",{onClick:te,disabled:w.value,class:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-amber-600 hover:to-orange-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(r(),n("span",Fe,[c[4]||(c[4]=e("svg",{class:"w-3 h-3 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),de(" "+o(a.$t("game.deviceHelp.retrying","Retrying...")),1)])):(r(),n("span",He,o(a.$t("game.deviceHelp.retry","Try Again")),1))],8,Oe),e("button",{onClick:X,class:"px-4 py-2 bg-gray-600 text-white rounded-lg text-xs font-medium hover:bg-gray-700 transition-colors"},o(a.$t("game.deviceHelp.dismiss","Dismiss")),1)])])])):p("",!0),!O.value&&G.value&&B.value?(r(),n("div",Ue,[e("div",Ge,[c[5]||(c[5]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})])],-1)),e("h3",qe,o(a.$t("game.spotifyConnect.title","Spotify Connect")),1)]),e("p",Qe,o(a.$t("game.spotifyConnect.description","Music will play through your Spotify app")),1)])):N.value?p("",!0):(r(),n("div",Ye,[e("div",Je,[c[6]||(c[6]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-2 shadow-lg"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ke,o(B.value?a.$t("game.premiumRequired"):a.$t("game.demoMode")),1)]),e("p",We,o(B.value?a.$t("game.needsPremium"):a.$t("game.needSpotifyForAudio")),1)])),O.value?(r(),n("div",Xe,[e("div",Ze,[e("button",{onClick:F,class:"play-btn group relative",disabled:!O.value},[e("div",tt,[w.value?(r(),n("div",st)):f.value?(r(),n("svg",ot,c[7]||(c[7]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(r(),n("svg",at,c[8]||(c[8]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,et)])])):p("",!0)]),a.showAnswer?(r(),n("div",lt,[e("div",rt,[e("h4",nt,o(a.track.name),1),e("p",it,o(L.value),1),e("p",ut,o(a.track.album.name)+" ("+o(a.track.year)+")",1),e("p",dt,[e("a",{href:a.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-1 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25 text-xs"},[c[9]||(c[9]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),de(" "+o(a.$t("game.openInSpotify")),1)],8,ct)])])])):p("",!0)])]),a.showAnswer?p("",!0):(r(),n("div",vt,[e("div",gt,[e("div",mt,[c[10]||(c[10]=e("div",{class:"w-6 h-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 animate-pulse"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",pt,o(a.$t("game.turn.placing")),1)]),e("p",ft,o(G.value?a.$t("game.timeline.mobileInstructions"):a.$t("game.dragToTimeline")),1)])])),a.showResult?(r(),n("div",{key:1,class:j(["mt-3 p-4 rounded-xl text-center backdrop-blur-sm",C.value])},[e("div",bt,[a.isCorrect?(r(),n("div",ht,c[11]||(c[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(r(),n("div",yt,c[12]||(c[12]=[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",kt,o(i.value),1)]),a.pointsEarned>0?(r(),n("p",xt,[e("span",wt,o(a.$t("game.turn.points",{points:a.pointsEarned})),1)])):p("",!0)],2)):p("",!0)]))}}),_t=(W,Y)=>{const u=W.__vccOpts||W;for(const[I,f]of Y)u[I]=f;return u},Ct=_t($t,[["__scopeId","data-v-03b041d1"]]),Tt={key:0,class:"absolute inset-0 opacity-10"},Pt={class:"relative z-10"},Dt={class:"flex items-center justify-between mb-6"},St={class:"text-xl font-bold flex items-center space-x-3"},At={key:0,class:"text-2xl animate-bounce"},Mt={class:"text-right"},Et={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},It={class:"flex items-center space-x-2 text-sm text-gray-300"},jt={class:"font-medium"},zt={key:0,class:"mb-6"},Bt={class:"text-sm font-medium text-gray-300 mb-3"},Nt={class:"flex space-x-3"},Vt=["title"],Rt={class:"flex items-center space-x-2"},Lt=["title"],Ot={class:"flex items-center space-x-2"},Ft={class:"mb-6"},Ht={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Ut={key:0,class:"text-center py-12 text-gray-400"},Gt={class:"text-lg font-medium mb-2"},qt={class:"text-center text-gray-300 font-medium"},Qt={key:1,class:"space-y-3"},Yt={class:"text-center text-gray-400 text-sm font-medium"},Jt={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},Kt={class:"flex items-center space-x-4"},Wt={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},Xt=["src","alt"],Zt={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},es={class:"flex-1 min-w-0"},ts={class:"font-bold text-lg text-gray-100 truncate"},ss={class:"text-sm text-gray-300 truncate font-medium"},os={class:"text-right flex-shrink-0"},as={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},ls=["onDragover","onDragleave","onDrop","onTouchstart","onClick","data-drop-zone"],rs={class:"text-center text-gray-400 text-sm font-medium"},ns=["data-drop-zone"],is={class:"text-center text-gray-400 text-sm font-medium"},us=["draggable"],ds={class:"flex items-center space-x-4"},cs={class:"flex-1 min-w-0"},vs={class:"font-bold text-lg text-blue-200"},gs={class:"text-sm text-blue-300 font-medium"},ms={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},ps={class:"flex justify-between text-sm text-gray-300"},fs={class:"font-medium"},bs={key:0,class:"font-mono"},hs={key:0,class:"absolute top-2 right-2 bg-red-500 text-white text-xs p-1 rounded z-50"},ys={class:"relative z-10"},ks={class:"flex items-center space-x-3 mb-4"},xs={class:"text-xl font-bold bg-gradient-to-r from-green-300 to-blue-300 bg-clip-text text-transparent"},ws={class:"mb-6"},$s={class:"text-gray-200 text-lg leading-relaxed"},_s={key:0,class:"mb-4 p-2 bg-yellow-900/50 rounded text-xs text-yellow-200"},Cs={key:0,class:"mt-2 p-2 bg-black/30 rounded max-h-32 overflow-y-auto"},Ts={class:"flex space-x-3"},Ps={class:"mt-4 text-center"},Ds=ce({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(W,{emit:Y}){const u=W,I=Y,f=b(!1),w=b([]),h=b(null),P=b(!1),g=b({isPressed:!1,action:""}),$=b(!1),z=b(""),L=b([]),C=b(0),i=x(()=>"ontouchstart"in window||navigator.maxTouchPoints>0),B=x(()=>"ontouchstart"in window),G=x(()=>navigator.maxTouchPoints||0),N=x(()=>{var m;const t=((m=u.player)==null?void 0:m.timeline)||[];if(t.length<2)return null;const s=t.map(R=>R.year).sort((R,_)=>R-_);return`${s[0]} - ${s[s.length-1]}`});function O(t){var s,m;return t.images&&t.images.length>0&&((s=t.images[0])!=null&&s.url)?t.images[0].url:t.album&&t.album.images&&t.album.images.length>0&&((m=t.album.images[0])!=null&&m.url)?t.album.images[0].url:"/placeholder-album.png"}function F(t){return t.artists.map(s=>s.name).join(", ")}function X(t){var m;if(!u.currentTrack)return;(m=t.dataTransfer)==null||m.setData("text/plain",JSON.stringify(u.currentTrack)),t.target.classList.add("dragging")}function te(t){t.target.classList.remove("dragging"),f.value=!1,w.value=[]}function J(t){!u.currentTrack||!u.canPlace||(f.value=!1,w.value=[],I("placeTrack",u.currentTrack,t))}function Z(t){I("useToken",t)}function V(t){!u.currentTrack||!u.canPlace||(h.value=t,P.value=!0,"vibrate"in navigator&&navigator.vibrate(50))}function a(t){var R;if(t===null)return"";const s=((R=u.player)==null?void 0:R.timeline)||[],m=s.length;return t===0?m===0?"Place as your first track":`Place before ${s[0].name} (${s[0].year})`:t===m?`Place after ${s[m-1].name} (${s[m-1].year})`:`Place between ${s[t-1].name} (${s[t-1].year}) and ${s[t].name} (${s[t].year})`}function c(){h.value=null,P.value=!1}function M(){h.value!==null&&u.currentTrack&&(I("placeTrack",u.currentTrack,h.value),h.value=null,P.value=!1)}function D(){"vibrate"in navigator&&navigator.vibrate(50)}function S(){var s;const t=((s=u.player)==null?void 0:s.timeline)||[];w.value=new Array(t.length+1).fill(!1)}ae(()=>{}),ve(()=>{var t;return(((t=u.player)==null?void 0:t.timeline)||[]).length},()=>{S()},{immediate:!0});function q(){}function Q(t){console.log("Touch cancelled");const s=t.target;s.style.transform="",s.style.opacity="",g.value={isPressed:!1,action:""}}function ne(t){console.log("performCancel called"),d("performCancel called"),t&&(t.preventDefault(),t.stopPropagation()),"vibrate"in navigator&&navigator.vibrate(50),h.value=null,P.value=!1,d("Dialog closed via cancel")}function ee(t){console.log("performConfirm called"),d("performConfirm called"),t&&(t.preventDefault(),t.stopPropagation()),"vibrate"in navigator&&navigator.vibrate(100),h.value!==null&&u.currentTrack?(I("placeTrack",u.currentTrack,h.value),h.value=null,P.value=!1,d("Track placed successfully")):d("Cannot confirm - missing track or position")}function se(){$.value=!$.value,z.value=`Debug toggled: ${$.value}`}function l(){z.value=`Test clicked at ${new Date().toLocaleTimeString()}`,console.log("Test debug function called"),"vibrate"in navigator&&navigator.vibrate([50,100,50])}function d(t){const m=`${new Date().toLocaleTimeString()}: ${t}`;L.value.unshift(m),L.value.length>10&&(L.value=L.value.slice(0,10)),z.value=m,console.log(`[MOBILE DEBUG] ${m}`)}function T(t,s){C.value++,d(`TouchStart ${t} (#${C.value})`),s.preventDefault(),s.stopPropagation(),g.value={isPressed:!0,action:t};const m=s.target;m.style.transform="scale(0.95)",m.style.opacity="0.8",m.style.backgroundColor=t==="cancel"?"#ef4444":"#10b981"}function E(t,s){d(`TouchEnd ${t} (#${C.value})`),s.preventDefault(),s.stopPropagation();const m=s.target;m.style.transform="",m.style.opacity="",m.style.backgroundColor="",g.value.isPressed&&g.value.action===t?(d(`Executing ${t} action`),"vibrate"in navigator&&navigator.vibrate(t==="cancel"?50:100),g.value={isPressed:!1,action:""},t==="cancel"?(d("Calling cancelSelection"),c()):t==="confirm"&&(d("Calling confirmPlacement"),M())):d(`TouchEnd ignored - state mismatch: ${JSON.stringify(g.value)}`)}function H(t,s){d(`MouseDown ${t}`),s.preventDefault(),s.stopPropagation()}function U(t,s){d(`MouseUp ${t}`),s.preventDefault(),s.stopPropagation()}return(t,s)=>{var m,R,_,K;return r(),n("div",{class:j(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":t.isCurrent}])},[t.isCurrent?(r(),n("div",Tt,s[29]||(s[29]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):p("",!0),e("div",Pt,[e("div",Dt,[e("h3",St,[e("span",{class:j(t.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},o(t.player.name),3),t.isCurrent?(r(),n("span",At,"👑")):p("",!0)]),e("div",Mt,[e("p",Et,o(t.player.score),1),e("div",It,[s[30]||(s[30]=e("span",{class:"text-lg"},"🎵",-1)),e("span",jt,o(t.$t("game.score.tokens",{count:t.player.tokens})),1)])])]),t.isCurrent&&t.canPlace&&t.player.tokens>0?(r(),n("div",zt,[e("h4",Bt,o(t.$t("game.tokenAbilities")),1),e("div",Nt,[e("button",{onClick:s[0]||(s[0]=v=>Z("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:t.$t("game.tokens.skip.description")},[e("div",Rt,[s[31]||(s[31]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,o(t.$t("game.tokens.skip.label")),1)])],8,Vt),e("button",{onClick:s[1]||(s[1]=v=>Z("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:t.$t("game.tokens.hint.description")},[e("div",Ot,[s[32]||(s[32]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,o(t.$t("game.tokens.hint.label")),1)])],8,Lt)])])):p("",!0),e("div",Ft,[e("h4",Ht,[s[33]||(s[33]=e("span",{class:"mr-2"},"🎵",-1)),de(" "+o(t.$t("game.timeline.title")),1)]),!t.player.timeline||t.player.timeline.length===0?(r(),n("div",Ut,[s[34]||(s[34]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Gt,o(t.$t("game.timeline.empty")),1),t.canPlace?(r(),n("div",{key:0,class:j(["timeline-slot mt-6 group",{"drag-over":!i.value&&f.value,selected:h.value===0&&i.value}]),onDragover:s[2]||(s[2]=A(v=>i.value?null:f.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=A(v=>i.value?null:f.value=!1,["prevent"])),onDrop:s[4]||(s[4]=A(v=>i.value?null:J(0),["prevent"])),onTouchstart:s[5]||(s[5]=A(v=>i.value?V(0):null,["prevent"])),onClick:s[6]||(s[6]=v=>i.value?V(0):null),"data-drop-zone":0},[e("div",{class:j(["p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm",{"border-green-400 bg-green-500/20":h.value===0&&i.value}])},[e("p",qt,o(i.value?t.$t("game.timeline.tapToSelect"):t.$t("game.timeline.placeHere")),1)],2)],34)):p("",!0)])):t.player.timeline&&t.player.timeline.length>0?(r(),n("div",Qt,[t.canPlace?(r(),n("div",{key:0,class:j(["timeline-slot h-20 group",{"drag-over":!i.value&&w.value[0],selected:h.value===0&&i.value}]),onDragover:s[7]||(s[7]=A(v=>i.value?null:w.value[0]=!0,["prevent"])),onDragleave:s[8]||(s[8]=A(v=>i.value?null:w.value[0]=!1,["prevent"])),onDrop:s[9]||(s[9]=A(v=>i.value?null:J(0),["prevent"])),onTouchstart:s[10]||(s[10]=A(v=>i.value?V(0):null,["prevent"])),onClick:s[11]||(s[11]=v=>i.value?V(0):null),"data-drop-zone":0},[e("div",{class:j(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":h.value===0&&i.value}])},[e("p",Yt,o(i.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeEarlier")),1)],2)],34)):p("",!0),(r(!0),n(le,null,re(t.player.timeline||[],(v,y)=>{var ge;return r(),n("div",{key:v.id,class:"track-card group relative"},[e("div",Jt,[e("div",Kt,[e("div",Wt,[v.revealed?(r(),n("img",{key:0,src:O(v),alt:v.name,class:"w-16 h-16 object-cover"},null,8,Xt)):(r(),n("div",Zt,s[35]||(s[35]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",es,[e("p",ts,o(v.name),1),e("p",ss,o(F(v)),1)]),e("div",os,[e("p",as,o(v.year),1)])])]),t.canPlace&&y<(((ge=t.player.timeline)==null?void 0:ge.length)||0)-1?(r(),n("div",{key:0,class:j(["timeline-slot h-20 mt-3 group",{"drag-over":w.value[y+1],selected:h.value===y+1&&i.value}]),onDragover:A(oe=>w.value[y+1]=!0,["prevent"]),onDragleave:A(oe=>w.value[y+1]=!1,["prevent"]),onDrop:A(oe=>J(y+1),["prevent"]),onTouchstart:A(oe=>i.value?V(y+1):null,["prevent"]),onClick:oe=>i.value?V(y+1):null,"data-drop-zone":y+1},[e("div",{class:j(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":h.value===y+1&&i.value}])},[e("p",rs,o(i.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeBetween")),1)],2)],42,ls)):p("",!0)])}),128)),t.canPlace?(r(),n("div",{key:1,class:j(["timeline-slot h-20 group",{"drag-over":!i.value&&w.value[((m=t.player.timeline)==null?void 0:m.length)||0],selected:h.value===(((R=t.player.timeline)==null?void 0:R.length)||0)&&i.value}]),onDragover:s[12]||(s[12]=A(v=>{var y;return i.value?null:w.value[((y=t.player.timeline)==null?void 0:y.length)||0]=!0},["prevent"])),onDragleave:s[13]||(s[13]=A(v=>{var y;return i.value?null:w.value[((y=t.player.timeline)==null?void 0:y.length)||0]=!1},["prevent"])),onDrop:s[14]||(s[14]=A(v=>{var y;return i.value?null:J(((y=t.player.timeline)==null?void 0:y.length)||0)},["prevent"])),onTouchstart:s[15]||(s[15]=A(v=>{var y;return i.value?V(((y=t.player.timeline)==null?void 0:y.length)||0):null},["prevent"])),onClick:s[16]||(s[16]=v=>{var y;return i.value?V(((y=t.player.timeline)==null?void 0:y.length)||0):null}),"data-drop-zone":((_=t.player.timeline)==null?void 0:_.length)||0},[e("div",{class:j(["h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center",{"border-green-400 bg-green-500/20":h.value===(((K=t.player.timeline)==null?void 0:K.length)||0)&&i.value}])},[e("p",is,o(i.value?t.$t("game.timeline.tapToSelect"):t.$t("game.placeLater")),1)],2)],42,ns)):p("",!0)])):p("",!0)]),t.canPlace&&t.currentTrack?(r(),n("div",{key:1,class:j(["timeline-container p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",i.value?"cursor-pointer":"cursor-move"]),draggable:!i.value,onDragstart:s[17]||(s[17]=v=>i.value?null:X),onDragend:s[18]||(s[18]=v=>i.value?null:te),onClick:s[19]||(s[19]=v=>i.value?D:null)},[e("div",ds,[s[36]||(s[36]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",cs,[e("p",vs,o(t.$t("game.newTrack")),1),e("p",gs,o(i.value?t.$t("game.tapToPlace"):t.$t("game.dragToPlace")),1)]),s[37]||(s[37]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],42,us)):p("",!0),t.player.timeline&&t.player.timeline.length>0?(r(),n("div",ms,[e("div",ps,[e("span",fs,o(t.$t("game.tracksInTimeline",{count:t.player.timeline.length})),1),N.value?(r(),n("span",bs,o(N.value),1)):p("",!0)])])):p("",!0)]),P.value&&i.value?(r(),n("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:q},[e("div",{class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-6 max-w-sm w-full mx-auto relative overflow-hidden",onClick:s[28]||(s[28]=A(()=>{},["stop"]))},[$.value?(r(),n("div",hs," DEBUG: "+o(z.value),1)):p("",!0),s[40]||(s[40]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",ys,[e("div",ks,[s[38]||(s[38]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-xl"},"📍")],-1)),e("h3",xs,o(t.$t("game.timeline.selectedPosition")),1)]),e("div",ws,[e("p",$s,o(a(h.value)),1)]),$.value?(r(),n("div",_s,[e("p",null,"Mobile Device: "+o(i.value),1),e("p",null,"Selected Position: "+o(h.value),1),e("p",null,"Show Confirmation: "+o(P.value),1),e("p",null,"Current Track: "+o(!!t.currentTrack),1),e("p",null,"Touch Events Supported: "+o(B.value),1),e("p",null,"Max Touch Points: "+o(G.value),1),e("button",{onClick:l,class:"bg-red-500 text-white px-2 py-1 rounded mt-1"},"Test Debug"),L.value.length>0?(r(),n("div",Cs,[s[39]||(s[39]=e("p",{class:"font-bold mb-1"},"Event Log:",-1)),(r(!0),n(le,null,re(L.value.slice(0,5),(v,y)=>(r(),n("div",{key:y,class:"text-xs"},o(v),1))),128))])):p("",!0)])):p("",!0),e("div",Ts,[e("div",{ref:"cancelButton",onClick:ne,onTouchstart:s[20]||(s[20]=v=>T("cancel",v)),onTouchend:s[21]||(s[21]=v=>E("cancel",v)),onTouchcancel:Q,onMousedown:s[22]||(s[22]=v=>H("cancel",v)),onMouseup:s[23]||(s[23]=v=>U("cancel",v)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 active:from-gray-500 active:to-gray-600 text-white font-medium rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg select-none cursor-pointer",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},o(t.$t("game.timeline.cancelSelection")),545),e("div",{ref:"confirmButton",onClick:ee,onTouchstart:s[24]||(s[24]=v=>T("confirm",v)),onTouchend:s[25]||(s[25]=v=>E("confirm",v)),onTouchcancel:Q,onMousedown:s[26]||(s[26]=v=>H("confirm",v)),onMouseup:s[27]||(s[27]=v=>U("confirm",v)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-500 hover:to-blue-500 active:from-green-500 active:to-blue-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-green-500/25 select-none cursor-pointer",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","-webkit-user-select":"none","user-select":"none"}},o(t.$t("game.timeline.confirmPlacement")),545)]),e("div",Ps,[e("button",{onClick:se,class:"text-xs text-gray-400 hover:text-gray-200 underline"},o($.value?"Hide Debug":"Show Debug"),1)])])])])):p("",!0)],2)}}}),Ss={class:"min-h-screen flex flex-col"},As={class:"bg-white/10 backdrop-blur-sm p-4"},Ms={class:"flex justify-between items-center"},Es={class:"flex items-center space-x-4"},Is={class:"text-white"},js={class:"text-xl font-bold"},zs={class:"flex items-center space-x-3 text-sm opacity-80"},Bs={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 text-purple-200 font-medium"},Ns={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 text-gray-200 font-medium"},Vs={class:"text-white text-right"},Rs={class:"text-sm opacity-80"},Ls={class:"flex-1 container mx-auto px-4 py-6"},Os={key:0,class:"max-w-2xl mx-auto"},Fs={class:"card text-center"},Hs={class:"text-2xl font-semibold mb-4"},Us={class:"text-gray-600 mb-6"},Gs={key:1,class:"space-y-6"},qs={class:"card text-center bg-green-50 border-green-200"},Qs={class:"text-2xl font-bold text-white mb-2"},Ys={class:"text-white"},Js={key:0,class:"mt-4"},Ks={key:1,class:"mt-4"},Ws={class:"flex items-center justify-center space-x-2"},Xs={key:0,class:"card bg-yellow-50 border-yellow-200"},Zs={class:"flex items-center space-x-3"},eo={class:"flex-1"},to={class:"text-lg font-semibold text-yellow-800"},so={class:"text-yellow-700 text-sm"},oo={class:"flex space-x-2"},ao={key:1,class:"card bg-orange-50 border-orange-200"},lo={key:2,class:"card bg-blue-50 border-blue-200"},ro={key:4,class:"text-center mb-6"},no={class:"card bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 backdrop-blur-sm"},io={class:"mb-4"},uo={class:"flex items-center justify-center mb-3"},co={class:"text-center"},vo={class:"text-2xl font-bold text-red-200 mb-2"},go={class:"text-red-100"},mo={class:"text-lg font-semibold"},po={class:"text-base"},fo={class:"text-sm opacity-90"},bo={class:"text-red-200 text-lg mb-4"},ho={class:"text-red-300 text-sm"},yo={key:5,class:"max-w-4xl mx-auto"},ko={class:"card"},xo={class:"text-lg font-semibold mb-4 text-gray-100"},wo={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},$o={class:"font-semibold text-gray-800"},_o={class:"text-2xl font-bold text-gray-900"},Co={class:"text-sm text-gray-600"},To={class:"text-xs text-gray-500"},Po={key:2,class:"max-w-2xl mx-auto"},Do={class:"card text-center"},So={class:"text-3xl font-bold mb-4 text-white"},Ao={class:"text-xl mb-6"},Mo={class:"mb-6"},Eo={class:"text-lg font-semibold mb-3"},Io={class:"space-y-2"},jo={class:"font-medium"},zo={class:"font-bold"},Bo={class:"flex space-x-4 justify-center"},No={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Vo={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Ro={class:"relative z-10"},Lo={class:"flex items-center space-x-3 mb-6"},Oo={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Fo={class:"mb-8"},Ho={class:"text-gray-200 text-lg leading-relaxed"},Uo={class:"flex justify-center"},qo=ce({__name:"GameView",setup(W){const Y=be(),u=fe(),I=b(!1),f=b(!1),w=b(""),h=b(k.isAuthenticated()),P=b(!1),g=b(!1),$=b(!1),z=b({isCorrect:!1,pointsEarned:0}),L=x(()=>u.players),C=x(()=>u.currentPlayer),i=x(()=>u.currentTrack),B=x(()=>u.gamePhase),G=x(()=>u.round),N=x(()=>u.settings),O=x(()=>u.winner),F=x(()=>h.value),X=x(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|CriOS/i.test(navigator.userAgent)),te=x(()=>F.value?!k.isPlayerReady()&&Z.value>3e4:!1),J=b(Date.now()),Z=x(()=>Date.now()-J.value),V=x(()=>[...L.value].sort((l,d)=>{var H,U;const T=((H=l.timeline)==null?void 0:H.length)||0,E=((U=d.timeline)==null?void 0:U.length)||0;return E!==T?E-T:d.tokens!==l.tokens?d.tokens-l.tokens:d.score-l.score}));async function a(){var l;I.value=!0,P.value=!1,g.value=!1,z.value={isCorrect:!1,pointsEarned:0};try{console.log("Loading next track...");const d=await u.getNextTrack();d?console.log("Track loaded successfully:",d.name,"by",(l=d.artists[0])==null?void 0:l.name):console.error("No tracks available")}catch(d){console.error("Error loading track:",d)}finally{I.value=!1}}function c(l,d){const T=u.placeTrackOnTimeline(l,d);let E=0;T&&C.value&&(E=1,C.value.timeline.length>=5&&(E=2),C.value.timeline.length>=8&&(E=3)),z.value={isCorrect:T,pointsEarned:E},P.value=!0,setTimeout(()=>{g.value=!0},500),T?setTimeout(()=>{P.value=!1,g.value=!1,u.nextPlayer()},4e3):setTimeout(()=>{if($.value=!0,C.value&&i.value){const H=M(i.value,C.value.timeline),U={...i.value,revealed:!0};u.addTrackToTimelineAtPosition(U,H)}},1500)}function M(l,d){for(let T=0;T<d.length;T++)if(l.year<=d[T].year)return T;return d.length}function D(){i.value&&C.value&&u.removeTrackFromTimeline(i.value.id),P.value=!1,g.value=!1,$.value=!1,u.nextPlayer()}function S(l){var T;if(!C.value)return;if(u.useToken(C.value.id,l))switch(l){case"skip":a();break;case"hint":const E=Math.floor(((T=i.value)==null?void 0:T.year)/10)*10;w.value=`This track was released in the ${E}s`,f.value=!0;break}}function q(){f.value=!1,w.value=""}function Q(){u.resetGame(),Y.push("/")}function ne(){Y.push("/")}function ee(){const l=k.isAuthenticated();console.log("Spotify auth check in GameView:",{isAuthenticated:l,previousState:F.value}),h.value!==l&&(h.value=l,console.log("Spotify auth state updated:",l)),l&&!k.isPlayerReady()&&(console.log("Initializing player after auth check"),k.initializePlayerIfReady())}async function se(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await k.forceReauth(),ee()}return ie(()=>{u.gamePhase==="setup"&&u.players.length===0&&Y.push("/"),ee(),k.isAuthenticated()&&k.startSessionMaintenance();const l=setInterval(()=>{h.value?k.startSessionMaintenance():ee()},12e4);ae(()=>{clearInterval(l),k.stopSessionMaintenance()})}),ve(i,l=>{l&&(P.value=!1,g.value=!1,z.value={isCorrect:!1,pointsEarned:0})}),(l,d)=>{var T,E,H,U,t,s,m,R;return r(),n("div",Ss,[e("header",As,[e("div",Ms,[e("div",Es,[e("button",{onClick:d[0]||(d[0]=_=>l.$router.push("/")),class:"btn btn-secondary"}," ← "+o(l.$t("common.back")),1),e("div",Is,[e("h1",js,o(l.$t("game.title")),1),e("div",zs,[e("span",null,o(l.$t("game.round"))+" "+o(G.value),1),N.value.theme?(r(),n("span",Bs," 🎵 "+o(l.$t(`game.themes.${N.value.theme}`)),1)):(r(),n("span",Ns," 🎵 "+o(l.$t("game.allMusic")),1))])])]),e("div",Vs,[e("p",Rs,o(l.$t("game.turn.currentPlayer",{player:(T=C.value)==null?void 0:T.name})),1)])])]),e("main",Ls,[B.value==="setup"?(r(),n("div",Os,[e("div",Fs,[e("h2",Hs,o(l.$t("game.setupRequired")),1),e("p",Us,o(l.$t("game.setupMessage")),1),e("button",{onClick:d[1]||(d[1]=_=>l.$router.push("/")),class:"btn btn-primary"},o(l.$t("game.backToSetup")),1)])])):B.value==="playing"?(r(),n("div",Gs,[e("div",qs,[e("h2",Qs,o(l.$t("game.turn.currentPlayer",{player:(E=C.value)==null?void 0:E.name})),1),e("p",Ys,o(l.$t("game.turn.ready")),1),!i.value&&!I.value?(r(),n("div",Js,[e("button",{onClick:a,class:"btn btn-primary btn-lg"}," 🎵 "+o(l.$t("game.getTrack")),1)])):p("",!0),I.value?(r(),n("div",Ks,[e("div",Ws,[d[3]||(d[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)),e("span",null,o(l.$t("common.loading")),1)])])):p("",!0)]),F.value?F.value&&te.value?(r(),n("div",ao,[e("div",{class:"flex items-center space-x-3"},[d[5]||(d[5]=ue('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:se,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):p("",!0):(r(),n("div",Xs,[e("div",Zs,[d[4]||(d[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",eo,[e("h3",to,o(l.$t("game.spotify.notConnected")),1),e("p",so,o(l.$t("game.demoModeActive")),1)]),e("div",oo,[e("button",{onClick:ne,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},o(l.$t("game.spotify.login")),1),e("button",{onClick:se,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:ee,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),X.value&&F.value?(r(),n("div",lo,d[6]||(d[6]=[ue('<div class="flex items-center space-x-3"><div class="flex-shrink-0"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-blue-800">Mobile Device Detected</h3><p class="text-blue-700 text-sm">Music will play through your Spotify app using Spotify Connect.</p><p class="text-blue-600 text-xs mt-1">💡 If playback stops working, open Spotify and tap play, then return to the game.</p></div></div>',1)]))):p("",!0),i.value?(r(),he(Ct,{key:3,track:i.value,"show-result":P.value,"show-answer":g.value,"is-correct":z.value.isCorrect,"points-earned":z.value.pointsEarned,onPlaceTrack:c},null,8,["track","show-result","show-answer","is-correct","points-earned"])):p("",!0),$.value&&!z.value.isCorrect?(r(),n("div",ro,[e("div",no,[e("div",io,[e("div",uo,[d[7]||(d[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",co,[e("h3",vo,o(l.$t("game.turn.wrongPlacement")),1),e("div",go,[e("p",mo,o((H=i.value)==null?void 0:H.name),1),e("p",po,o((U=i.value)==null?void 0:U.artists.map(_=>_.name).join(", ")),1),e("p",fo,o(l.$t("game.turn.releasedIn",{year:(t=i.value)==null?void 0:t.year})),1)])])]),e("p",bo,o(l.$t("game.turn.correctPlacement")),1),e("p",ho,o(l.$t("game.turn.studyTimeline")),1)]),e("button",{onClick:D,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-blue-500/25"},o(l.$t("game.turn.continue")),1)])])):p("",!0),C.value&&C.value.timeline?(r(),n("div",yo,[ye(Ds,{player:C.value,"is-current":!0,"current-track":i.value,"can-place":!!i.value,onPlaceTrack:c,onUseToken:S},null,8,["player","current-track","can-place"])])):p("",!0),e("div",ko,[e("h3",xo,o(l.$t("game.score.title")),1),e("div",wo,[(r(!0),n(le,null,re(L.value,_=>{var K;return r(),n("div",{key:_.id,class:j(["text-center p-3 rounded-lg",_.id===((K=C.value)==null?void 0:K.id)?"bg-green-100 border-2 border-green-300":"bg-gray-50"])},[e("p",$o,o(_.name),1),e("p",_o,o(_.tokens),1),e("p",Co,o(l.$t("game.score.tokens",{count:_.tokens})),1),e("p",To,o(l.$t("game.score.total",{score:_.score})),1)],2)}),128))])])])):B.value==="finished"?(r(),n("div",Po,[e("div",Do,[e("h2",So,o(l.$t("game.end.title")),1),e("p",Ao,o(l.$t("game.end.winner",{player:(s=O.value)==null?void 0:s.name,score:((R=(m=O.value)==null?void 0:m.timeline)==null?void 0:R.length)||0})),1),e("div",Mo,[e("h3",Eo,o(l.$t("game.end.finalScores")),1),e("div",Io,[(r(!0),n(le,null,re(V.value,(_,K)=>{var v;return r(),n("div",{key:_.id,class:j(["flex justify-between items-center p-3 rounded-lg",K===0?"bg-yellow-100":"bg-gray-50"])},[e("span",jo,o(K+1)+". "+o(_.name),1),e("span",zo,o(((v=_.timeline)==null?void 0:v.length)||0)+" "+o(l.$t("game.songs"))+" | "+o(_.tokens)+" "+o(l.$t("game.score.tokens",{count:_.tokens})),1)],2)}),128))])]),e("div",Bo,[e("button",{onClick:Q,class:"btn btn-primary"}," 🔄 "+o(l.$t("game.end.playAgain")),1),e("button",{onClick:d[2]||(d[2]=_=>l.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+o(l.$t("game.backToHome")),1)])])])):p("",!0)]),f.value?(r(),n("div",No,[e("div",Vo,[d[9]||(d[9]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Ro,[e("div",Lo,[d[8]||(d[8]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Oo,o(l.$t("game.tokens.hint.label")),1)]),e("div",Fo,[e("p",Ho,o(w.value),1)]),e("div",Uo,[e("button",{onClick:q,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},o(l.$t("common.close")),1)])])])])):p("",!0)])}}});export{qo as default};
