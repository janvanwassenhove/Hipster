import{d as ee,m as ge,r as b,c as y,s as x,o as se,n as J,w as Y,p as G,a as u,e,b as m,q as ae,t as a,x as re,f as le,y as B,k as i,g as z,F as K,i as Q,u as ve,j as me,z as fe,A as he,B as be}from"./index-D3fXwoRY.js";const ye={class:"card relative overflow-hidden bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10"},xe={class:"relative z-10 flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8 p-6"},ke={class:"flex-shrink-0"},we={key:0,class:"relative group"},$e={key:1,class:"relative group"},_e=["src","alt"],Te={class:"flex-1 text-center md:text-left"},Pe={class:"mb-6"},Ce={class:"text-gray-300 font-medium text-lg bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Me={class:"text-sm text-gray-400 mt-2 font-light"},Ae={class:"mb-6"},ze={key:0,class:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 border border-blue-400/30 rounded-2xl p-6 text-center backdrop-blur-sm"},Se={class:"flex items-center justify-center mb-3"},je={class:"text-xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},De={class:"text-blue-200 mb-4 font-medium"},Be={class:"bg-blue-800/30 rounded-xl p-4 border border-blue-500/30"},Le={class:"text-blue-100 text-sm font-medium"},Ee={key:1,class:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 border border-blue-400/30 rounded-2xl p-6 text-center backdrop-blur-sm"},Re={class:"flex items-center justify-center mb-3"},Ie={class:"text-xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent"},Ne={class:"text-blue-200 mb-3 font-medium"},Ve={class:"text-sm text-blue-300 font-semibold"},Fe={class:"text-xs text-blue-400 mt-2 opacity-80"},Ue=["src"],Oe={key:3,class:"music-player-controls bg-gradient-to-br from-gray-900/80 to-black/80 rounded-2xl p-6 backdrop-blur-sm border border-gray-700/50 shadow-2xl"},He={class:"flex items-center justify-center space-x-8 mb-6"},Xe=["disabled"],Ye=["disabled"],qe={class:"w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-2xl shadow-purple-500/50 group-hover:from-purple-500 group-hover:to-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:shadow-purple-400/60"},We={key:0,class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},Ge={key:1,class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Ze={key:2,class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Je=["disabled"],Ke={class:"w-12 h-12 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center border border-gray-600/50 shadow-lg group-hover:from-cyan-600 group-hover:to-blue-600 group-hover:border-cyan-400/50 transition-all duration-300 group-hover:scale-110"},Qe={key:0,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},et={key:1,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},tt={key:2,class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},ot={class:"mb-4"},rt={class:"flex items-center space-x-4 text-sm text-gray-300"},st={class:"w-12 text-right font-mono"},at={class:"flex-1 relative"},lt={class:"w-12 font-mono"},nt={class:"flex items-center space-x-4"},it={class:"flex-1 relative group"},ut=["value","disabled"],dt={class:"text-sm text-gray-400 w-10 font-mono"},ct={key:0,class:"p-6 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-blue-400/30 rounded-2xl backdrop-blur-sm"},pt={class:"text-center"},gt={class:"text-2xl font-bold bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent mb-2"},vt={class:"text-blue-200 text-lg font-medium mb-1"},mt={class:"text-blue-300 font-medium"},ft={class:"text-sm text-blue-400 mt-4"},ht=["href"],bt={key:0,class:"mt-6 p-6 bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-400/30 rounded-2xl backdrop-blur-sm"},yt={class:"text-center"},xt={class:"flex items-center justify-center mb-3"},kt={class:"font-bold text-lg bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"},wt={class:"text-purple-200 text-sm font-medium"},$t={class:"flex items-center justify-center mb-3"},_t={key:0,class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mr-3 animate-bounce"},Tt={key:1,class:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},Pt={class:"font-bold text-2xl"},Ct={key:0,class:"text-lg mt-2 font-semibold"},Mt={class:"bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},At=ee({__name:"TrackPlayer",props:{track:{},showAnswer:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1},isCorrect:{type:Boolean,default:!1},pointsEarned:{default:0}},emits:["placeTrack"],setup(R,{emit:L}){const d=R,{t:C}=ge(),c=b(),g=b(!1),h=b(!1),I=b(!1),w=b(0),p=b(0),$=b(.7),S=b(!1),D=b(!1);b(!1);const O=y(()=>{var v,P,W,H;const s=(P=(v=d.track.images)==null?void 0:v[0])==null?void 0:P.url,l=(H=(W=d.track.album.images)==null?void 0:W[0])==null?void 0:H.url;return s||l||"https://via.placeholder.com/300x300/6B7280/FFFFFF?text=No+Image"}),X=y(()=>d.track.artists.map(s=>s.name).join(", ")),E=y(()=>d.showResult?d.isCorrect?"bg-gradient-to-r from-cyan-900/40 to-blue-900/40 border border-cyan-400/30 text-cyan-100":"bg-gradient-to-r from-red-900/40 to-pink-900/40 border border-red-400/30 text-red-100":""),N=y(()=>d.showResult?d.isCorrect?C("game.turn.correct",{year:d.track.year}):C("game.turn.incorrect",{year:d.track.year}):""),V=y(()=>p.value===0?0:w.value/p.value*100),j=y(()=>!!d.track.uri),F=y(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),M=y(()=>j.value&&x.isPlayerReady()&&!F.value),_=y(()=>!1),o=y(()=>M.value||_.value);async function r(){console.log("Toggle playback called, isPlaying:",g.value),console.log("Can play full track:",M.value),console.log("Can play preview:",_.value),console.log("Spotify player ready:",x.isPlayerReady());const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(M.value&&!s){if(await x.getAvailableDevices(),g.value)await x.pausePlayback(),g.value=!1;else if(await x.playTrack(d.track.uri))g.value=!0,n();else if(console.warn("Failed to play track, falling back to preview if available"),_.value&&c.value)try{await c.value.play()}catch(v){console.error("Error playing preview fallback:",v)}}else if(_.value&&c.value)if(g.value)c.value.pause();else try{await c.value.play()}catch(l){console.error("Error playing audio:",l),l instanceof Error&&l.name==="NotAllowedError"&&console.warn("Autoplay blocked - user interaction required")}else console.log("Mobile device without audio playback - visual mode only")}async function t(){console.log("Restart track called"),M.value?await x.playTrack(d.track.uri)&&(g.value=!0,n()):c.value&&(c.value.currentTime=0,g.value&&c.value.play().catch(s=>{console.error("Error playing audio after restart:",s)}))}function n(){const s=async()=>{if(!M.value)return;const l=await x.getPlaybackState();l&&(g.value=!l.paused,w.value=l.position/1e3,p.value=l.duration/1e3,g.value&&setTimeout(s,1e3))};s()}function f(){c.value&&(S.value?(c.value.volume=$.value,S.value=!1):(c.value.volume=0,S.value=!0))}function T(s){if(!c.value)return;const l=s.target,v=parseFloat(l.value);$.value=v,c.value.volume=v,v===0?S.value=!0:S.value&&(S.value=!1)}function A(s){s.stopPropagation()}function q(s){if(!c.value||!d.track.preview_url)return;const v=s.currentTarget.getBoundingClientRect();let P;if("touches"in s)if(s.touches.length>0)P=s.touches[0].clientX;else if(s.changedTouches.length>0)P=s.changedTouches[0].clientX;else return;else P=s.clientX;const H=Math.max(0,Math.min(1,(P-v.left)/v.width))*p.value;c.value.currentTime=H}function k(s){!c.value||!d.track.preview_url||(s.preventDefault(),D.value=!0,Z(s))}function U(s){D.value&&(s.preventDefault(),Z(s))}function ne(s){D.value&&(s.preventDefault(),D.value=!1,Z(s))}function Z(s){if(!c.value||!d.track.preview_url)return;const v=s.currentTarget.getBoundingClientRect(),P=s.touches[0]||s.changedTouches[0];if(!P)return;const H=Math.max(0,Math.min(1,(P.clientX-v.left)/v.width))*p.value;c.value.currentTime=H}function te(s){if(isNaN(s))return"0:00";const l=Math.floor(s/60),v=Math.floor(s%60);return`${l}:${v.toString().padStart(2,"0")}`}function ie(){c.value&&(w.value=c.value.currentTime)}function ue(){c.value&&(p.value=c.value.duration,c.value.volume=$.value)}function de(){h.value=!0,I.value=!1}function ce(){h.value=!1,I.value=!0}function pe(){g.value=!1}se(()=>{x.isAuthenticated()&&J(()=>{x.initializePlayerIfReady()}),J(()=>{c.value&&oe()})}),Y(c,s=>{s&&oe()}),Y(()=>d.track,async(s,l)=>{if(s&&s!==l){console.log("New track detected:",s.name),await J(),g.value=!1;const v=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);setTimeout(async()=>{if(console.log("Checking if auto-playback can start:",{canPlayAudio:o.value,canPlayFullTrack:M.value,canPlayPreview:_.value,hasSpotifyUri:j.value,hasPreviewUrl:!!s.preview_url,isPlayerReady:x.isPlayerReady(),isPlaying:g.value}),o.value&&!g.value){console.log("Auto-starting playback for new track:",s.name);try{await r(),console.log("✅ Auto-playback started successfully")}catch(P){v?console.log("🔇 Auto-playback blocked on mobile - user interaction required"):console.error("❌ Auto-playback failed:",P)}}else{const P=o.value?"Already playing":"No audio source available";console.log(`Cannot auto-start playback: ${P}`),!v&&j.value&&!_.value&&console.log("No preview available but has Spotify URI - playback will use Spotify Web Playback SDK")}},300)}},{immediate:!1}),Y(()=>d.track.preview_url,async(s,l)=>{s&&!l&&!g.value&&(console.log("Preview URL became available for track:",d.track.name),setTimeout(async()=>{if(o.value&&!g.value){console.log("Auto-starting playback now that preview URL is available");try{await r(),console.log("✅ Auto-playback started after preview URL enhancement")}catch(v){console.warn("Failed to auto-start after preview enhancement:",v)}}},100))});function oe(){c.value&&(c.value.addEventListener("play",()=>{g.value=!0}),c.value.addEventListener("pause",()=>{g.value=!1}),c.value.volume=$.value,F.value&&c.value.addEventListener("touchstart",s=>{s.preventDefault()},{passive:!1}))}return G(()=>{M.value?x.stopPlayback():c.value&&c.value.pause()}),(s,l)=>(i(),u("div",ye,[l[20]||(l[20]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-72 h-72 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-96 h-96 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",xe,[e("div",ke,[s.showAnswer?(i(),u("div",$e,[e("img",{src:O.value,alt:s.track.name,class:"w-40 h-40 rounded-2xl shadow-2xl object-cover border border-gray-700/50 backdrop-blur-sm transform group-hover:scale-105 transition-transform duration-300"},null,8,_e),l[5]||(l[5]=e("div",{class:"absolute inset-0 w-40 h-40 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1))])):(i(),u("div",we,l[4]||(l[4]=[ae('<div class="w-40 h-40 rounded-2xl shadow-2xl bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center border border-gray-700/50 backdrop-blur-sm" data-v-3eb694d6><div class="w-32 h-32 rounded-full bg-gradient-to-br from-gray-900 to-black shadow-inner flex items-center justify-center" data-v-3eb694d6><div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 shadow-inner flex items-center justify-center" data-v-3eb694d6><svg class="w-12 h-12 text-gray-400 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-3eb694d6><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" data-v-3eb694d6></path></svg></div></div></div><div class="absolute inset-0 w-40 h-40 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 blur-xl group-hover:blur-2xl transition-all duration-300" data-v-3eb694d6></div>',2)])))]),e("div",Te,[e("div",Pe,[e("p",Ce,a(s.$t("game.turn.listening")),1),e("p",Me,a(s.$t("game.turn.placeOnTimeline")),1)]),e("div",Ae,[!o.value&&F.value&&j.value?(i(),u("div",ze,[e("div",Se,[l[6]||(l[6]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3 shadow-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",je,a(s.$t("game.mobileListening")),1)]),e("p",De,a(s.$t("game.mobileGameMode")),1),e("div",Be,[e("p",Le,a(s.$t("game.listenCarefully")),1)])])):M.value?m("",!0):(i(),u("div",Ee,[e("div",Re,[l[7]||(l[7]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3 shadow-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("h3",Ie,a(j.value?s.$t("game.premiumRequired"):s.$t("game.demoMode")),1)]),e("p",Ne,a(j.value?s.$t("game.needsPremium"):s.$t("game.noPreview")),1),e("p",Ve,[e("strong",null,a(j.value?s.$t("game.premiumNeededForFullPlay"):s.$t("game.needSpotifyForAudio")),1)]),e("p",Fe,a(s.$t("game.demoModeInstructions")),1)])),_.value&&!M.value?(i(),u("audio",{key:2,ref_key:"audioPlayer",ref:c,src:s.track.preview_url||void 0,onEnded:pe,onTimeupdate:ie,onLoadedmetadata:ue,onLoadstart:de,onCanplay:ce,preload:"metadata",playsinline:"","webkit-playsinline":"",crossorigin:"anonymous"},a(s.$t("game.audioNotSupported")),41,Ue)):m("",!0),o.value?(i(),u("div",Oe,[e("div",He,[e("button",{onClick:t,class:"control-btn group relative",disabled:!o.value,title:"Restart"},l[8]||(l[8]=[e("div",{class:"w-12 h-12 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center border border-gray-600/50 shadow-lg group-hover:from-purple-600 group-hover:to-pink-600 group-hover:border-purple-400/50 transition-all duration-300 group-hover:scale-110"},[e("svg",{class:"w-5 h-5 text-gray-300 group-hover:text-white transition-colors duration-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})])],-1)]),8,Xe),e("button",{onClick:r,class:"play-btn group relative",disabled:!o.value},[e("div",qe,[h.value?(i(),u("div",We)):g.value?(i(),u("svg",Ge,l[9]||(l[9]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(i(),u("svg",Ze,l[10]||(l[10]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])))])],8,Ye),e("button",{onClick:f,class:"control-btn group relative",disabled:!o.value,title:"Mute/Unmute"},[e("div",Ke,[S.value||$.value===0?(i(),u("svg",Qe,l[11]||(l[11]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM16 8.4A1 1 0 1117.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1),e("path",{d:"M18.293 6.293a1 1 0 011.414 1.414L17.414 10l2.293 2.293a1 1 0 01-1.414 1.414L16 11.414l-2.293 2.293a1 1 0 01-1.414-1.414L14.586 10l-2.293-2.293a1 1 0 011.414-1.414L16 8.586l2.293-2.293z"},null,-1)]))):$.value<.5?(i(),u("svg",et,l[12]||(l[12]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a2 2 0 010 6 1 1 0 11-1.6-1.2V8.4z","clip-rule":"evenodd"},null,-1)]))):(i(),u("svg",tt,l[13]||(l[13]=[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793zM15 8.4A1 1 0 1116.6 7a4 4 0 010 6 1 1 0 11-1.6-1.2 2 2 0 000-3.6z","clip-rule":"evenodd"},null,-1)])))])],8,Je)]),e("div",ot,[e("div",rt,[e("span",st,a(te(w.value)),1),e("div",at,[e("div",{class:"progress-track relative h-2 bg-gradient-to-r from-gray-800 to-gray-700 rounded-full cursor-pointer group overflow-hidden",onClick:l[0]||(l[0]=v=>q(v)),onTouchstart:l[1]||(l[1]=v=>k(v)),onTouchmove:l[2]||(l[2]=v=>U(v)),onTouchend:l[3]||(l[3]=v=>ne(v))},[l[14]||(l[14]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300"},null,-1)),e("div",{class:"progress-fill absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full shadow-lg transition-all duration-150 ease-out",style:re({width:V.value+"%"})},null,4),e("div",{class:"progress-handle absolute top-1/2 w-4 h-4 bg-white rounded-full shadow-lg transform -translate-y-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:re({left:V.value+"%"})},null,4)],32)]),e("span",lt,a(te(p.value)),1)])]),e("div",nt,[l[15]||(l[15]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.83 13.6H2a1 1 0 01-1-1V7.4a1 1 0 011-1h2.83l3.553-3.193a1 1 0 011.617.793z","clip-rule":"evenodd"})],-1)),e("div",it,[e("input",{type:"range",min:"0",max:"1",step:"0.1",value:$.value,onInput:T,onTouchstart:A,onTouchmove:A,onTouchend:A,class:"volume-slider w-full h-2 bg-gradient-to-r from-gray-800 to-gray-700 rounded-full appearance-none cursor-pointer slider-thumb",disabled:!s.track.preview_url},null,40,ut)]),e("span",dt,a(Math.round($.value*100))+"%",1)])])):m("",!0)]),s.showAnswer?(i(),u("div",ct,[e("div",pt,[e("h4",gt,a(s.track.name),1),e("p",vt,a(X.value),1),e("p",mt,a(s.track.album.name)+" ("+a(s.track.year)+")",1),e("p",ft,[e("a",{href:s.track.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-full hover:from-green-500 hover:to-green-400 transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-green-500/25"},[l[16]||(l[16]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})],-1)),le(" "+a(s.$t("game.openInSpotify")),1)],8,ht)])])])):m("",!0)])]),s.showAnswer?m("",!0):(i(),u("div",bt,[e("div",yt,[e("div",xt,[l[17]||(l[17]=e("div",{class:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-3 animate-pulse"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",kt,a(s.$t("game.turn.placing")),1)]),e("p",wt,a(s.$t("game.dragToTimeline")),1)])])),s.showResult?(i(),u("div",{key:1,class:B(["mt-6 p-6 rounded-2xl text-center backdrop-blur-sm",E.value])},[e("div",$t,[s.isCorrect?(i(),u("div",_t,l[18]||(l[18]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(i(),u("div",Tt,l[19]||(l[19]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),e("p",Pt,a(N.value),1)]),s.pointsEarned>0?(i(),u("p",Ct,[e("span",Mt,a(s.$t("game.turn.points",{points:s.pointsEarned})),1)])):m("",!0)],2)):m("",!0)]))}}),zt=(R,L)=>{const d=R.__vccOpts||R;for(const[C,c]of L)d[C]=c;return d},St=zt(At,[["__scopeId","data-v-3eb694d6"]]),jt={key:0,class:"absolute inset-0 opacity-10"},Dt={class:"relative z-10"},Bt={class:"flex items-center justify-between mb-6"},Lt={class:"text-xl font-bold flex items-center space-x-3"},Et={key:0,class:"text-2xl animate-bounce"},Rt={class:"text-right"},It={class:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent"},Nt={class:"flex items-center space-x-2 text-sm text-gray-300"},Vt={class:"font-medium"},Ft={key:0,class:"mb-6"},Ut={class:"text-sm font-medium text-gray-300 mb-3"},Ot={class:"flex space-x-3"},Ht=["title"],Xt={class:"flex items-center space-x-2"},Yt=["title"],qt={class:"flex items-center space-x-2"},Wt={class:"mb-6"},Gt={class:"text-lg font-semibold text-gray-200 mb-4 flex items-center"},Zt={key:0,class:"text-center py-12 text-gray-400"},Jt={class:"text-lg font-medium mb-2"},Kt={class:"p-8 border-2 border-dashed border-gray-500 rounded-2xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-br from-gray-800/30 to-gray-900/30 backdrop-blur-sm"},Qt={class:"text-center text-gray-300 font-medium"},eo={key:1,class:"space-y-3"},to={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},oo={class:"text-center text-gray-400 text-sm font-medium"},ro={class:"p-4 bg-gradient-to-r from-gray-800/60 to-gray-900/60 backdrop-blur-sm border border-gray-600/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]"},so={class:"flex items-center space-x-4"},ao={class:"w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 relative group-hover:scale-105 transition-transform duration-300"},lo=["src","alt"],no={key:1,class:"w-16 h-16 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center"},io={class:"flex-1 min-w-0"},uo={class:"font-bold text-lg text-gray-100 truncate"},co={class:"text-sm text-gray-300 truncate font-medium"},po={class:"text-right flex-shrink-0"},go={class:"font-bold text-2xl bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"},vo=["onDragover","onDragleave","onDrop","data-drop-zone"],mo={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-purple-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},fo={class:"text-center text-gray-400 text-sm font-medium"},ho=["data-drop-zone"],bo={class:"h-full border-2 border-dashed border-gray-600 rounded-xl group-hover:border-cyan-400 transition-colors duration-300 bg-gradient-to-r from-gray-800/20 to-gray-700/20 backdrop-blur-sm flex items-center justify-center"},yo={class:"text-center text-gray-400 text-sm font-medium"},xo={class:"flex items-center space-x-4"},ko={class:"flex-1 min-w-0"},wo={class:"font-bold text-lg text-blue-200"},$o={class:"text-sm text-blue-300 font-medium"},_o={key:2,class:"mt-6 pt-6 border-t border-gray-600/30"},To={class:"flex justify-between text-sm text-gray-300"},Po={class:"font-medium"},Co={key:0,class:"font-mono"},Mo=ee({__name:"PlayerTimeline",props:{player:{},isCurrent:{type:Boolean},currentTrack:{},canPlace:{type:Boolean}},emits:["placeTrack","useToken"],setup(R,{emit:L}){const d=R,C=L,c=b(!1),g=b([]),h=b(!1),I=b({x:0,y:0}),w=b({x:0,y:0}),p=b(null),$=y(()=>{if(d.player.timeline.length<2)return null;const o=d.player.timeline.map(r=>r.year).sort((r,t)=>r-t);return`${o[0]} - ${o[o.length-1]}`});function S(o){var r,t,n,f;return((t=(r=o.images)==null?void 0:r[0])==null?void 0:t.url)||((f=(n=o.album.images)==null?void 0:n[0])==null?void 0:f.url)||"/placeholder-album.png"}function D(o){return o.artists.map(r=>r.name).join(", ")}function O(o){var t;if(!d.currentTrack)return;(t=o.dataTransfer)==null||t.setData("text/plain",JSON.stringify(d.currentTrack)),o.target.classList.add("dragging")}function X(o){o.target.classList.remove("dragging"),c.value=!1,g.value=[]}function E(o){!d.currentTrack||!d.canPlace||(c.value=!1,g.value=[],C("placeTrack",d.currentTrack,o))}function N(o){C("useToken",o)}function V(o){if(!(!d.currentTrack||!d.canPlace))try{o.preventDefault(),h.value=!0;const r=o.touches[0];if(!r)return;I.value={x:r.clientX,y:r.clientY},w.value={x:r.clientX,y:r.clientY};const t=o.target,n=t.getBoundingClientRect();p.value=t.cloneNode(!0),p.value.style.position="fixed",p.value.style.top=`${n.top}px`,p.value.style.left=`${n.left}px`,p.value.style.width=`${n.width}px`,p.value.style.height=`${n.height}px`,p.value.style.zIndex="9999",p.value.style.opacity="0.8",p.value.style.transform="rotate(2deg)",p.value.style.pointerEvents="none",p.value.classList.add("dragging"),document.body.appendChild(p.value),t.classList.add("dragging"),"vibrate"in navigator&&navigator.vibrate(50)}catch(r){console.warn("Touch start error:",r),_()}}function j(o){if(!(!h.value||!p.value))try{o.preventDefault();const r=o.touches[0];if(!r)return;w.value={x:r.clientX,y:r.clientY};const t=50,n=50;p.value.style.left=`${r.clientX-t}px`,p.value.style.top=`${r.clientY-n}px`;const f=document.elementFromPoint(r.clientX,r.clientY),T=f==null?void 0:f.closest("[data-drop-zone]");if(c.value=!1,g.value.fill(!1),T){const A=parseInt(T.getAttribute("data-drop-zone")||"0");A===0?c.value=!0:A<=g.value.length&&(g.value[A]=!0)}}catch(r){console.warn("Touch move error:",r)}}function F(o){if(h.value)try{o.preventDefault(),h.value=!1;const r=o.changedTouches[0];if(!r){_();return}const t=document.elementFromPoint(r.clientX,r.clientY),n=t==null?void 0:t.closest("[data-drop-zone]");p.value&&(p.value.style.transition="opacity 0.2s ease-out",p.value.style.opacity="0",setTimeout(()=>{p.value&&document.body.contains(p.value)&&document.body.removeChild(p.value),p.value=null},200));const f=document.querySelector(".dragging");if(f&&f.classList.remove("dragging"),c.value=!1,g.value.fill(!1),n&&d.currentTrack){const T=parseInt(n.getAttribute("data-drop-zone")||"0");"vibrate"in navigator&&navigator.vibrate(100),C("placeTrack",d.currentTrack,T)}}catch(r){console.warn("Touch end error:",r),_()}}function M(){g.value=new Array(d.player.timeline.length+1).fill(!1)}function _(){h.value=!1,c.value=!1,g.value.fill(!1),p.value&&document.body.contains(p.value)&&(document.body.removeChild(p.value),p.value=null),document.querySelectorAll(".dragging").forEach(r=>r.classList.remove("dragging"))}return G(()=>{_()}),Y(()=>d.player.timeline.length,()=>{M()},{immediate:!0}),(o,r)=>(i(),u("div",{class:B(["card relative overflow-hidden",{"ring-2 ring-cyan-400 shadow-2xl shadow-cyan-400/20":o.isCurrent}])},[o.isCurrent?(i(),u("div",jt,r[11]||(r[11]=[e("div",{class:"absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"},null,-1),e("div",{class:"absolute bottom-0 right-0 w-80 h-80 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"},null,-1)]))):m("",!0),e("div",Dt,[e("div",Bt,[e("h3",Lt,[e("span",{class:B(o.isCurrent?"bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent":"text-gray-200")},a(o.player.name),3),o.isCurrent?(i(),u("span",Et,"👑")):m("",!0)]),e("div",Rt,[e("p",It,a(o.player.score),1),e("div",Nt,[r[12]||(r[12]=e("span",{class:"text-lg"},"🎵",-1)),e("span",Vt,a(o.$t("game.score.tokens",{count:o.player.tokens})),1)])])]),o.isCurrent&&o.canPlace&&o.player.tokens>0?(i(),u("div",Ft,[e("h4",Ut,a(o.$t("game.tokenAbilities")),1),e("div",Ot,[e("button",{onClick:r[0]||(r[0]=t=>N("skip")),class:"group relative px-4 py-2 bg-gradient-to-r from-orange-600 to-pink-600 hover:from-orange-500 hover:to-pink-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-orange-500/25",title:o.$t("game.tokens.skip.description")},[e("div",Xt,[r[13]||(r[13]=e("span",{class:"text-lg"},"⏭️",-1)),e("span",null,a(o.$t("game.tokens.skip.label")),1)])],8,Ht),e("button",{onClick:r[1]||(r[1]=t=>N("hint")),class:"group relative px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-cyan-500/25",title:o.$t("game.tokens.hint.description")},[e("div",qt,[r[14]||(r[14]=e("span",{class:"text-lg"},"💡",-1)),e("span",null,a(o.$t("game.tokens.hint.label")),1)])],8,Yt)])])):m("",!0),e("div",Wt,[e("h4",Gt,[r[15]||(r[15]=e("span",{class:"mr-2"},"🎵",-1)),le(" "+a(o.$t("game.timeline.title")),1)]),o.player.timeline.length===0?(i(),u("div",Zt,[r[16]||(r[16]=e("div",{class:"mb-4"},[e("div",{class:"w-20 h-20 mx-auto bg-gradient-to-br from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-3xl"},"🎼")])],-1)),e("p",Jt,a(o.$t("game.timeline.empty")),1),o.canPlace?(i(),u("div",{key:0,class:B(["timeline-slot mt-6 group",{"drag-over":c.value}]),onDragover:r[2]||(r[2]=z(t=>c.value=!0,["prevent"])),onDragleave:r[3]||(r[3]=z(t=>c.value=!1,["prevent"])),onDrop:r[4]||(r[4]=z(t=>E(0),["prevent"])),"data-drop-zone":0},[e("div",Kt,[e("p",Qt,a(o.$t("game.timeline.placeHere")),1)])],34)):m("",!0)])):(i(),u("div",eo,[o.canPlace?(i(),u("div",{key:0,class:B(["timeline-slot h-20 group",{"drag-over":g.value[0]}]),onDragover:r[5]||(r[5]=z(t=>g.value[0]=!0,["prevent"])),onDragleave:r[6]||(r[6]=z(t=>g.value[0]=!1,["prevent"])),onDrop:r[7]||(r[7]=z(t=>E(0),["prevent"])),"data-drop-zone":0},[e("div",to,[e("p",oo,a(o.$t("game.placeEarlier")),1)])],34)):m("",!0),(i(!0),u(K,null,Q(o.player.timeline,(t,n)=>(i(),u("div",{key:t.id,class:"track-card group relative"},[e("div",ro,[e("div",so,[e("div",ao,[t.revealed?(i(),u("img",{key:0,src:S(t),alt:t.name,class:"w-16 h-16 object-cover"},null,8,lo)):(i(),u("div",no,r[17]||(r[17]=[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})],-1)])))]),e("div",io,[e("p",uo,a(t.name),1),e("p",co,a(D(t)),1)]),e("div",po,[e("p",go,a(t.year),1)])])]),o.canPlace&&n<o.player.timeline.length-1?(i(),u("div",{key:0,class:B(["timeline-slot h-20 mt-3 group",{"drag-over":g.value[n+1]}]),onDragover:z(f=>g.value[n+1]=!0,["prevent"]),onDragleave:z(f=>g.value[n+1]=!1,["prevent"]),onDrop:z(f=>E(n+1),["prevent"]),"data-drop-zone":n+1},[e("div",mo,[e("p",fo,a(o.$t("game.placeBetween")),1)])],42,vo)):m("",!0)]))),128)),o.canPlace?(i(),u("div",{key:1,class:B(["timeline-slot h-20 group",{"drag-over":g.value[o.player.timeline.length]}]),onDragover:r[8]||(r[8]=z(t=>g.value[o.player.timeline.length]=!0,["prevent"])),onDragleave:r[9]||(r[9]=z(t=>g.value[o.player.timeline.length]=!1,["prevent"])),onDrop:r[10]||(r[10]=z(t=>E(o.player.timeline.length),["prevent"])),"data-drop-zone":o.player.timeline.length},[e("div",bo,[e("p",yo,a(o.$t("game.placeLater")),1)])],42,ho)):m("",!0)]))]),o.canPlace&&o.currentTrack?(i(),u("div",{key:1,class:"p-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-2 border-blue-400/30 rounded-2xl cursor-move touch-manipulation select-none backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02]",draggable:"true",onDragstart:O,onDragend:X,onTouchstart:V,onTouchmove:j,onTouchend:F,style:{touchAction:"none"}},[e("div",xo,[r[18]||(r[18]=e("div",{class:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})])],-1)),e("div",ko,[e("p",wo,a(o.$t("game.newTrack")),1),e("p",$o,a(o.$t("game.dragToPlace")),1)]),r[19]||(r[19]=e("div",{class:"text-blue-300"},[e("span",{class:"text-3xl animate-pulse"},"🎵")],-1))])],32)):m("",!0),o.player.timeline.length>0?(i(),u("div",_o,[e("div",To,[e("span",Po,a(o.$t("game.tracksInTimeline",{count:o.player.timeline.length})),1),$.value?(i(),u("span",Co,a($.value),1)):m("",!0)])])):m("",!0)])],2))}}),Ao={class:"min-h-screen flex flex-col"},zo={class:"bg-white/10 backdrop-blur-sm p-4"},So={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0"},jo={class:"flex items-center space-x-4"},Do={class:"text-white"},Bo={class:"text-xl font-bold"},Lo={class:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm opacity-80"},Eo={key:0,class:"px-2 py-1 bg-purple-500/30 rounded-full border border-purple-400/50 whitespace-nowrap"},Ro={key:1,class:"px-2 py-1 bg-gray-500/30 rounded-full border border-gray-400/50 whitespace-nowrap"},Io={class:"text-white text-right"},No={class:"text-sm opacity-80"},Vo={class:"flex-1 container mx-auto px-4 py-6"},Fo={key:0,class:"max-w-2xl mx-auto"},Uo={class:"card text-center"},Oo={class:"text-2xl font-semibold mb-4"},Ho={class:"text-gray-600 mb-6"},Xo={key:1,class:"space-y-6"},Yo={class:"card text-center bg-gradient-to-br from-purple-900/80 to-blue-900/80 border-purple-500/30"},qo={class:"text-2xl font-bold text-white mb-2"},Wo={class:"text-purple-200"},Go={key:0,class:"mt-4"},Zo={key:1,class:"mt-4"},Jo={class:"flex items-center justify-center space-x-2"},Ko={key:0,class:"card bg-yellow-50 border-yellow-200"},Qo={class:"flex items-center space-x-3"},er={class:"flex-1"},tr={class:"text-lg font-semibold text-yellow-800"},or={class:"text-yellow-700 text-sm"},rr={class:"text-xs text-red-600 mt-2"},sr={class:"flex space-x-2"},ar={key:1,class:"card bg-orange-50 border-orange-200"},lr={key:3,class:"max-w-4xl mx-auto"},nr={class:"card"},ir={class:"text-lg font-semibold mb-4"},ur={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},dr={class:"font-semibold text-white"},cr={class:"text-2xl font-bold text-white"},pr={class:"text-sm text-gray-300"},gr={class:"text-xs text-gray-400"},vr={key:2,class:"max-w-2xl mx-auto"},mr={class:"card text-center"},fr={class:"text-3xl font-bold mb-4 text-white"},hr={class:"text-xl mb-6"},br={class:"mb-6"},yr={class:"text-lg font-semibold mb-3"},xr={class:"space-y-2"},kr={class:"font-medium text-white"},wr={class:"font-bold text-white"},$r={class:"flex space-x-4 justify-center"},_r={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Tr={class:"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 border border-purple-500/20 shadow-2xl shadow-purple-500/10 rounded-2xl p-8 max-w-md w-full mx-auto relative overflow-hidden"},Pr={class:"relative z-10"},Cr={class:"flex items-center space-x-3 mb-6"},Mr={class:"text-2xl font-bold bg-gradient-to-r from-cyan-300 to-blue-300 bg-clip-text text-transparent"},Ar={class:"mb-8"},zr={class:"text-gray-200 text-lg leading-relaxed"},Sr={class:"flex justify-center"},Dr=ee({__name:"GameView",setup(R){const L=me(),d=ve(),C=b(!1),c=b(!1),g=b(""),h=b(!1),I=y(()=>d.players),w=y(()=>d.currentPlayer),p=y(()=>d.currentTrack),$=y(()=>d.gamePhase),S=y(()=>d.round),D=y(()=>d.settings),O=y(()=>d.winner),X=y(()=>h.value&&!x.isPlayerReady()),E=y(()=>[...I.value].sort((t,n)=>n.timeline.length!==t.timeline.length?n.timeline.length-t.timeline.length:n.tokens!==t.tokens?n.tokens-t.tokens:n.score-t.score));async function N(){var t;C.value=!0;try{console.log("Loading next track...");const n=await d.getNextTrack();n?console.log("Track loaded successfully:",n.name,"by",(t=n.artists[0])==null?void 0:t.name):console.error("No tracks available")}catch(n){console.error("Error loading track:",n)}finally{C.value=!1}}function V(t,n){d.placeTrackOnTimeline(t,n),setTimeout(()=>{d.nextPlayer()},2e3)}function j(t){var f;if(!w.value)return;if(d.useToken(w.value.id,t))switch(t){case"skip":N();break;case"hint":const T=Math.floor(((f=p.value)==null?void 0:f.year)/10)*10;g.value=`This track was released in the ${T}s`,c.value=!0;break}}function F(){c.value=!1,g.value=""}function M(){d.resetGame(),L.push("/")}function _(){L.push("/")}function o(){const t=x.isAuthenticated();console.log("🔧 SIMPLE: Setting isSpotifyConnected to:",t),h.value=t,t&&x.initializePlayerIfReady()}async function r(){console.log("🔄 Re-authorizing Spotify with updated permissions"),await x.forceReauth()}return se(()=>{d.gamePhase==="setup"&&d.players.length===0&&L.push("/"),console.log("🔧 MOUNT: Force updating auth state");const t=x.isAuthenticated();console.log("🔧 MOUNT: Auth state from service:",t),h.value=t,console.log("🔧 MOUNT: Set reactive value to:",h.value),o();const n=setInterval(()=>{o()},2e3);G(()=>{clearInterval(n)});const f=Y(()=>x.isAuthenticated(),(T,A)=>{console.log("🔧 WATCHER: Auth state changed from",A,"to",T),console.log("🔧 WATCHER: Current reactive value before update:",h.value),h.value=T,console.log("🔧 WATCHER: Updated reactive value to:",h.value)},{immediate:!0});G(()=>{f()})}),(t,n)=>{var f,T,A,q;return i(),u("div",Ao,[e("header",zo,[e("div",So,[e("div",jo,[e("button",{onClick:n[0]||(n[0]=k=>t.$router.push("/")),class:"btn btn-secondary"}," // Also watch for changes from external events (like token refresh) const authWatcher = watch( () => spotifyService.isAuthenticated(), (newAuth) => { console.log('🔧 SIMPLE WATCHER: Auth changed to:', newAuth) isSpotifyConnected.value = newAuth }, { immediate: true } )$t('common.back') }} "),e("div",Do,[e("h1",Bo,a(t.$t("game.title")),1),e("div",Lo,[e("span",null,a(t.$t("game.round"))+" "+a(S.value),1),D.value.theme?(i(),u("span",Eo," 🎵 "+a(t.$t(`game.themes.${D.value.theme}`)),1)):(i(),u("span",Ro," 🎵 "+a(t.$t("game.allMusic")),1))])])]),e("div",Io,[e("p",No,a(t.$t("game.turn.currentPlayer",{player:(f=w.value)==null?void 0:f.name})),1)])])]),e("main",Vo,[$.value==="setup"?(i(),u("div",Fo,[e("div",Uo,[e("h2",Oo,a(t.$t("game.setupRequired")),1),e("p",Ho,a(t.$t("game.setupMessage")),1),e("button",{onClick:n[1]||(n[1]=k=>t.$router.push("/")),class:"btn btn-primary"},a(t.$t("game.backToSetup")),1)])])):$.value==="playing"?(i(),u("div",Xo,[e("div",Yo,[e("h2",qo,a(t.$t("game.turn.currentPlayer",{player:(T=w.value)==null?void 0:T.name})),1),e("p",Wo,a(t.$t("game.turn.ready")),1),!p.value&&!C.value?(i(),u("div",Go,[e("button",{onClick:N,class:"btn btn-primary btn-lg"}," 🎵 "+a(t.$t("game.getTrack")),1)])):m("",!0),C.value?(i(),u("div",Zo,[e("div",Jo,[n[3]||(n[3]=e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-purple-400"},null,-1)),e("span",null,a(t.$t("common.loading")),1)])])):m("",!0)]),h.value?h.value&&X.value?(i(),u("div",ar,[e("div",{class:"flex items-center space-x-3"},[n[5]||(n[5]=ae('<div class="flex-shrink-0"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-orange-800">Playback Permissions Needed</h3><p class="text-orange-700 text-sm">Your Spotify connection needs updated permissions to play music.</p></div>',2)),e("div",{class:"flex space-x-2"},[e("button",{onClick:r,class:"btn btn-sm bg-orange-600 hover:bg-orange-700 text-white"}," 🔐 Update Permissions ")])])])):m("",!0):(i(),u("div",Ko,[e("div",Qo,[n[4]||(n[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",er,[e("h3",tr,a(t.$t("game.spotify.notConnected")),1),e("p",or,a(t.$t("game.demoModeActive")),1),e("p",rr," DEBUG: isSpotifyConnected.value = "+a(h.value)+", spotifyService.isAuthenticated() = "+a(he(x).isAuthenticated()),1)]),e("div",sr,[e("button",{onClick:_,class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white"},a(t.$t("game.spotify.login")),1),e("button",{onClick:r,class:"btn btn-sm bg-purple-600 hover:bg-purple-700 text-white"}," 🔐 Re-auth "),e("button",{onClick:o,class:"btn btn-sm bg-blue-600 hover:bg-blue-700 text-white"}," 🔄 Refresh ")])])])),p.value?(i(),fe(St,{key:2,track:p.value,onPlaceTrack:V},null,8,["track"])):m("",!0),w.value?(i(),u("div",lr,[be(Mo,{player:w.value,"is-current":!0,"current-track":p.value,"can-place":!!p.value,onPlaceTrack:V,onUseToken:j},null,8,["player","current-track","can-place"])])):m("",!0),e("div",nr,[e("h3",ir,a(t.$t("game.score.title")),1),e("div",ur,[(i(!0),u(K,null,Q(I.value,k=>{var U;return i(),u("div",{key:k.id,class:B(["text-center p-3 rounded-lg",k.id===((U=w.value)==null?void 0:U.id)?"bg-gradient-to-br from-purple-900/80 to-blue-900/80 border-purple-500/30 border":"bg-gray-800/50 border border-gray-600/30"])},[e("p",dr,a(k.name),1),e("p",cr,a(k.tokens),1),e("p",pr,a(t.$t("game.score.tokens",{count:k.tokens})),1),e("p",gr,a(t.$t("game.score.total",{score:k.score})),1)],2)}),128))])])])):$.value==="finished"?(i(),u("div",vr,[e("div",mr,[e("h2",fr,a(t.$t("game.end.title")),1),e("p",hr,a(t.$t("game.end.winner",{player:(A=O.value)==null?void 0:A.name,score:(q=O.value)==null?void 0:q.timeline.length})),1),e("div",br,[e("h3",yr,a(t.$t("game.end.finalScores")),1),e("div",xr,[(i(!0),u(K,null,Q(E.value,(k,U)=>(i(),u("div",{key:k.id,class:B(["flex justify-between items-center p-3 rounded-lg",U===0?"bg-gradient-to-r from-yellow-600/80 to-amber-600/80 border border-yellow-500/30":"bg-gray-800/50 border border-gray-600/30"])},[e("span",kr,a(U+1)+". "+a(k.name),1),e("span",wr,a(k.timeline.length)+" "+a(t.$t("game.songs"))+" | "+a(k.tokens)+" "+a(t.$t("game.score.tokens",{count:k.tokens})),1)],2))),128))])]),e("div",$r,[e("button",{onClick:M,class:"btn btn-primary"}," 🔄 "+a(t.$t("game.end.playAgain")),1),e("button",{onClick:n[2]||(n[2]=k=>t.$router.push("/")),class:"btn btn-secondary"}," 🏠 "+a(t.$t("game.backToHome")),1)])])])):m("",!0)]),c.value?(i(),u("div",_r,[e("div",Tr,[n[7]||(n[7]=e("div",{class:"absolute inset-0 opacity-10"},[e("div",{class:"absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full blur-3xl animate-pulse delay-1000"})],-1)),e("div",Pr,[e("div",Cr,[n[6]||(n[6]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[e("span",{class:"text-2xl"},"💡")],-1)),e("h3",Mr,a(t.$t("game.tokens.hint.label")),1)]),e("div",Ar,[e("p",zr,a(g.value),1)]),e("div",Sr,[e("button",{onClick:F,class:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-purple-500/25"},a(t.$t("common.close")),1)])])])])):m("",!0)])}}});export{Dr as default};
